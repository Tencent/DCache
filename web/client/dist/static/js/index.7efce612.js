(function(e){function t(t){for(var r,s,i=t[0],l=t[1],c=t[2],d=0,m=[];d<i.length;d++)s=i[d],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&m.push(o[s][0]),o[s]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);u&&u(t);while(m.length)m.shift()();return n.push.apply(n,c||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],r=!0,i=1;i<a.length;i++){var l=a[i];0!==o[l]&&(r=!1)}r&&(n.splice(t--,1),e=s(s.s=a[0]))}return e}var r={},o={index:0},n=[];function s(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=r,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(a,r,function(t){return e[t]}.bind(null,r));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/plugins/dcache/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var u=l;n.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("b635")},"00a7":function(e,t,a){"use strict";var r=a("ad7b"),o=a.n(r);o.a},"04b0":function(e,t,a){"use strict";var r=a("a4e9"),o=a.n(r);o.a},"066a":function(e,t,a){},"0827":function(e,t,a){"use strict";var r=a("57bd"),o=a.n(r);o.a},"08ac":function(e,t,a){},"0a5e":function(e,t,a){e.exports=a.p+"static/img/zoom-in.a42f35f1.svg"},1:function(e,t){},"11a2":function(e,t,a){"use strict";var r=a("b2b5"),o=a.n(r);o.a},1342:function(e,t,a){},"1cf6":function(e,t,a){"use strict";var r=a("6051"),o=a.n(r);o.a},"1fd3":function(e,t,a){},"25d5":function(e,t,a){"use strict";var r=a("1342"),o=a.n(r);o.a},"29ab":function(e,t,a){"use strict";var r=a("6663"),o=a.n(r);o.a},"2e87":function(e,t,a){},"2ff6":function(e,t,a){e.exports=a.p+"static/img/spinner.dee5f891.svg"},"33c3":function(e,t,a){"use strict";var r=a("4d7d"),o=a.n(r);o.a},3890:function(e,t,a){"use strict";var r=a("08ac"),o=a.n(r);o.a},3996:function(e,t,a){"use strict";var r=a("a53c"),o=a.n(r);o.a},"3ab4":function(e,t,a){e.exports=a.p+"static/img/default.c68b0cc8.svg"},"3cc4":function(e,t,a){"use strict";var r=a("a6de"),o=a.n(r);o.a},"47fd":function(e,t,a){},4824:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWgAAADkCAMAAACCPk7wAAAB71BMVEUAAACLq/OXr+BOgv+ZsuGasuGas+FHgvibteSgtOSaseFGgPZFgPZFgPZFgPZFgPWasuFGgPZIgPZIgPhGgPaasuFGgPVGgPZGgPWasuGas+FFgPdFgPaZsuGZsuGasuDX4vbE0/Lt8vyZseBFf/VJzI9PaZ5QZ5ZMcLpUX3VMb7ZNba1Oa6ZVXW5ObKpQaJlLc8RLcsFPaqJSZIlRZY1RZpJSYoNUYHpVXGlPaJtUXnJJdtBRZZBKdcxLcb1WW2dVXGtNbrBSY4ZTYX1Jdc5NbrJVXnBKdMlTYoBJd9VRZItJdtJFfvBFf/RIeNpGfe1TYHxHeuFFjeJIed1SY4VJyJVIuKpGkN9Id9dKdMpGlNlKc8ZLcb9OaqRGn8tJypJGfOhGnc5Ho8ZQZpRHe+ZOa6hHsLRIvKVIvqJFi+VKc8dIxphGktxHrblItq1GfOpFiehGoclHq7xIwJ9IxJtFgfJHeuNHpcNNbrRNba9HsrJUX3dFhuxHtK9Iwp1TYX9IuqdPaaBTX3hFg/BMb7hHqb5Hr7dMcLxGl9ZGmdNHp8BGmNVFfvJFhe5Ied9FiOpHm9FGmtFHpsGiuOTc7vFRzpTT3/S8ze2swOi0xurL2fK75tqo4s+J2rl4169i0p98nNxmjNlWgNem4c3j6vmllDHDAAAAIHRSTlMACvcT5WpKNy8b0MSvlvftknJQI9yz0InnpIJg3cS8tkiDxQgAAAvDSURBVHja3JhPTxpRFMXnsxBTa0ErVgcU7dTyr5VOiykLCJCQgBs27giGhdGYsCF85t77PHjf5b3ppptXfplP8MvJuedN9K8kSVImvhCHRKPRuLi4OGAWz8/PpVKp3a5Wq4/fiDiOO53OV+ITcXNzSlwSZ8R4vM98JM7Pz98ZTpjhcFgoFO6OmPxRPp9/eLi+vq7X6/P5B+Ll5T2z/EwMioNi8Zjp96fTZrPZ610RtVqtUqm0Wq3vTLfb/Un8ZtbrW2Y2m00mk9FkNBrd3/9ifhhW6Srdi0JBRB8y5JmB6BJEk+lH9mxUv3mmz5g2nsfwTKJh+unpVXSBuTOq8wyLZtOkWUyz58GgSNiir8g0axbT3VfRUA3RMM2iiY3p1WqVpmkUCgkD0aT5sAHPlug2Es2WY5VoiCYQaDvR4lkizZ450nVibkRbiVaim1MT6N5WorsMNLNoo5o8E7bnIEWX/dWxWBjT7U2iYbqz8UxYnlV1ZCYagSa4Oua+6ih6qqOiTEui19BMbKoD3RFodSTwbERLokmzMQ3PsUFMnxp0R4tnEa08wzQC/WZ6iUDDdH8K0T14VqKlOWAazcGo6kjTwEQj0hJomEaiJdDeRKM6RLTujoI5hnZ1sGhCHcPlVqL7TXQHiTamW45odQyJ4BNdTuB5e3UsStLRiLR0NGnG7DhzV4ckemhXR97u6Ll0tCQ6a3XIMWSs6ljjFhJ2oJHosDo6gWhJNDraOoZVSTRWB0xfMuTZO++MaTvSMI2OlupYqmMI0YQSjXmn9t2tAfPOFo1ruBdUogmdaJl34hnzDjtajQ7GP+8YdLQ+hjI6VKLdeceiK2p2wLN0h5NomXeBdbQkers6EGlV0rqjsxMN0d7qqG+tjmXW6mDRrFlE6+pAoifW6vg/HizujtbH8G87mnF39Ak862OoOxqmiwxKGp4p0jXC6xkdnX0M03QVVEeXk4yX4cLtaC5peGZePZtE74/FM6oD1xAPFivSujsgGi/DY3mwsGq1OvwdPbu1qoMItzrYs+roAyRaNYeIVoEmVEcTkmiIlo5mvPPOfYKbdaeqQzzrfbfpaCboji4z8CzH0LwMIVre4HEs1ZE17wgEGreQ8FWHMZ21oxFoHEPPjkai1/JgCX1HI9JyC90drf/eYd6dqgdL5jH0rzupDnd14GkI0Ui0rg79906vjmBfhmW5hg363hJ94Oxo/fcOpv3zjpEHi2vaOYZ6R+Ov0pW8wdWDRUyv1Y6+V4kO66dSbseJQiG340ShkNtxolDI7ThRKOR2nCgUcjvOH3boHYWBIAaCqI5iGnRjTTS/YC9qDLYxXoVa6BV6WaUlLJCcsEBywgLJCQskJyyQnLBAcsICyQkLJCcskJywQHLCAj4ba7e21zDEeLxd3fcabVO/5md1jQ4f3Zv+aB0vNTp89KF/DgA1Onx015OOGh0+2pqeNKvR4aOnOmaNjh5t6rIaHTx6qGvU6ODRS12rRgeP3uraNfrJ3p3kKAwDURiuhG7opgd6HoWAFDdGQGAH4qDsEBZIiSO/gMvvP8K3AOclkgNDz89DzwlN6Dih+dNxiH+GJqB5vDuKDywGoPkIfhxHJQPQnEmdOPwbgOarLCe+nDUAzc8NnPgBjYEPaMwk11JhPLmWCuNJ+L6nTSqMJ4CeCH2aIHokdDvQ2QOhW4GWzhehW4GWzkdi0GvF9CIVvf8kBb1QTJ9SWW+QEPRYMfUzqSH9nAz0bqaQbu6lTm/JQIOc8zup138i0KVCyrtSt9ckoJeK6RY6e0yiq1RMf36zh3nolWL69Z09jEMvFdMw8549TEOjnPtZg9nDMjTyAO0/e9iFbvcAXT17WIUGOWtXmtUb2IQu1Ql9gA40e8R3n+FG3cDLaKjZI7r7DFHOI/HJf/aI7T7DrTqhD3bhZo/I7jPc5geayx/svGaPyO4z3LN3pj1NBVEAfYi7VK1LjMaYNq8qIFGrKIiKcQVEUErqAm4ssliK7BikUENYCrInCn7yAz/U2zD0to/y+p52JjNv5vyEk5vb09smk/DMRdjZOXuI9Z7hHx3hIexsnD2Ees8wyTMnYWf97CHSe4a0guMMi397CPSeIS3Pp7VskXt2Z9HivGdoCDval9Fsnz2Eec+Q37CzdvYQ5T3DKlqeTcIuq2cPQd4zrDYEB+WfvCmcPQR5z5DvsLNy9hDjPcNkzzyGnYWzhxDvGfIfdimcEvUPNB6dDudyNDq4xBS9oSfB0WXUhDwRRW/w9JO35bOHgKLX0A1vl1Gzs4dwotf1JHi7jJqdPQQTzcN/Rv+Jo7pQ/PJSwqVRJeekLhRej5cSvrwcjR4HDuoisfrbQ0+071CuRov9u3WRWP3poSnad+K4Roe9u3SRWAPPFEUDR/ZpNNijC8U6WKYqGjh8jLiROTc89EUDbg2QOzdYiAYg8yTPDUaiIfMkzw1WoiHz5M4NZqIh86TODXaiIfNkzg2GoiHzJM4NFqIRt7y5wUQ04pI2N1iJxsyTNDeYicbMkzM32InGzJMyNxiKxsyTMTdYisbMkzA3WIpG3PLlhplo+O/rk4JvJQ8rbz64XnznxsUrty5ce/fp8qX7Xwvzy99ebay4+6i66nXtQt1Q65fnz2oyi0Zc0uWGmeh7pZuix0H0UyK6qAhEPy7Mn/YnRNfXDX20LBozT7LcMBUNE11GJhpEtyQmGkSXo+gFW6Ix8+TKDXPRONHFONFJq+M2mWg7qwMzT6rcyLQ6yow7eku0399Y8SY+0fVkdfywKhozT6bcyDjRBSUvUDTuaPwwtD/RmHkS5YaV6hhPVx1+XB12dzTilic3rFRHJVbH9y3R0zDRn7cmutXmRCMuaXIj8+owTHTRtolesLejjZknSW7Yrg7jF5Za2zvamHly5EZG0VgdLTjR2fgwxMyTIjdMPwxL46sjdUfjN8P//jDEzJMhN1gdlcwzT4Lc4EE0ZJ7zc4MP0T6X43ODE9GQeQ7PDV5EQ+Y5Oze4EQ2Z5+jc4Ec0ZJ6Tc4Mj0ZB5Ds4NnkRj5tnCIxJeSmg2UaKVaCXaIxLEixJtQIlWopVoJZoHiBcl2oASrUQr0Uo0DxAvSrQBJVqJVqKVaB4gXpRoA0q0Eq1EK9E8QLw4S/R5wgcgGAyGQqGBgbGxsf7+/o6Ojvb29mj0JdDd3R2JjIyMtLVNTU2Fw+G+vsnJydmVleHh4ebm5t7e90ATsLwcm5ubm5lpaGjo6up6BQQCgc7Ozp6excXF0dH5+YmJwcHBGp8SDZ6BFNFR4jkCnoG46D4ARM8mRPduil5ajsVi4Hm7aDA9iqJr5BYdTDPRUSBpoono8KZnGGkU3QQsxU2nTHQgSbSaaKPogTSrI5IQHTaZ6J1XB+wONdFoOrR9R5OJxtVBTBt2tOXVMaEm+m87drTSQAxEYfgdBS14Z29aKYpUpSBbEYqwVmTtPrHJOpI2szG52Kyx/ecRPoaTOQlv9O1BdIiz22gHbaUjG7058Y2OXR1r7+pYWue27YkOMjoWHeIs0HN9dbjH0GW0fgw7Z73RnHfiHMzoC++8u1HQ1tltNOddakaLdHyj28DVwUZHoRfpd7Ta6Ngd3XB1qGYYuDrE2RUWldG7Hc0wdaMFOn5Hb/syWp13XB0JFdxldCA6dAUPFpaGZuii45cKrqHljk4tLA3N0EnvR4fc0e4t9JqhvqN7o+OMv46CR1yA9gZooIEGuoQRF6C9ARpooE8P+vvLf/HwfD+f2bK9fjI/zsvXdjW1JeTzrTbVY2JKx11VbR4DRQPoROhzDb1d2WJ9Zb6Xa4FugM4EPe02+v3yB/oD6KGgZ2qj96AroDNHBxk90kaT0cNv9MtBRnfQNdEx5HmnoeW8IzoGhdbR0UpGS3RcEx0ZH0MHPWGjcz6G3NEjFZZuo+sa6OzNkAqeLTo47/4kOsjoMaCNMxWcj3+ggf5HIy5AewM00EADXcKIC9DeAA000ECXMOICtDdAAw000CWMuADtDdBAAw10CSMuQHsDNNBAA13CiAvQ3hwt9BeZfObQe9dnUAAAAABJRU5ErkJggg=="},"49de":function(e,t,a){"use strict";var r=a("e15a"),o=a.n(r);o.a},"4d7d":function(e,t,a){},"548c":function(e,t,a){"use strict";var r=a("c1ec"),o=a.n(r);o.a},"57b4":function(e,t,a){},"57bd":function(e,t,a){},5979:function(e,t,a){"use strict";var r=a("6732"),o=a.n(r);o.a},"5e9a":function(e,t,a){},6051:function(e,t,a){},6428:function(e,t,a){"use strict";var r=a("cc4b"),o=a.n(r);o.a},6609:function(e,t,a){},6663:function(e,t,a){},6732:function(e,t,a){},"6aad":function(e,t,a){},"6baa":function(e,t,a){"use strict";var r=a("cfde"),o=a.n(r);o.a},"6c1e":function(e,t,a){"use strict";var r=a("8844"),o=a.n(r);o.a},"6e27":function(e,t,a){"use strict";var r=a("a83c"),o=a.n(r);o.a},"72c4":function(e,t,a){"use strict";var r=a("dc3c"),o=a.n(r);o.a},7720:function(e,t,a){},"7ae4":function(e,t,a){},"7dcc":function(e,t,a){},8001:function(e,t,a){},"80f7":function(e,t,a){"use strict";var r=a("7dcc"),o=a.n(r);o.a},8338:function(e,t,a){},8535:function(e,t,a){"use strict";var r=a("5e9a"),o=a.n(r);o.a},"873a":function(e,t,a){},8844:function(e,t,a){},"8b32":function(e,t,a){},"8ef7":function(e,t,a){"use strict";var r=a("47fd"),o=a.n(r);o.a},"943e":function(e,t,a){},"9a61":function(e,t,a){"use strict";var r=a("066a"),o=a.n(r);o.a},"9bdc":function(e,t,a){"use strict";var r=a("c10a"),o=a.n(r);o.a},a082:function(e,t,a){},a4e9:function(e,t,a){},a53c:function(e,t,a){},a6de:function(e,t,a){},a6f4:function(e,t,a){"use strict";var r=a("2e87"),o=a.n(r);o.a},a83c:function(e,t,a){},ad7b:function(e,t,a){},af6d:function(e,t,a){},b15e:function(e,t,a){"use strict";var r=a("8338"),o=a.n(r);o.a},b2b5:function(e,t,a){},b4ba:function(e,t,a){"use strict";var r=a("57b4"),o=a.n(r);o.a},b635:function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var r=a("a026"),o=a("00e7"),n=a.n(o),s=a("5c96"),i=a.n(s),l=(a("a082"),a("b0c0"),a("1861")),c=a.n(l),u=(a("8c47"),a("6609"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("svg",{staticClass:"icon"},[a("use",{attrs:{"xlink:href":"#"+e.name}})])}),d=[],m={name:"Icon",props:{name:{type:String,required:!0}}},p=m,h=(a("e166"),a("2877")),f=Object(h["a"])(p,u,d,!1,null,null,null),v=f.exports,g=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("let-form-item",{staticClass:"tars-form-item"},[a("label",{staticClass:"let-form-item__label let-label__position_top clickable",on:{click:function(t){return e.$emit("onLabelClick")}}},[e._v(e._s(e.label))]),e._t("default")],2)},_=[],b={name:"TarsFormItem",props:{label:String}},$=b,k=(a("04b0"),Object(h["a"])($,g,_,!1,null,null,null)),w=k.exports,y=a("0c80"),M=a.n(y),x=a("c400"),S=a.n(x);function C(){this.loading=null}r["default"].use(c.a,{locale:{en:S.a,cn:M.a}[n.a.get("locale")||"cn"]||M.a}),r["default"].component(v.name,v),r["default"].component(w.name,w),C.prototype.show=function(e){this.loading&&this.hide();var t=s["Loading"].service({fullscreen:!0,text:e||"Loading",background:"rgba(0,0,0,0)"});return this.loading=t,this},C.prototype.hide=function(){return this.loading&&(this.loading.close(),this.loading=null),this},C.show=function(e){return C._loading||(C._loading=new C),C._loading.show(e)},C.hide=function(){return C._loading||(C._loading=new C),C._loading.hide()},Object.defineProperty(r["default"].prototype,"$Loading",{get:function(){return this._loading||(this._loading=new C),this._loading},set:function(e){}}),Object.defineProperty(r["default"].prototype,"$loading",{get:function(){return this._loading||(this._loading=new C),this._loading},set:function(e){}});var N={error:function(e){r["default"].prototype.$message({showClose:!0,message:e,type:"error"})},success:function(e){r["default"].prototype.$message({showClose:!0,message:e,type:"success"})},warning:function(e){r["default"].prototype.$message({showClose:!0,message:e,type:"warning"})}};Object.defineProperty(r["default"].prototype,"$tip",{get:function(){return N},set:function(e){}});a("99af"),a("4160"),a("6d93"),a("c975"),a("a15b"),a("13d5"),a("fb6a"),a("b64b"),a("d3b7"),a("ac1f"),a("25f0"),a("5319"),a("1276"),a("159b");var L=a("d4ec"),D=a("bee2"),O=a("53ca"),T=function(e){return"string"===typeof e},q=Array.isArray,P=function(e){return"object"===Object(O["a"])(e)&&null!==e},R=function(e){return"function"===typeof e},I=Object.assign;function E(e){return String(e).replace(/(?:[\0- "-&\+-\}\x7F-\xA8\xAA-\xAD\xAF-\u2121\u2123-\u23E8\u23F0-\u23F2\u23F4-\u23F7\u23FB-\u24C1\u24C3-\u25B5\u25B7-\u25FF\u27C0-\u2933\u2936-\u2B04\u2B08-\u2B1A\u2B1D-\u2B4F\u2B51-\u2B54\u2B56-\u302F\u3031-\u303C\u303E-\u3296\u3298\u329A-\uD7FF\uE000-\uFFFF]|[\uD800-\uD83B\uD83F-\uDBFF][\uDC00-\uDFFF]|\uD83C[\uDC00-\uDC03\uDC05-\uDCCE\uDCD0-\uDD6F\uDD72-\uDD7D\uDD80-\uDD8D\uDD8F\uDD90\uDE52-\uDEFF]|\uD83D[\uDE50-\uDE7F\uDF00-\uDFFF]|\uD83E[\uDC00-\uDCFF\uDE00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g,encodeURIComponent).replace(/ /g,"+").replace(/[!'()~*]/g,(function(e){return"%".concat(e.charCodeAt().toString(16).slice(-2).toUpperCase())}))}function j(e){if(!e)return"";var t=[];return Object.keys(e).forEach((function(a){var r=e[a];null!==r&&void 0!==r||(r=""),t.push("".concat(E(a),"=").concat(E(r)))})),t.join("&").replace(/%20/g,"+")}function A(e){var t=function e(t,a,r){return q(r)||P(r)?(Object.keys(r).forEach((function(o){e(t,"".concat(a,"[").concat(o,"]"),r[o])})),t):(t[a]=r,t)};return j(Object.keys(e).reduce((function(a,r){return t(a,r,e[r])}),{}))}var z=function(){function e(t){Object(L["a"])(this,e),this.defaults=t}return Object(D["a"])(e,[{key:"get",value:function(e){return I({},this.defaults,e)}},{key:"set",value:function(e,t){var a=this;if(e){if(T(e)){var r=e.split(".");r.reduce((function(e,a,o){return o===r.length-1&&(e[a]=t),e[a]}),this.defaults)}P(e)&&Object.keys(e).forEach((function(t){a.set(t,e[t])})),q(e)&&e.forEach((function(e){return a.set(e,t)}))}}},{key:"remove",value:function(e){var t=this;if(e){if(T(e)){var a=e.split(".");a.reduce((function(e,t,r){return r===a.length-1&&delete e[t],e[t]}),this.defaults)}q(e)&&e.forEach((function(e){return t.remove(e)}))}}}]),e}(),F=function(){function e(t){Object(L["a"])(this,e),this.handler=t}return Object(D["a"])(e,[{key:"set",value:function(e){R(e)&&(this.handler=e)}},{key:"exec",value:function(){R(this.handler)&&this.handler.apply(null,arguments)}}]),e}(),J=function(){function e(t){Object(L["a"])(this,e),this.base=t||""}return Object(D["a"])(e,[{key:"set",value:function(e){T(e)&&(this.base=e)}},{key:"get",value:function(e){return this.base+(e||"")}}]),e}(),B=function e(){var t=this;Object(L["a"])(this,e),this.ServerUrl=new J,this.Options=new z({credentials:"same-origin",timeout:5e3}),this.Headers=new z({"X-Requested-With":"XMLHttpRequest"}),this.Body=new z({}),this.StatusHandler=new F,this.ResultHandler=new F((function(){return!0})),this.parseUrl=function(e,a){var r=j(t.Body.get(a));return r&&(r=-1===e.indexOf("?")?"?".concat(r):"&".concat(r)),e+r},this.checkStatus=function(e){var a=e.status;if(a>=200&&a<300||304===a)return e;throw t.StatusHandler.exec(a,e),new Error(e.statusText)},this.parseJSON=function(e){return e.json().then(null,(function(a){return t.StatusHandler.exec(500,e),Promise.reject(a)}))},this.successCallback=function(e){return t.ResultHandler.handler(e)?e:Promise.reject(e)},this.errorCallback=function(e){return Promise.reject(e)},this.get=function(e,a){var r=t.Options.get({headers:t.Headers.get()});return fetch(t.ServerUrl.get(t.parseUrl(e,a)),r).then(t.checkStatus).then(t.parseJSON).catch(t.errorCallback)},this.getJSON=function(e,a){var r=t.Options.get({headers:t.Headers.get()});return fetch(t.ServerUrl.get(t.parseUrl(e,a)),r).then(t.checkStatus).then(t.parseJSON).then(t.successCallback).catch(t.errorCallback)},this.post=function(e,a){var r=t.Options.get({method:"POST",headers:t.Headers.get({"Content-Type":"application/x-www-form-urlencoded"}),body:A(t.Body.get(a))});return fetch(t.ServerUrl.get(e),r).then(t.checkStatus).then(t.parseJSON).then(t.successCallback).catch(t.errorCallback)},this.postForm=function(e,a){var r=t.Options.get({method:"POST",headers:t.Headers.get(),body:a}),o=t.Body.get({});return Object.keys(o).forEach((function(e){a.append(e,o[e])})),fetch(t.ServerUrl.get(e),r).then(t.checkStatus).then(t.parseJSON).then(t.successCallback).catch(t.errorCallback)},this.postJSON=function(e,a){var r=t.Options.get({method:"POST",headers:t.Headers.get({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify(t.Body.get(a))});return fetch(t.ServerUrl.get(e),r).then(t.checkStatus).then(t.parseJSON).then(t.successCallback).catch(t.errorCallback)},this.put=function(e,a){var r=t.Options.get({method:"PUT",headers:t.Headers.get({"Content-Type":"application/x-www-form-urlencoded"}),body:A(t.Body.get(a))});return fetch(t.ServerUrl.get(e),r).then(t.checkStatus).then(t.parseJSON).then(t.successCallback).catch(t.errorCallback)},this.remove=function(e,a){var r=t.Options.get({method:"DELETE",headers:t.Headers.get()});return fetch(t.ServerUrl.get(t.parseUrl(e,a)),r).then(t.checkStatus).then(t.parseJSON).then(t.successCallback).catch(t.errorCallback)},this.getPlain=function(e,a){var r=t.Options.get({method:"GET",headers:t.Headers.get()});return fetch(t.ServerUrl.get(t.parseUrl(e,a)),r).then(t.checkStatus).then(t.successCallback).catch(t.errorCallback)},this.postPlain=function(e,a){var r=t.Options.get({method:"POST",headers:t.Headers.get()});return fetch(t.ServerUrl.get(t.parseUrl(e,a)),r).then(t.checkStatus).then(t.successCallback).catch(t.errorCallback)},this.postBinary=function(e,a){var r=t.Options.get({method:"POST",headers:t.Headers.get(),body:a});return fetch(t.ServerUrl.get(t.parseUrl(e)),r).then(t.checkStatus).then(t.successCallback).catch(t.errorCallback)},this.download=function(e,a){window.open(t.ServerUrl.get(t.parseUrl(e,a)))}},V=B,G=new V;G.ServerUrl.set("/plugins/dcache"),G.ResultHandler.set((function(e){return!(!e||200!==e.ret_code||null==e.data)})),["getJSON","postJSON"].forEach((function(e){var t=G[e];G["_".concat(e)]=t,G[e]=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return t.call.apply(t,[null].concat(a)).then((function(e){return e.data}))}})),Object.defineProperty(r["default"].prototype,"$ajax",{get:function(){return G.Headers.set("X-Token",window.localStorage.ticket||""),G}});var W=G,K=new V;K.ServerUrl.set("/pages"),K.ResultHandler.set((function(e){return!(!e||200!==e.ret_code||null==e.data)})),["getJSON","postJSON"].forEach((function(e){var t=K[e];K["_".concat(e)]=t,K[e]=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return t.call.apply(t,[null].concat(a)).then((function(e){return e.data}))}})),Object.defineProperty(r["default"].prototype,"$tars",{get:function(){return K}});var H=K,U=function(){function e(t){Object(L["a"])(this,e),this.vue=t}return Object(D["a"])(e,[{key:"showSucc",value:function(e){"string"==typeof e?this.vue.$message({message:e,showClose:!0,type:"success"}):this.vue.$message({message:"".concat(this.vue.$t("common.success")),showClose:!0,type:"success"})}},{key:"showWarning",value:function(e){this.vue.$message({message:e,showClose:!0,type:"warning"})}},{key:"showError",value:function(e){"string"==typeof e?this.vue.$message({message:e,showClose:!0,type:"error"}):e&&(e.message||e.err_msg)?this.vue.$message({message:"".concat(this.vue.$t("common.error"),": ").concat(e.message||e.err_msg),showClose:!0,type:"error"}):this.vue.$message({message:"".concat(this.vue.$t("common.error")),showClose:!0,type:"error"})}},{key:"showCloudError",value:function(e,t){this.vue.$message({message:this.vue.$t("cloud.".concat(e,".").concat(t&&t.tars_ret||"-1")),showClose:!0,type:"error"})}}]),e}();Object.defineProperty(r["default"].prototype,"$common",{get:function(){return this.commonUtil||(this.commonUtil=new U(this)),this.commonUtil}});var Z=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("app-dcache-header"),a("keep-alive",[a("router-view",{staticClass:"main-width"})],1)],1)},Y=[],Q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app_index__header"},[a("div",{staticClass:"main-width",staticStyle:{float:"left"}},[a("let-tabs",{staticClass:"tabs",attrs:{center:!0,activekey:e.$route.matched[0]?e.$route.matched[0].path:"/server"},on:{click:e.clickTab}},[a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab1"),tabkey:"/server"}}),a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab10"),tabkey:"/operation"}}),a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab3"),tabkey:"/releasePackage"}}),a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab4"),tabkey:"/config"}}),a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab5"),tabkey:"/operationManage"}})],1)],1)])},X=[],ee={data:function(){return{}},methods:{clickTab:function(e){this.$router.replace(e)}},mounted:function(){}},te=ee,ae=(a("cd6a"),Object(h["a"])(te,Q,X,!1,null,null,null)),re=ae.exports,oe={name:"App",components:{AppDcacheHeader:re}},ne=oe,se=(a("d8a7"),Object(h["a"])(ne,Z,Y,!1,null,null,null)),ie=se.exports,le=a("8c4f"),ce=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"page_server"},[r("div",{staticClass:"left-view"},[r("div",{staticClass:"tree_wrap"},[r("i",{staticClass:"el-icon-refresh-right",class:{active:e.isIconPlay},on:{click:function(t){return e.treeSearch(1)}}}),e.treeData&&e.treeData.length?r("let-tree",{staticClass:"left-tree",attrs:{data:e.treeData,activeKey:e.treeid},on:{"on-select":e.selectTree}}):e._e(),e.treeData&&!e.treeData.length?r("div",{staticClass:"left-tree"},[r("p",{staticClass:"loading"},[e._v(e._s(e.$t("common.noService")))])]):e._e(),e.treeData?e._e():r("div",{ref:"treeLoading",staticClass:"left-tree"},[!1===e.treeData?r("div",{staticClass:"loading"},[r("p",[e._v(e._s(e.treeErrMsg))]),r("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.getTreeData()}}},[e._v(e._s(e.$t("common.reTry")))])]):e._e()])],1)]),e.treeid?r("div",{staticClass:"right-view"},[r("div",{staticClass:"btabs_wrap"},[r("ul",{directives:[{name:"vscroll",rawName:"v-vscroll"}],ref:"btabs",staticClass:"btabs"},e._l(e.BTabs,(function(t){return r("li",{key:t.id,staticClass:"btabs_item",class:{active:t.id===e.treeid}},[r("a",{staticClass:"btabs_link",attrs:{href:"javascript:;"},on:{click:function(a){return e.clickBTabs(a,t.id)}}},[e._v(e._s(e.getNewServerName(t.id)))]),r("a",{staticClass:"btabs_close",attrs:{href:"javascript:;"},on:{click:function(a){return e.closeBTabs(t.id)}}},[e._v("Close")])])})),0),r("a",{staticClass:"btabs_all",attrs:{href:"javascript:;",title:"CloseAll"},on:{click:e.closeAllBTabs}},[e._v("CloseAll")])]),r("div",{staticClass:"btabs_con"},e._l(e.BTabs,(function(t){return r("div",{directives:[{name:"show",rawName:"v-show",value:t.id===e.treeid,expression:"item.id === treeid"}],key:t.id,staticClass:"btabs_con_item"},[r("let-tabs",{attrs:{activekey:t.path},on:{click:e.clickTab}},[6===e.serverData.level?[r("let-tab-pane",{attrs:{tabkey:e.base+"/cache",tab:e.$t("index.rightView.tab.manage")}}),r("let-tab-pane",{attrs:{tabkey:e.base+"/moduleCache",tab:e.$t("cache.config.configuration")}}),r("let-tab-pane",{attrs:{tabkey:e.base+"/propertyMonitor",tab:e.$t("index.rightView.tab.propertyMonitor")}})]:5===e.serverData.level?[r("let-tab-pane",{attrs:{tabkey:e.base+"/manage",tab:e.$t("index.rightView.tab.manage")}}),r("let-tab-pane",{attrs:{tabkey:e.base+"/publish",tab:e.$t("index.rightView.tab.patch")}}),r("let-tab-pane",{attrs:{tabkey:e.base+"/config",tab:e.$t("index.rightView.tab.serviceConfig")}}),r("let-tab-pane",{attrs:{tabkey:e.base+"/server-monitor",tab:e.$t("index.rightView.tab.statMonitor")}}),"dcache"!=e.serverType?r("let-tab-pane",{attrs:{tabkey:e.base+"/property-monitor",tab:e.$t("index.rightView.tab.propertyMonitor")}}):e._e()]:1===e.serverData.level?[r("let-tab-pane",{attrs:{tabkey:e.base+"/manage",tab:e.$t("index.rightView.tab.manage")}}),r("let-tab-pane",{attrs:{tabkey:e.base+"/config",tab:e.$t("index.rightView.tab.appConfig")}})]:e._e()],2),r(e.getName(t.path),{ref:"childView",refInFor:!0,tag:"router-view",staticClass:"page_server_child",attrs:{treeid:t.id,servertype:e.serverType}})],1)})),0)]):r("div",{staticClass:"right-view"},[r("div",{staticClass:"empty",staticStyle:{width:"300px"}},[r("img",{staticClass:"package",attrs:{src:a("4824")}}),r("p",{staticClass:"title"},[e._v(e._s(e.$t("index.rightView.title")))]),r("p",{staticClass:"notice",domProps:{innerHTML:e._s(e.$t("index.rightView.tips"))}}),r("p",{staticClass:"notice"},[e._v("https://github.com/Tencent/DCache")])])])])},ue=[],de=(a("baa5"),a("a434"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_manage"},[a("div",{staticClass:"table_head"},[a("h4",[e._v(" "+e._s(this.$t("serverList.title.serverList"))+" "),a("i",{staticClass:"el-icon-refresh-right",on:{click:e.getServerList}})])]),e.serverList?a("let-table",{ref:"serverListLoading",staticClass:"dcache",attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{attrs:{value:e.isCheckedAll},model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{value:t.row.id},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}],null,!1,1091570282)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{staticClass:"buttonText",attrs:{href:"/static/logview/logview.html?app="+[t.row.application]+"&server_name="+[t.row.server_name]+"&node_name="+[t.row.node_name],title:"点击查看服务日志(view server logs)",target:"_blank"}},[e._v(" "+e._s(t.row.server_name)+" ")])]}}],null,!1,1602031482)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name",width:"140px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.enableSet")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.enable_set?a("p",{staticStyle:{"max-width":"200px"}},[e._v(" "+e._s(e.$t("common.set.setName"))+"："+e._s(t.row.set_name)),a("br"),e._v(" "+e._s(e.$t("common.set.setArea"))+"："+e._s(t.row.set_area)),a("br"),e._v(" "+e._s(e.$t("common.set.setGroup"))+"："+e._s(t.row.set_group)+" ")]):a("span",[e._v(e._s(e.$t("common.disable")))])]}}],null,!1,1083854891)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"===e.row.setting_state?"status-active":"status-off"})]}}],null,!1,2336342142)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus"),width:"65px"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"===e.row.present_state?"status-active":"activating"===e.row.present_state?"status-activating":"status-off"})]}}],null,!1,1428767809)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.processID"),prop:"process_id",width:"80px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"patch_version",width:"68px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.time")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"word-break":"break-word"}},[e._v(e._s(e.handleNoPublishedTime(t.row.patch_time)))])]}}],null,!1,3144837894)}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.configServer(t.row.id)}}},[e._v(e._s(e.$t("operate.update")))]),"proxy"===e.serverType||"router"===e.serverType?a("let-table-operation",{on:{click:function(a){return e.openExpandModal(t.row)}}},[e._v(e._s(e.$t("dcache.expand")))]):e._e(),a("let-table-operation",{on:{click:function(a){return e.restartServer(t.row.id)}}},[e._v(e._s(e.$t("operate.restart")))]),a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.stopServer(t.row.id)}}},[e._v(e._s(e.$t("operate.stop")))]),a("let-table-operation",{on:{click:function(a){return e.manageServant(t.row)}}},[e._v(e._s(e.$t("operate.servant")))]),a("let-table-operation",{on:{click:function(a){return e.showMoreCmd(t.row)}}},[e._v(e._s(e.$t("operate.more")))]),a("let-table-operation",{on:{click:function(a){return e.showStatus(t.row.id)}}},[e._v(e._s(e.$t("operate.status")))])]}}],null,!1,3161968521)}),a("template",{slot:"operations"},[a("batch-operation",{attrs:{size:"small",disabled:!e.hasCheckedServer,"checked-servers":e.checkedServers,type:"restart"},on:{"success-fn":e.getServerList}}),a("batch-operation",{attrs:{size:"small",disabled:!e.hasCheckedServer,"checked-servers":e.checkedServers,type:"stop"},on:{"success-fn":e.getServerList}})],1)],2):e._e(),e.serverNotifyList&&e.showOthers?a("h4",[e._v(" "+e._s(this.$t("serverList.title.serverStatus"))+" "),a("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.getServerNotifyList()}}},[e._v("")])]):e._e(),e.serverNotifyList&&e.showOthers?a("let-table",{ref:"serverNotifyListLoading",attrs:{data:e.serverNotifyList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("common.time"),prop:"notifytime",width:"200px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.serviceID"),prop:"server_id",width:"200px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.threadID"),prop:"thread_id",width:"200px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.result")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{style:e.statusStyle(t.row.result)},[e._v(e._s(t.row.result))])]}}],null,!1,3563771650)})],1):e._e(),a("let-pagination",{staticStyle:{"margin-bottom":"32px"},attrs:{page:e.pageNum,total:e.total},on:{change:e.gotoPage}}),a("let-modal",{attrs:{title:e.$t("serviceExpand.title"),width:"800px",footShow:!(!e.expandModal.model||!e.expandModal.model.server_name)},on:{"on-confirm":e.expandService,close:e.closeExpandModal,"on-cancel":e.closeExpandModal},model:{value:e.expandModal.show,callback:function(t){e.$set(e.expandModal,"show",t)},expression:"expandModal.show"}},[e.expandModal.model&&e.expandModal.model.server_name?a("let-form",{ref:"expandForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("common.service")}},[e._v(e._s(e.expandModal.model.server_name))]),a("let-form-item",{attrs:{label:e.$t("common.ip")}},[e._v(e._s(e.expandModal.model.node_name))]),a("let-form-item",{attrs:{label:e.$t("serviceExpand.form.tarIP"),itemWidth:"100%",required:""}},[a("let-input",{attrs:{type:"textarea",rows:3,placeholder:e.$t("serviceExpand.form.placeholder"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.expandModal.expandIpStr,callback:function(t){e.$set(e.expandModal,"expandIpStr",t)},expression:"expandModal.expandIpStr"}})],1),a("let-form-item",{attrs:{label:e.$t("serviceExpand.form.nodeConfig"),itemWidth:"100%"}},[a("let-checkbox",{model:{value:e.expandModal.model.copy_node_config,callback:function(t){e.$set(e.expandModal.model,"copy_node_config",t)},expression:"expandModal.model.copy_node_config"}},[e._v(" "+e._s(e.$t("serviceExpand.form.copyNodeConfig"))+" ")])],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.$t("serverList.dlg.title.editService"),width:"800px",footShow:!(!e.configModal.model||!e.configModal.model.server_name)},on:{"on-confirm":e.saveConfig,close:e.closeConfigModal,"on-cancel":e.closeConfigModal},model:{value:e.configModal.show,callback:function(t){e.$set(e.configModal,"show",t)},expression:"configModal.show"}},[e.configModal.model&&e.configModal.model.server_name?a("let-form",{ref:"configForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("common.service")}},[e._v(e._s(e.configModal.model.server_name))]),a("let-form-item",{attrs:{label:e.$t("common.ip")}},[e._v(e._s(e.configModal.model.node_name))]),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.isBackup"),required:""}},[a("let-radio-group",{attrs:{size:"small",data:[{value:!0,text:e.$t("common.yes")},{value:!1,text:e.$t("common.no")}]},model:{value:e.configModal.model.bak_flag,callback:function(t){e.$set(e.configModal.model,"bak_flag",t)},expression:"configModal.model.bak_flag"}})],1),a("let-form-item",{attrs:{label:e.$t("common.template"),required:""}},[e.configModal.model.templates&&e.configModal.model.templates.length?a("let-select",{attrs:{size:"small",required:""},model:{value:e.configModal.model.template_name,callback:function(t){e.$set(e.configModal.model,"template_name",t)},expression:"configModal.model.template_name"}},e._l(e.configModal.model.templates,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1):a("span",[e._v(e._s(e.configModal.model.template_name))])],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.serviceType"),required:""}},[a("let-select",{attrs:{size:"small",required:""},model:{value:e.configModal.model.server_type,callback:function(t){e.$set(e.configModal.model,"server_type",t)},expression:"configModal.model.server_type"}},e._l(e.serverTypes,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.th.enableSet"),required:""}},[a("let-radio-group",{attrs:{size:"small",data:[{value:!0,text:e.$t("common.enable")},{value:!1,text:e.$t("common.disable")}]},model:{value:e.configModal.model.enable_set,callback:function(t){e.$set(e.configModal.model,"enable_set",t)},expression:"configModal.model.enable_set"}})],1),e.configModal.model.enable_set?a("let-form-item",{attrs:{label:e.$t("common.set.setName"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.errMsg.setName"),required:"",pattern:"^[a-z]+$","pattern-tip":e.$t("serverList.dlg.errMsg.setName")},model:{value:e.configModal.model.set_name,callback:function(t){e.$set(e.configModal.model,"set_name",t)},expression:"configModal.model.set_name"}})],1):e._e(),e.configModal.model.enable_set?a("let-form-item",{attrs:{label:e.$t("common.set.setArea"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.errMsg.setArea"),required:"",pattern:"^[a-z]+$","pattern-tip":e.$t("serverList.dlg.errMsg.setArea")},model:{value:e.configModal.model.set_area,callback:function(t){e.$set(e.configModal.model,"set_area",t)},expression:"configModal.model.set_area"}})],1):e._e(),e.configModal.model.enable_set?a("let-form-item",{attrs:{label:e.$t("common.set.setGroup"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.errMsg.setGroup"),required:"",pattern:"^[0-9\\*]+$","pattern-tip":e.$t("serverList.dlg.errMsg.setGroup")},model:{value:e.configModal.model.set_group,callback:function(t){e.$set(e.configModal.model,"set_group",t)},expression:"configModal.model.set_group"}})],1):e._e(),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.asyncThread"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.placeholder.thread"),required:"",pattern:"tars_nodejs"===e.configModal.model.server_type?"^[1-9][0-9]*$":"^([3-9]|[1-9][0-9]+)$","pattern-tip":"$t('serverList.dlg.placeholder.thread')"},model:{value:e.configModal.model.async_thread_num,callback:function(t){e.$set(e.configModal.model,"async_thread_num",t)},expression:"configModal.model.async_thread_num"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.defaultPath")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.base_path,callback:function(t){e.$set(e.configModal.model,"base_path",t)},expression:"configModal.model.base_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.exePath")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.exe_path,callback:function(t){e.$set(e.configModal.model,"exe_path",t)},expression:"configModal.model.exe_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.startScript")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.start_script_path,callback:function(t){e.$set(e.configModal.model,"start_script_path",t)},expression:"configModal.model.start_script_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.stopScript")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.stop_script_path,callback:function(t){e.$set(e.configModal.model,"stop_script_path",t)},expression:"configModal.model.stop_script_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.monitorScript"),itemWidth:"724px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.monitor_script_path,callback:function(t){e.$set(e.configModal.model,"monitor_script_path",t)},expression:"configModal.model.monitor_script_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.privateTemplate"),labelWidth:"150px",itemWidth:"724px"}},[a("let-input",{attrs:{size:"large",type:"textarea",rows:4},model:{value:e.configModal.model.profile,callback:function(t){e.$set(e.configModal.model,"profile",t)},expression:"configModal.model.profile"}})],1)],1):a("div",{ref:"configFormLoading",staticClass:"loading-placeholder"})],1),a("let-modal",{attrs:{title:e.$t("serverList.table.servant.title"),width:"1200px",footShow:!1},on:{close:e.closeServantModal},model:{value:e.servantModal.show,callback:function(t){e.$set(e.servantModal,"show",t)},expression:"servantModal.show"}},[a("let-button",{staticClass:"tbm16",attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.configServant()}}},[e._v(e._s(e.$t("operate.add"))+" Servant")]),e.servantModal.model?a("let-table",{attrs:{data:e.servantModal.model,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("operate.servant"),prop:"servant"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.adress"),prop:"endpoint"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.thread"),prop:"thread_num"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.connections"),prop:"max_connections"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),prop:"queuecap"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),prop:"queuetimeout"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.configServant(t.row.id)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.deleteServant(t.row.id)}}},[e._v(e._s(e.$t("operate.delete")))])]}}],null,!1,943492724)})],1):a("div",{ref:"servantModalLoading",staticClass:"loading-placeholder"})],1),a("let-modal",{attrs:{title:e.servantDetailModal.isNew?e.$t("operate.add")+" Servant":e.$t("operate.update")+" Servant",width:"800px",footShow:!!e.servantDetailModal.model},on:{"on-confirm":e.saveServantDetail,close:e.closeServantDetailModal,"on-cancel":e.closeServantDetailModal},model:{value:e.servantDetailModal.show,callback:function(t){e.$set(e.servantDetailModal,"show",t)},expression:"servantDetailModal.show"}},[e.servantDetailModal.model?a("let-form",{ref:"servantDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("serverList.servant.appService"),itemWidth:"724px"}},[a("span",[e._v(e._s(e.servantDetailModal.model.application)+"·"+e._s(e.servantDetailModal.model.server_name))])]),a("let-form-item",{attrs:{label:e.$t("serverList.servant.objName"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.servant.c"),required:"",pattern:"^[A-Za-z]+$","pattern-tip":e.$t("serverList.servant.obj")},model:{value:e.servantDetailModal.model.obj_name,callback:function(t){e.$set(e.servantDetailModal.model,"obj_name",t)},expression:"servantDetailModal.model.obj_name"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.numOfThread"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.servant.thread"),required:"",pattern:"^[1-9][0-9]*$","pattern-tip":e.$t("serverList.servant.thread")},model:{value:e.servantDetailModal.model.thread_num,callback:function(t){e.$set(e.servantDetailModal.model,"thread_num",t)},expression:"servantDetailModal.model.thread_num"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.servant.adress"),required:"",itemWidth:"724px"}},[a("let-input",{ref:"endpoint",attrs:{size:"small",placeholder:"tcp -h 127.0.0.1 -t 60000 -p 12000",required:"",extraTip:e.isEndpointValid?"":e.$t("serverList.servant.error")},model:{value:e.servantDetailModal.model.endpoint,callback:function(t){e.$set(e.servantDetailModal.model,"endpoint",t)},expression:"servantDetailModal.model.endpoint"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.connections"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.max_connections,callback:function(t){e.$set(e.servantDetailModal.model,"max_connections",t)},expression:"servantDetailModal.model.max_connections"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.lengthOfQueue"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.queuecap,callback:function(t){e.$set(e.servantDetailModal.model,"queuecap",t)},expression:"servantDetailModal.model.queuecap"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.queueTimeout"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.queuetimeout,callback:function(t){e.$set(e.servantDetailModal.model,"queuetimeout",t)},expression:"servantDetailModal.model.queuetimeout"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.allowIP")}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.allow_ip,callback:function(t){e.$set(e.servantDetailModal.model,"allow_ip",t)},expression:"servantDetailModal.model.allow_ip"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.protocol"),required:""}},[a("let-radio-group",{attrs:{size:"small",data:[{value:"tars",text:"TARS"},{value:"not_tars",text:e.$t("serverList.servant.notTARS")}]},model:{value:e.servantDetailModal.model.protocol,callback:function(t){e.$set(e.servantDetailModal.model,"protocol",t)},expression:"servantDetailModal.model.protocol"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.treatmentGroup"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.handlegroup,callback:function(t){e.$set(e.servantDetailModal.model,"handlegroup",t)},expression:"servantDetailModal.model.handlegroup"}})],1)],1):e._e()],1),a("let-modal",{staticClass:"more-cmd",attrs:{title:e.$t("operate.more"),width:"700px"},on:{"on-confirm":e.invokeMoreCmd,close:e.closeMoreCmdModal,"on-cancel":e.closeMoreCmdModal},model:{value:e.moreCmdModal.show,callback:function(t){e.$set(e.moreCmdModal,"show",t)},expression:"moreCmdModal.show"}},[e.moreCmdModal.model?a("let-form",{ref:"moreCmdForm"},[a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"setloglevel"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.logLevel")))]),a("let-select",{attrs:{size:"small",disabled:"setloglevel"!==e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.setloglevel,callback:function(t){e.$set(e.moreCmdModal.model,"setloglevel",t)},expression:"moreCmdModal.model.setloglevel"}},e._l(e.logLevels,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"loadconfig"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.pushFile")))]),a("let-select",{attrs:{size:"small",placeholder:e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length?e.$t("pub.dlg.defaultValue"):e.$t("pub.dlg.noConfFile"),disabled:!(e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length)||"loadconfig"!==e.moreCmdModal.model.selected,required:"loadconfig"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.loadconfig,callback:function(t){e.$set(e.moreCmdModal.model,"loadconfig",t)},expression:"moreCmdModal.model.loadconfig"}},e._l(e.moreCmdModal.model.configs,(function(t){return a("let-option",{key:t.filename,attrs:{value:t.filename}},[e._v(e._s(t.filename))])})),1)],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"command"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.sendCommand")))]),a("let-input",{attrs:{size:"small",disabled:"command"!==e.moreCmdModal.model.selected,required:"command"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.command,callback:function(t){e.$set(e.moreCmdModal.model,"command",t)},expression:"moreCmdModal.model.command"}})],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"connection"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.serviceLink")))])],1),"dcache"!==e.serverType?a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{staticClass:"danger",attrs:{label:"undeploy_tars"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("operate.undeploy"))+" "+e._s(e.$t("common.service")))])],1):e._e()],1):e._e()],1)],1)}),me=[],pe=(a("4de4"),a("7db0"),a("d81d"),a("498a"),a("15fd")),he=a("5530"),fe=(a("96cf"),a("1da1")),ve=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"batch-publish",staticStyle:{display:"inline"}},[a("let-button",{attrs:{size:e.size,theme:"primary",disabled:e.disabled},on:{click:e.init}},[e._v(e._s(e.$t("dcache.batch."+e.type)))]),a("let-modal",{attrs:{closeOnClickBackdrop:!0,width:"1000px",title:e.$t("dcache.batch."+e.type)},on:{"on-confirm":e.confirm},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("let-form",[a("let-form-item",{attrs:{label:e.$t("service.serverName")}},e._l(e.checkedServers,(function(t){return a("p",[e._v(" "+e._s(t.application+"."+t.server_name+"_"+t.node_name)+" ")])})),0)],1),a("let-form",{staticClass:"elegant-form"},[a("div",{staticClass:"elegant-switch"},[a("let-switch",{attrs:{size:"large"},on:{change:e.changeElegantStatus},model:{value:e.elegantChecked,callback:function(t){e.elegantChecked=t},expression:"elegantChecked"}},[a("span",{attrs:{slot:"open"},slot:"open"},[e._v(e._s(e.$t("dcache.batch.elegantTask")))]),a("span",{attrs:{slot:"close"},slot:"close"},[e._v(e._s(e.$t("dcache.batch.commonTask")))])]),e._v(" "),e.elegantChecked?a("div",{staticClass:"elegant-num"},[a("span",{staticClass:"elegant-label"},[e._v(e._s(e.$t("dcache.batch.elegantEachNum")))]),a("let-input-number",{staticClass:"elegant-box",attrs:{max:20,min:1,step:1,size:"small"},model:{value:e.eachNum,callback:function(t){e.eachNum=t},expression:"eachNum"}})],1):e._e()],1)])],1),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0,width:"1000px",title:e.$t("dcache.batch."+e.type)},model:{value:e.releaseIng,callback:function(t){e.releaseIng=t},expression:"releaseIng"}},[e.releaseId&&e.releaseIng?a("tars-release-progress",{attrs:{"release-id":e.releaseId},on:{"close-fn":this.getServerList}}):e._e()],1)],1)},ge=[],_e=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"progressTable"},[a("let-table",{ref:"ProgressTable",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name",width:"30%"}}),a("let-table-column",{attrs:{title:e.$t("service.serverIp"),prop:"node_name",width:"30%"}}),a("let-table-column",{attrs:{title:e.$t("operate.status")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-tag",{attrs:{theme:2==t.row.status?"success":3==t.row.status?"danger":"",checked:""}},[e._v(" "+e._s(e.statusConfig[t.row.status]+(2!=t.row.status&&3!=t.row.status&&4!=t.row.status?"...":""))+" ")])]}}])})],1),a("p",{ref:"progressTip"},[e._v(" "+e._s(e.$t(e.success?"dcache.executeSuccess":"dcache.execute"))+" ")])],1)},be=[],$e=(a("caad"),a("a9e3"),{props:{releaseId:{type:[Number,String],required:!0}},data:function(){return{items:[],timer:"",progressTip:"",success:!1,statusConfig:{0:this.$t("serverList.restart.notStart"),1:this.$t("serverList.restart.preparing"),2:this.$t("serverList.restart.running"),3:this.$t("serverList.restart.success"),4:this.$t("serverList.restart.failed"),5:this.$t("serverList.restart.cancel"),6:this.$t("serverList.restart.pauseFlow")}}},methods:{getTarsReleaseProgress:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$tars.getJSON("/server/api/task",{task_no:e});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a)})))()},getProgress:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.getTarsReleaseProgress(e.releaseId);case 3:a=t.sent,r=a.items,a.serial,a.status,a.task_no,e.items=r,o=!0,r.forEach((function(e){return[2,3,4].includes(e.status)?"":o=!1})),o?(e.timer&&window.clearTimeout(e.timer),e.success=!0,e.$emit("done-fn")):e.timer=window.setTimeout(e.getProgress,1e3),t.next=19;break;case 14:t.prev=14,t.t0=t["catch"](0),e.success=!0,console.error(t.t0),e.$tip.error(t.t0.message);case 19:case"end":return t.stop()}}),t,null,[[0,14]])})))()}},created:function(){this.getProgress()},destroyed:function(){this.timer&&window.clearTimeout(this.timer),this.$emit("close-fn")}}),ke=$e,we=(a("6c1e"),Object(h["a"])(ke,_e,be,!1,null,"bf31b3e6",null)),ye=we.exports,Me={data:function(){return{servers:[],transferData:!0,migrationMethods:[{value:!0,text:this.$t("dcache.migrationMethod1")},{value:!1,text:this.$t("dcache.migrationMethod2")}]}},props:{expandServers:{required:!0,type:Array}},computed:{appName:function(){return this.expandServers[0].app_name},moduleName:function(){return this.expandServers[0].module_name},cache_version:function(){return this.expandServers[0].cache_version},srcGroupName:function(){return this.expandServers[0].group_name},dstGroupName:function(){return this.servers[0].group_name}},methods:{getServers:function(){this.servers=this.newGroup(this.expandServers)},addNewGroup:function(){var e=this.servers;this.servers=e.concat(this.newGroup(e.slice(e.length-this.expandServers.length)))},deleteGroup:function(){this.servers.splice(this.servers.length-this.expandServers.length,this.expandServers.length)},newGroup:function(e){return e.map((function(e,t){var a=e.group_name,r=e.server_name;a=a.replace(/^(.*?)(\d+)$/,(function(){return arguments[1]+(+arguments[2]+1)})),r=r.replace(/^(.*?)(\d+)-\d+$/,(function(){return arguments[1]+(+arguments[2]+1)+"-"+(t+1)}));var o=e.server_type;return Object(he["a"])(Object(he["a"])({},e),{},{group_name:a,server_name:r,server_ip:"",shmKey:"",server_type:o})}))}}},xe={components:{tarsReleaseProgress:ye},mixins:[Me],props:{size:String,disabled:Boolean,expandServers:{required:!1,type:Array},checkedServers:{required:!1,type:Array},type:String},data:function(){return{versionList:[],releaseId:null,show:!1,publishModal:{moduleName:"",application:"DCache",totalPatchPage:0,pageSize:5,currPage:1},releaseIng:!1,elegantChecked:!1,eachNum:0}},methods:{init:function(){this.show=!0,this.releaseId=null,this.releaseIng=!1},addTask:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o,n,s,i,l,c,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.serial,o=void 0!==r&&r,n=e.elegant,s=void 0!==n&&n,i=e.eachnum,l=void 0===i?1:i,c=e.items,u=void 0===c?[{server_id:"",command:"patch_tars",parameters:{patch_id:0,bak_flag:"",group_name:""}}]:c,a.next=3,t.$tars.postJSON("/server/api/add_task",{serial:o,elegant:s,eachnum:l,items:u});case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),a)})))()},confirm:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=[],r=e.checkedServers,r.forEach((function(t){a.push({server_id:t.id.toString(),command:e.type})})),t.prev=3,o=e.elegantChecked,n=e.eachNum,s=!1,t.next=9,e.addTask({serial:s,elegant:o,eachnum:n,items:a});case 9:i=t.sent,e.releaseIng=!0,e.releaseId=i,t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](3),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 17:case"end":return t.stop()}}),t,null,[[3,14]])})))()},getServerList:function(){this.show=!1,this.$emit("success-fn")},changeElegantStatus:function(e){this.checked=e,e&&(this.eachNum=1)}}},Se=xe,Ce=(a("3890"),Object(h["a"])(Se,ve,ge,!1,null,null,null)),Ne=Ce.exports,Le=function(){return{application:"DCache",server_name:"",set:"",node_name:"",expand_nodes:[],enable_set:!1,set_name:"",set_area:"",set_group:"",copy_node_config:!1}},De={name:"ServerManage",components:{batchOperation:Ne},data:function(){return{isCheckedAll:!1,serverType:this.servertype||"tars_cpp",serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},serverList:[],serverNotifyList:[],pageNum:1,pageSize:20,total:1,serverTypes:["tars_cpp","tars_java","tars_php","tars_nodejs","not_tars","tars_go"],configModal:{show:!1,model:null},servantModal:{show:!1,model:null,currentServer:null},servantDetailModal:{show:!1,isNew:!0,model:null},logLevels:["NONE","TARS","DEBUG","INFO","WARN","ERROR"],moreCmdModal:{show:!1,model:null,currentServer:null},expandModal:{show:!1,model:Le(),expandIpStr:""},failCount:0}},props:["treeid","servertype"],computed:{showOthers:function(){return 5===this.serverData.level},isEndpointValid:function(){return!(!this.servantDetailModal.model||!this.servantDetailModal.model.endpoint)&&this.checkServantEndpoint(this.servantDetailModal.model.endpoint)},hasCheckedServer:function(){return 0!==this.serverList.filter((function(e){return!0===e.isChecked})).length},checkedServers:function(){return this.serverList.filter((function(e){return!0===e.isChecked}))}},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.serverList.forEach((function(t){t.isChecked=e}))},$route:function(e,t){this.getServerList(),this.getServerNotifyList(1)}},methods:{getServerList:function(){var e=this,t=this.$refs.serverListLoading.$loading.show();this.$tars.getJSON("/server/api/server_list",{tree_node_id:this.treeid}).then(function(){var a=Object(fe["a"])(regeneratorRuntime.mark((function a(r){var o,n,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.hide(),r.forEach((function(e){e.isChecked=!1})),e.serverList=r,"dcache"!==e.serverType){a.next=18;break}if(o=e.serverList.length,!(o>0)){a.next=7;break}return a.abrupt("return",!1);case 7:return a.prev=7,a.next=10,e.$ajax.postJSON("/server/api/cache/removeServer",{server_name:e.treeid.split(".")[1].substr(1)});case 10:e.$parent.getTreeData(),a.next=16;break;case 13:a.prev=13,a.t0=a["catch"](7),console.error(a.t0);case 16:a.next=46;break;case 18:if("proxy"!==e.serverType){a.next=33;break}if(n=e.serverList.length,!(n>0)){a.next=22;break}return a.abrupt("return",!1);case 22:return a.prev=22,a.next=25,e.$ajax.postJSON("/server/api/cache/removeProxy",{server_name:e.treeid.split(".")[1].substr(1)});case 25:e.$parent.getTreeData(),a.next=31;break;case 28:a.prev=28,a.t1=a["catch"](22),console.error(a.t1);case 31:a.next=46;break;case 33:if("router"!==e.serverType){a.next=46;break}if(s=e.serverList.length,!(s>0)){a.next=37;break}return a.abrupt("return",!1);case 37:return a.prev=37,a.next=40,e.$ajax.postJSON("/server/api/cache/removeRouter",{server_name:e.treeid.split(".")[1].substr(1)});case 40:e.$parent.getTreeData(),a.next=46;break;case 43:a.prev=43,a.t2=a["catch"](37),console.error(a.t2);case 46:case"end":return a.stop()}}),a,null,[[7,13],[22,28],[37,43]])})));return function(e){return a.apply(this,arguments)}}()).catch((function(a){t.hide(),e.$confirm(a.err_msg||a.message||e.$t("serverList.msg.fail"),e.$t("common.alert")).then((function(){e.getServerList()}))}))},getServerNotifyList:function(e){var t=this;this.showOthers&&this.$tars.getJSON("/server/api/server_notify_list",{tree_node_id:this.treeid,page_size:this.pageSize,curr_page:e}).then((function(a){t.pageNum=e,t.total=Math.ceil(a.count/t.pageSize),t.serverNotifyList=a.rows})).catch((function(e){t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))},statusStyle:function(e){return e=e||"","restart"==e||-1!=e.indexOf("[succ]")?"color: green":"stop"==e||-1!=e.indexOf("[alarm]")||-1!=e.indexOf("error")||-1!=e.indexOf("ERROR")?"color: red":""},gotoPage:function(e){this.getServerNotifyList(e)},getTemplateList:function(){var e=this;this.$tars.getJSON("/server/api/template_name_list").then((function(t){e.configModal.model?e.configModal.model.templates=t:e.configModal.model={templates:t}})).catch((function(t){e.$tip.error("".concat(e.$t("serverList.restart.failed"),": ").concat(t.err_msg||t.message))}))},getServerConfig:function(e){var t=this,a=this.$loading.show();this.$tars.getJSON("/server/api/server",{id:e}).then((function(e){a.hide(),t.configModal.model?t.configModal.model=Object.assign({},t.configModal.model,e):(e.templates=[],t.configModal.model=e)})).catch((function(e){a.hide(),t.closeConfigModal(),t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))},configServer:function(e){this.configModal.show=!0,this.getTemplateList(),this.getServerConfig(e)},saveConfig:function(){var e=this;if(this.$refs.configForm.validate()){var t=this.$Loading.show();this.$tars.postJSON("/server/api/update_server",Object(he["a"])({isBak:this.configModal.model.bak_flag},this.configModal.model)).then((function(a){t.hide(),e.serverList=e.serverList.map((function(e){return e.id===a.id?a:e})),e.closeConfigModal(),e.$tip.success(e.$t("serverList.restart.success"))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("serverList.restart.failed"),": ").concat(a.message||a.err_msg))}))}},closeConfigModal:function(){this.$refs.configForm&&this.$refs.configForm.resetValid(),this.configModal.show=!1,this.configModal.model=null},checkTaskStatus:function(e,t){var a=this;return new Promise((function(r,o){a.$tars.getJSON("/server/api/task",{task_no:e}).then((function(t){1===t.status||0===t.status?setTimeout((function(){r(a.checkTaskStatus(e))}),3e3):2===t.status?r("taskid: ".concat(t.task_no)):o(new Error("taskid: ".concat(t.task_no)))})).catch((function(n){t?o(new Error(n.err_msg||n.message||a.$t("common.networkErr"))):setTimeout((function(){r(a.checkTaskStatus(e,!0))}),3e3)}))}))},addTask:function(e,t,a){var r=this,o=this.$Loading.show();return this.$tars.postJSON("/server/api/add_task",{serial:!0,items:[{server_id:e,command:t}]}).then((function(e){return r.checkTaskStatus(e).then((function(e){o.hide(),r.getServerList(),r.$tip.success({title:a.success,message:e})})).catch((function(e){throw e}))})).catch((function(e){o.hide(),r.getServerList(),r.$tip.error({title:a.error,message:e.err_msg||e.message||r.$t("common.networkErr")})}))},restartServer:function(e){this.addTask(e,"restart",{success:this.$t("serverList.restart.success"),error:this.$t("serverList.restart.failed")})},stopServer:function(e){var t=this;this.$confirm(this.$t("serverList.stopService.msg.stopService"),this.$t("common.alert")).then((function(){t.addTask(e,"stop",{success:t.$t("serverList.restart.success"),error:t.$t("serverList.restart.failed")})}))},undeployServer:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:r=e.id,o=e.server_name,Object(pe["a"])(e,["id","server_name"]),t.$confirm(t.$t("serverList.dlg.msg.undeploy"),t.$t("common.alert")).then(Object(fe["a"])(regeneratorRuntime.mark((function e(){var a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.serverList,n=t.serverType,!(["proxy","router"].indexOf(n)>-1&&1===a.length)){e.next=15;break}return e.next=4,t.$ajax.getJSON("/server/api/cache/hasModule",{serverType:n,serverName:o});case 4:if(s=e.sent,!s){e.next=7;break}return e.abrupt("return",t.$tip.warning(t.$t("pub.dlg.hasModule")));case 7:return e.prev=7,e.next=10,t.$confirm(t.$t("pub.dlg.cantUseApply"));case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e["catch"](7),e.abrupt("return",!1);case 15:return e.prev=15,e.next=18,t.addTask(r,"undeploy_tars",{success:t.$t("serverList.restart.success"),error:t.$t("serverList.restart.failed")});case 18:e.next=22;break;case 20:e.prev=20,e.t1=e["catch"](15);case 22:return e.prev=22,t.closeMoreCmdModal(),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[7,12],[15,20,22,25]])}))));case 2:case"end":return a.stop()}}),a)})))()},manageServant:function(e){var t=this;this.servantModal.show=!0;var a=this.$loading.show({target:this.$refs.servantModalLoading});this.$tars.getJSON("/server/api/adapter_conf_list",{id:e.id}).then((function(r){a.hide(),t.servantModal.model=r,t.servantModal.currentServer=e})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))},closeServantModal:function(){this.servantModal.show=!1,this.servantModal.model=null,this.servantModal.currentServer=null},configServant:function(e){if(this.servantDetailModal.model={application:this.servantModal.currentServer.application,server_name:this.servantModal.currentServer.server_name,obj_name:"",node_name:"",endpoint:"",servant:"",thread_num:"",max_connections:"200000",queuecap:"10000",queuetimeout:"60000",allow_ip:"",protocol:"not_tars",handlegroup:""},this.servantDetailModal.isNew=!0,e){var t=this.servantModal.model.find((function(t){return t.id===e}));t.obj_name=t.servant.split(".")[2],this.servantDetailModal.model=Object.assign({},this.servantDetailModal.model,t),this.servantDetailModal.isNew=!1}this.servantDetailModal.show=!0},closeServantDetailModal:function(){this.$refs.servantDetailForm&&this.$refs.servantDetailForm.resetValid(),this.servantDetailModal.show=!1,this.servantDetailModal.model=null},checkServantEndpoint:function(e){var t=e.split(/\s-/),a=/^tcp|udp$/i,r=/^h\s(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/i,o=/^t\s([1-9]|[1-9]\d+)$/i,n=/^p\s\d{4,5}$/i,s=!0;if(a.test(t[0])){for(var i=0,l=1;l<t.length;l++)if(r&&r.test(t[l])&&(i++,this.servantDetailModal.model.node_name=t[l].split(/\s/)[1],r=null),o&&o.test(t[l])&&(i++,o=null),n&&n.test(t[l])){var c=t[l].substring(2);c<0||c>65535||i++,n=null}s=3===i}else s=!1;return s},saveServantDetail:function(){var e=this;if(this.$refs.servantDetailForm.validate()){var t=this.$Loading.show();if(this.servantDetailModal.isNew){var a=this.servantDetailModal.model;a.servant=[a.application,a.server_name,a.obj_name].join("."),this.$tars.postJSON("/server/api/add_adapter_conf",a).then((function(a){t.hide(),e.servantModal.model.unshift(a),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}else this.servantDetailModal.model.servant=this.servantDetailModal.model.application+"."+this.servantDetailModal.model.server_name+"."+this.servantDetailModal.model.obj_name,this.$tars.postJSON("/server/api/update_adapter_conf",this.servantDetailModal.model).then((function(a){t.hide(),e.servantModal.model=e.servantModal.model.map((function(e){return e.id===a.id?a:e})),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}},deleteServant:function(e){var t=this;this.$confirm(this.$t("serverList.servant.a"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$tars.getJSON("/server/api/delete_adapter_conf",{id:e}).then((function(r){a.hide(),t.servantModal.model=t.servantModal.model.map((function(t){if(t.id!==e)return t})).filter((function(e){return e})),t.$tip.success(t.$t("common.success"))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}))},showMoreCmd:function(e){var t=this;this.moreCmdModal.model={selected:"setloglevel",setloglevel:"NONE",loadconfig:"",command:"",configs:null},this.moreCmdModal.unwatch=this.$watch("moreCmdModal.model.selected",(function(){t.$refs.moreCmdForm&&t.$refs.moreCmdForm.resetValid()})),this.moreCmdModal.show=!0,this.moreCmdModal.currentServer=e,this.$tars.getJSON("/server/api/config_file_list",{level:5,application:e.application,server_name:e.server_name}).then((function(e){t.moreCmdModal.model&&(t.moreCmdModal.model.configs=e)})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},showStatus:function(e){this.sendCommand(e,"status",!0)},sendCommand:function(e,t,a){var r=this,o=this.$Loading.show();this.$tars.getJSON("/server/api/send_command",{server_ids:e,command:t}).then((function(e){o.hide();var t=e[0].err_msg.replace(/\n/g,"<br>");if(0!==e[0].ret_code)throw new Error(t);var n={title:r.$t("common.success"),message:t};a&&(n.duration=0),r.$tip.success(n)})).catch((function(e){o.hide(),r.$tip.error({title:r.$t("common.error"),message:e.err_msg||e.message})}))},invokeMoreCmd:function(){var e=this.moreCmdModal.model,t=this.moreCmdModal.currentServer;"undeploy_tars"===e.selected?this.undeployServer(t):"setloglevel"===e.selected?this.sendCommand(t.id,"tars.setloglevel ".concat(e.setloglevel)):"loadconfig"===e.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(t.id,"tars.loadconfig ".concat(e.loadconfig)):"command"===e.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(t.id,e.command):"connection"===e.selected&&this.sendCommand(t.id,"tars.connection",!0)},closeMoreCmdModal:function(){this.$refs.moreCmdForm&&this.$refs.moreCmdForm.resetValid(),this.moreCmdModal.unwatch&&this.moreCmdModal.unwatch(),this.moreCmdModal.show=!1,this.moreCmdModal.model=null},handleNoPublishedTime:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$t("pub.dlg.unpublished");return"0000:00:00 00:00:00"===e?t:e},openExpandModal:function(e){var t=e.server_name,a=e.node_name;this.expandModal.show=!0,this.expandModal.model.server_name=t,this.expandModal.model.node_name=a},expandServerPreview:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o,n,s,i,l,c,u,d,m,p,h,f,v,g,_,b,$,k,w;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.application,o=void 0===r?"":r,n=e.server_name,s=void 0===n?"":n,i=e.set,l=void 0===i?"":i,c=e.node_name,u=void 0===c?"":c,d=e.expand_nodes,m=void 0===d?[""]:d,p=e.enable_set,h=void 0!==p&&p,f=e.set_name,v=void 0===f?"":f,g=e.set_area,_=void 0===g?"":g,b=e.set_group,$=void 0===b?"":b,k=e.copy_node_config,w=void 0!==k&&k,a.next=3,t.$tars.postJSON("/server/api/expand_server_preview",{application:o,server_name:s,set:l,node_name:u,expand_nodes:m,enable_set:h,set_name:v,set_area:_,set_group:$,copy_node_config:w});case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),a)})))()},autoPort:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.node_name,a.next=3,t.$tars.getJSON("/server/api/auto_port",{node_name:r});case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),a)})))()},expandServer:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o,n,s,i,l,c,u,d,m,p,h;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.application,o=void 0===r?"":r,n=e.server_name,s=void 0===n?"":n,i=e.set,l=void 0===i?"":i,c=e.node_name,u=void 0===c?"":c,d=e.copy_node_config,m=void 0!==d&&d,p=e.expand_preview_servers,h=void 0===p?[{bind_ip:"",node_name:"",obj_name:"",port:"",set:""}]:p,a.next=3,t.$tars.postJSON("/server/api/expand_server",{application:o,server_name:s,set:l,node_name:u,copy_node_config:m,expand_preview_servers:h});case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),a)})))()},addTaskOptions:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o,n,s,i,l,c,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.serial,o=void 0!==r&&r,n=e.elegant,s=void 0!==n&&n,i=e.eachnum,l=void 0===i?1:i,c=e.items,u=void 0===c?[{server_id:"",command:"patch_tars",parameters:{patch_id:0,bak_flag:"",group_name:""}}]:c,a.next=3,t.$tars.postJSON("/server/api/add_task",{serial:o,elegant:s,eachnum:l,items:u});case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),a)})))()},expandService:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s,i,l,c,u,d,m,p,h;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.expandForm.validate()){t.next=45;break}return a=Object.assign({},e.expandModal.model),a.expand_nodes=e.expandModal.expandIpStr.trim().split(/[,;\n]/),r=e.$Loading.show(),t.prev=4,t.next=7,e.expandServerPreview(a);case 7:if(o=t.sent,o){t.next=10;break}throw new Error(e.$t("serviceExpand.form.errTips.noneNodes"));case 10:return n=o.filter((function(t){return t.status===e.$t("serviceExpand.form.noExpand")})),s=[],i=[],n.forEach((function(e){i.push(e.bind_ip)})),t.next=16,e.autoPort({node_name:i.join(";")});case 16:return l=t.sent,l.forEach((function(t,a){e.$set(n[a],"port",String(t.port||""))})),n.forEach((function(e){s.push({bind_ip:e.bind_ip,node_name:e.node_name,obj_name:e.obj_name,port:e.port,set:e.set})})),c={application:a.application,server_name:a.server_name,set:a.set,node_name:a.node_name,copy_node_config:a.copy_node_config,expand_preview_servers:s},t.next=22,e.expandServer(c);case 22:return u=t.sent,d=u.server_conf,m={serial:!1,items:[]},p=e.serverType,h="","router"===p?h="RouterServer":"proxy"===p?h="ProxyServer":"kvcache"===p?h="KVCacheServer":"mkvcache"===p&&(h="MKVCacheServer"),d.forEach((function(e){m.items.push({server_id:e.id.toString(),command:"patch_tars",parameters:{patch_id:e.patch_version,bak_flag:e.bak_flag,update_text:"",group_name:h}})})),t.next=31,e.addTaskOptions(m);case 31:t.sent,e.$tip.success(e.$t("serviceExpand.form.errTips.success")),e.closeExpandModal(),e.getServerList(),e.getServerNotifyList(1),t.next=42;break;case 38:t.prev=38,t.t0=t["catch"](4),console.error(t.t0),e.$tip.error(t.t0);case 42:return t.prev=42,r.hide(),t.finish(42);case 45:case"end":return t.stop()}}),t,null,[[4,38,42,45]])})))()},closeExpandModal:function(){this.$refs.expandForm&&this.$refs.expandForm.resetValid(),this.expandModal.show=!1,this.expandModal.model=Le(),this.expandModal.expandIpStr=""}},created:function(){this.serverData=this.$parent.getServerData(),window.manage=this},mounted:function(){this.getServerList(),this.getServerNotifyList(1)}},Oe=De,Te=(a("6baa"),Object(h["a"])(Oe,de,me,!1,null,null,null)),qe=Te.exports,Pe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_publish"},[e.showHistory?e._e():a("div",[e.serverList&&e.serverList.length>0?a("let-table",{ref:"table",attrs:{data:e.serverList,title:e.$t("serverList.title.serverList"),"empty-msg":e.$t("common.noService")}},[a("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{value:t.row.id},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}],null,!1,1693185143)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.enableSet")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.enable_set?e.$t("common.enable"):e.$t("common.disable")))])]}}],null,!1,3878665610)}),a("let-table-column",{attrs:{title:e.$t("common.set.setName"),prop:"set_name"}}),a("let-table-column",{attrs:{title:e.$t("common.set.setArea"),prop:"set_area"}}),a("let-table-column",{attrs:{title:e.$t("common.set.setGroup"),prop:"set_group"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus")},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"==e.row.setting_state?"status-active":"status-off"})]}}],null,!1,1672821219)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus")},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"==e.row.present_state?"status-active":"status-off"})]}}],null,!1,3003743774)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"patch_version"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.time")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"word-break":"break-word"}},[e._v(e._s(e.handleNoPublishedTime(t.row.patch_time)))])]}}],null,!1,3144837894)}),a("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.totalPage,page:e.page},on:{change:e.changePage},slot:"pagination"}),a("div",{staticStyle:{"margin-left":"-15px"},attrs:{slot:"operations"},slot:"operations"},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.openPublishModal}},[e._v(e._s(e.$t("pub.btn.pub")))]),e.serverList&&e.serverList.length>0?a("let-button",{attrs:{size:"small"},on:{click:e.gotoHistory}},[e._v(" "+e._s(e.$t("pub.btn.history"))+" ")]):e._e()],1)],1):e._e(),a("let-modal",{attrs:{title:e.$t("index.rightView.tab.patch"),width:"880px",footShow:!1},on:{close:e.closePublishModal,"on-confirm":e.savePublishServer},model:{value:e.publishModal.show,callback:function(t){e.$set(e.publishModal,"show",t)},expression:"publishModal.show"}},[e.publishModal.model?a("let-form",{ref:"publishForm",attrs:{itemWidth:"100%"}},[a("let-form-item",{attrs:{label:e.$t("serverList.servant.appService")}},[e._v(" "+e._s(e.publishModal.model.application)+"·"+e._s(e.publishModal.model.server_name)+" ")]),a("let-form-item",{attrs:{label:e.$t("pub.dlg.ip")}},e._l(e.publishModal.model.serverList,(function(t){return a("div",{key:t.id},[e._v(" "+e._s(t.node_name)+" ")])})),0),"tars"==e.serverType?a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{model:{value:e.publishModal.model.update_text,callback:function(t){e.$set(e.publishModal.model,"update_text",t)},expression:"publishModal.model.update_text"}})],1):e._e(),e.patchRadioData.length>1?a("let-form-item",{attrs:{label:e.$t("pub.dlg.patchType")}},[a("let-radio-group",{attrs:{type:"button",size:"small",data:e.patchRadioData},on:{change:e.patchChange},model:{value:e.patchType,callback:function(t){e.patchType=t},expression:"patchType"}})],1):e._e(),e.publishModal.model.show?a("let-form-item",{attrs:{label:e.$t("pub.dlg.releaseVersion")}},["tars"==e.serverType?a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("pub.dlg.ab")},model:{value:e.publishModal.model.patch_id,callback:function(t){e.$set(e.publishModal.model,"patch_id",t)},expression:"publishModal.model.patch_id"}},e._l(e.publishModal.model.patchList,(function(t){return a("let-option",{key:t.id,attrs:{value:t.id}},[e._v(" "+e._s(t.id)+" | "+e._s(t.posttime)+" | "+e._s(t.comment)+" ")])})),1):e._e(),"tars"==e.serverType?a("let-button",{staticClass:"mt10",attrs:{theme:"primary",size:"small"},on:{click:e.showUploadModal}},[e._v(" "+e._s(e.$t("pub.dlg.upload"))+" ")]):e._e(),a("br"),"tars"!==e.serverType?a("let-table",{attrs:{data:e.publishModal.model.patchList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:t.row.id},model:{value:e.publishModal.publishId,callback:function(t){e.$set(e.publishModal,"publishId",t)},expression:"publishModal.publishId"}})]}}],null,!1,2512545811)}),a("let-table-column",{attrs:{title:"ID",prop:"id"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.id)+" "),a("span",{staticStyle:{color:"green",display:"inline-block",width:"1em",height:"1em"},attrs:{title:e.$t("releasePackage.default")}},[1==t.row.default_version?a("icon",{attrs:{name:"default"}}):e._e()],1)]}}],null,!1,1246507548)}),a("let-table-column",{attrs:{title:e.$t("releasePackage.moduleName"),prop:"server"}}),"kvcache"===e.serverType||"mkvcache"===e.serverType?a("let-table-column",{attrs:{title:e.$t("releasePackage.cacheType")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(1==e.serverType?"KVCache":"MKVCache"))])]}}],null,!1,3044659874)}):e._e(),a("let-table-column",{attrs:{title:e.$t("serverList.servant.comment"),prop:"comment"}}),a("let-table-column",{attrs:{title:e.$t("releasePackage.uploadTime"),prop:"posttime"}}),a("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.publishModal.totalPatchPage,page:e.publishModal.patchPage},on:{change:e.patchChangePage},slot:"pagination"})],1):e._e(),a("let-button",{staticClass:"mt10",attrs:{theme:"primary",size:"small"},on:{click:e.savePublishServer}},[e._v(e._s(e.$t("common.patch"))+" ")])],1):e._e()],1):e._e()],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.upload"),width:"880px",footShow:!1},on:{"on-cancel":e.closeUploadModal},model:{value:e.uploadModal.show,callback:function(t){e.$set(e.uploadModal,"show",t)},expression:"uploadModal.show"}},[e.uploadModal.model?a("let-form",{ref:"uploadForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.uploadPatchPackage(t)}}},[a("let-form-item",{attrs:{label:e.$t("pub.dlg.releasePkg"),itemWidth:"400px"}},[a("let-uploader",{attrs:{placeholder:e.$t("pub.dlg.defaultValue")},on:{upload:e.uploadFile}},[e._v(e._s(e.$t("common.submit"))+" ")]),e.uploadModal.model.file?a("span",[e._v(e._s(e.uploadModal.model.file.name))]):e._e()],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.uploadModal.model.comment,callback:function(t){e.$set(e.uploadModal.model,"comment",t)},expression:"uploadModal.model.comment"}})],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("serverList.servant.upload")))])],1):e._e()],1),a("PublishStatus",{ref:"publishStatus"})],1),e.showHistory?a("div",[a("let-form",{attrs:{inline:"",itemWidth:"300px"},nativeOn:{submit:function(t){return t.preventDefault(),e.getHistoryList(t)}}},[a("let-form-item",{attrs:{label:e.$t("pub.date")}},[a("let-date-range-picker",{attrs:{start:e.startTime,end:e.endTime},on:{"update:start":function(t){e.startTime=t},"update:end":function(t){e.endTime=t}}})],1),a("let-form-item",[a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))])],1)],1),a("let-table",{ref:"historyTable",attrs:{data:e.totalHistoryList,title:e.$t("historyList.title"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("serverList.servant.taskID"),prop:"task_no"}}),a("let-table-column",{attrs:{title:e.$t("historyList.table.th.c2")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.serial?e.$t("common.yes"):e.$t("common.no")))])]}}],null,!1,3636706893)}),a("let-table-column",{attrs:{title:e.$t("serverList.dlg.title.taskStatus")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.statusMap[t.row.status]||"-"))])]}}],null,!1,2337729777)}),a("let-table-column",{attrs:{title:e.$t("historyList.table.th.c4")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.viewTask(t.row.task_no)}}},[e._v(e._s(e.$t("operate.view")))])]}}],null,!1,2599542368)}),a("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.historyTotalPage,page:e.historyPage},on:{change:e.changeHistoryPage},slot:"pagination"}),a("div",{staticStyle:{"margin-left":"-15px"},attrs:{slot:"operations"},slot:"operations"},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:function(t){e.showHistory=!1}}},[e._v(e._s(e.$t("operate.goback")))])],1)],1),a("let-modal",{attrs:{title:e.$t("historyList.table.th.c4"),width:"880px",footShow:!1},on:{"on-cancel":function(t){e.taskModal.show=!1}},model:{value:e.taskModal.show,callback:function(t){e.$set(e.taskModal,"show",t)},expression:"taskModal.show"}},[e.taskModal.model?a("let-table",{attrs:{data:e.taskModal.model.items}},[a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c1"),prop:"item_no"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c2"),prop:"application"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c3"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c4"),prop:"node_name"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c5"),prop:"command"}}),a("let-table-column",{attrs:{title:e.$t("monitor.search.start"),prop:"start_time"}}),a("let-table-column",{attrs:{title:e.$t("monitor.search.end"),prop:"end_time"}}),a("let-table-column",{attrs:{title:e.$t("operate.status"),prop:"status_info"}}),a("let-table-column",{attrs:{title:e.$t("historyList.dlg.th.c7"),prop:"execute_info"}})],1):e._e()],1)],1):e._e()])},Re=[],Ie=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("let-modal",{attrs:{title:e.$t("serverList.table.th.result"),width:"70%",footShow:!1},on:{"on-cancel":e.onClose,close:e.onClose},model:{value:e.finishModal.show,callback:function(t){e.$set(e.finishModal,"show",t)},expression:"finishModal.show"}},[e.finishModal.model?a("let-table",{attrs:{title:e.$t("serverList.servant.taskID")+e.finishModal.model.task_no,data:e.finishModal.model.items}},[a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name",width:"200px"}}),a("let-table-column",{attrs:{title:e.$t("common.status"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-tag",{attrs:{theme:3==t.row.status?"success":4==t.row.status?"danger":"",checked:""}},[e._v(" "+e._s(e.statusConfig[t.row.status]+(3!=t.row.status&&4!=t.row.status?t.row.desc:""))+" ")])]}}],null,!1,3849836014)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.result"),prop:"execute_info"}})],1):e._e()],1)],1)},Ee=[],je=(a("2532"),{name:"PublishStatus",data:function(){return{closeCallback:null,timerId:null,finishModal:{show:!1,model:{task_no:"",items:[]}},statusConfig:{0:this.$t("serverList.restart.notStart"),1:this.$t("serverList.restart.preparing"),2:this.$t("serverList.restart.running"),3:this.$t("serverList.restart.success"),4:this.$t("serverList.restart.failed"),5:this.$t("serverList.restart.cancel"),6:this.$t("serverList.restart.pauseFlow")},statusMap:{0:"EM_T_NOT_START",1:"EM_T_PREPARE",2:"EM_T_RUNNING",3:"EM_T_SUCCESS",4:"EM_T_FAILED",5:"EM_T_CANCEL",6:"EM_T_PARIAL"},endStatus:[3,4]}},methods:{onClose:function(){this.closeCallback&&this.closeCallback(),clearTimeout(this.timerId)},savePublishServer:function(e,t,a,r){var o=this;a=a||"",r=r||e.model.patch_id.toString(),this.closeCallback=t;var n=[],s=e.elegant||!1;e.model.serverList.forEach((function(t){n.push({server_id:t.id.toString(),command:e.command||"patch_tars",parameters:{patch_id:r,bak_flag:t.bak_flag||!1,update_text:e.model.update_text||"",group_name:a,run_type:t.run_type||""}})}));var i=this.$Loading.show();this.$tars.postJSON("/server/api/add_task",{serial:!s,elegant:s,eachnum:e.eachnum||1,items:n}).then((function(e){i.hide(),o.finishModal.model.task_no=e,o.finishModal.show=!0,o.getTaskRepeat(e)})).catch((function(e){i.hide(),o.$tip.error("".concat(o.$t("common.error"),": ").concat(e.message||e.err_msg))}))},getTaskRepeat:function(e){var t=this;this.timerId&&clearTimeout(this.timerId);var a=function a(){t.$tars.getJSON("/server/api/task",{task_no:e}).then((function(e){var r=!0;e.items.forEach((function(e){t.endStatus.includes(e.status)||(r=!1),e.percent?e.desc="("+e.percent+"%)":e.desc="..."})),r?clearTimeout(t.timerId):t.timerId=setTimeout(a,2e3),t.finishModal.model.items=e.items})).catch((function(e){clearTimeout(t.timerId),t.timerId=null,t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))};a()}}}),Ae=je,ze=Object(h["a"])(Ae,Ie,Ee,!1,null,null,null),Fe=ze.exports,Je={name:"ServerPublish",components:{PublishStatus:Fe},data:function(){return{serverType:this.servertype||"tars",activeKey:"",treeData:[],totalServerList:[],serverList:[],isCheckedAll:!1,totalPage:0,pageSize:20,page:1,publishModal:{publishId:null,show:!1,model:null,module_name:"",application:"",totalPatchPage:0,patchPageSize:10,patchPage:1},finishModal:{show:!1,model:{task_no:"",items:[]}},statusMap:{0:"EM_T_NOT_START",1:"EM_T_PREPARE",2:"EM_T_RUNNING",3:"EM_T_SUCCESS",4:"EM_T_FAILED",5:"EM_T_CANCEL",6:"EM_T_PARIAL"},showHistory:!1,startTime:"",endTime:"",totalHistoryList:[],historyList:[],historyTotalPage:0,historyPage:1,historyPageSize:20,taskModal:{show:!1,modal:!0},uploadModal:{show:!1,model:null},patchType:"patch",patchRadioData:[{value:"patch",text:this.$t("pub.dlg.upload")}],pkgUpload:{show:!1,model:null}}},props:["treeid","servertype"],methods:{getServerList:function(){var e=this;this.$tars.getJSON("/server/api/server_list",{tree_node_id:this.treeid}).then((function(t){var a=t||[];a.forEach((function(e){e.isChecked=!1})),e.totalServerList=a,e.totalPage=Math.ceil(e.totalServerList.length/e.pageSize),e.page=1,e.updateServerList()})).catch((function(t){e.$confirm(t.err_msg||t.message||e.$t("serverList.table.msg.fail")).then((function(){e.getServerList()}))}))},changePage:function(e){this.page=e},openPublishModal:function(){var e=this,t=this.serverList.filter((function(e){return e.isChecked}));if(t.length<=0)this.$tip.warning(this.$t("pub.dlg.a"));else{var a=t[0];this.publishModal.publishId=null,this.publishModal.model={application:a.application,server_name:a.server_name,serverList:t,patchList:[],patch_id:"",update_text:"",show:!0};var r=this.serverType,o=a.server_name,n=1,s=5;"router"==r?o="RouterServer":"proxy"==r?o="ProxyServer":"dbaccess"==r?o="CombinDbAccessServer":"kvcache"==r?o="KVCacheServer":"mkvcache"==r&&(o="MKVCacheServer"),this.publishModal.module_name=o,this.publishModal.application=a.application,this.publishModal.patchPage=n,this.publishModal.patchPageSize=s,this.getPatchList(a.application,o,n,s).then((function(t){e.publishModal.model.patchList=t.rows,e.publishModal.totalPatchPage=Math.ceil(t.count/s),e.publishModal.show=!0}))}},patchChangePage:function(e){var t=this;this.publishModal.patchPage=e;var a=this.publishModal,r=a.module_name,o=a.application,n=a.patchPage,s=a.patchPageSize;this.getPatchList(o,r,n,s).then((function(e){t.publishModal.model.patchList=e.rows,t.publishModal.totalPatchPage=Math.ceil(e.count/s)}))},getPatchList:function(e,t,a,r){return this.$tars.getJSON("/server/api/server_patch_list",{application:e,module_name:t,curr_page:a,page_size:r})},closePublishModal:function(){this.publishModal.show=!1,this.publishModal.modal=null,this.patchType="patch",this.$refs.publishForm.resetValid()},savePublishServer:function(){if(this.$refs.publishForm.validate()){var e="tars"===this.serverType?this.publishModal.model.patch_id.toString():this.publishModal.publishId;if(!e)return this.$tip.warning(this.$t("pub.dlg.ab"));var t=this.serverType,a="";"router"==t?a="RouterServer":"proxy"==t?a="ProxyServer":"dbaccess"==t?a="CombinDbAccessServer":"kvcache"==t?a="KVCacheServer":"mkvcache"==t&&(a="MKVCacheServer"),this.$refs.publishStatus.savePublishServer(this.publishModal,this.closePublishModal,a,e)}},closeFinishModal:function(){this.finishModal.show=!1,this.finishModal.modal=null,this.$refs.finishForm.resetValid()},updateServerList:function(){var e=(this.page-1)*this.pageSize,t=this.page*this.pageSize;this.serverList=this.totalServerList.slice(e,t)},gotoHistory:function(){this.showHistory=!0,this.getHistoryList(1)},getHistoryList:function(e){var t=this;"number"!=typeof e&&(e=1);var a=this.$Loading.show(),r={application:this.serverList[0].application||"",server_name:this.serverList[0].server_name||"",from:this.startTime,to:this.endTime,page_size:this.historyPageSize,curr_page:e};this.historyPage=e,this.$tars.getJSON("/server/api/task_list",r).then((function(e){a.hide(),t.totalHistoryList=e.rows||[],t.historyTotalPage=Math.ceil(e.count/t.historyPageSize)})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},viewTask:function(e){var t=this;this.$tars.getJSON("/server/api/task",{task_no:e}).then((function(e){t.taskModal.model=e,t.taskModal.show=!0}))},changeHistoryPage:function(e){this.getHistoryList(e)},showUploadModal:function(){this.serverList.length<=0&&this.$tip.warning(this.$t("pub.dlg.a")),this.uploadModal.model={application:this.serverList[0].application||"",server_name:this.serverList[0].server_name||"",file:null,comment:""},this.uploadModal.show=!0},closeUploadModal:function(){this.uploadModal.show=!1,this.uploadModal.model=null,this.$refs.uploadForm.resetValid()},uploadFile:function(e){this.uploadModal.model.file=e},uploadPatchPackage:function(){var e=this;if(this.$refs.uploadForm.validate()){var t=this.$Loading.show(),a=new FormData;a.append("application",this.uploadModal.model.application),a.append("module_name",this.uploadModal.model.server_name),a.append("suse",this.uploadModal.model.file),a.append("comment",this.uploadModal.model.comment),a.append("task_id",(new Date).getTime()),this.$tars.postForm("/server/api/upload_patch_package",a).then((function(){e.getPatchList(e.uploadModal.model.application,e.uploadModal.model.server_name,1,50).then((function(a){t.hide(),e.publishModal.model.patchList=a.rows,e.closeUploadModal()}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}},handleNoPublishedTime:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$t("pub.dlg.unpublished");return"0000:00:00 00:00:00"===e?t:e},patchChange:function(){"patch"==this.patchType?this.publishModal.model.show=!0:this.publishModal.model.show=!1}},mounted:function(){this.getServerList()},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.serverList.forEach((function(t){t.isChecked=e}))},page:function(){this.updateServerList()}}},Be=Je,Ve=(a("9a61"),Object(h["a"])(Be,Pe,Re,!1,null,null,null)),Ge=Ve.exports,We=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_config"},[a("div",{staticStyle:{"margin-bottom":"5px"}},[a("h4",[e._v(" "+e._s(e.$t("cfg.title.a"))+" "),a("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.getConfigList(e.serverData)}}}),a("let-button",{staticStyle:{float:"right"},attrs:{size:"mini",theme:"primary"},on:{click:e.addConfig}},[e._v(e._s(e.$t("cfg.btn.add")))])],1)]),a("wrapper",{ref:"configListLoading"},[a("let-table",{attrs:{data:e.configList,"empty-text":e.$t("common.nodata")}},[a("let-table-column",{attrs:{width:"40px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:t.row.id},model:{value:e.checkedConfigId,callback:function(t){e.checkedConfigId=t},expression:"checkedConfigId"}},[a("span")])]}}])}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.fileName"),prop:"filename"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.lastUser"),prop:"lastuser"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"posttime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.changeConfig(t.row,"configList")}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{on:{click:function(a){return e.deleteConfig(t.row.id)}}},[e._v(e._s(e.$t("operate.delete")))]),a("let-table-operation",{on:{click:function(a){return e.showDetail(t.row)}}},[e._v(e._s(e.$t("cfg.title.viewConf")))]),a("let-table-operation",{on:{click:function(a){return e.showHistory(t.row.id)}}},[e._v(e._s(e.$t("pub.btn.history")))])]}}])})],1)],1),e.refFileList&&e.showOthers?a("div",{staticStyle:{"margin-bottom":"5px"}},[a("h4",[e._v(" "+e._s(e.$t("cfg.title.b"))+" "),a("let-button",{staticStyle:{float:"right"},attrs:{size:"mini",theme:"primary"},on:{click:e.openRefFileModal}},[e._v(e._s(e.$t("cfg.btn.addRef")))])],1)]):e._e(),e.refFileList&&e.showOthers?a("wrapper",{ref:"refFileListLoading"},[a("let-table",{attrs:{data:e.refFileList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.fileName"),prop:"filename"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"posttime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.deleteRef(t.row.id)}}},[e._v(e._s(e.$t("operate.delete")))]),a("let-table-operation",{on:{click:function(a){return e.showDetail(t.row)}}},[e._v(e._s(e.$t("operate.view")))])]}}],null,!1,3391403769)})],1)],1):e._e(),e.nodeConfigList&&e.showOthers?a("div",{staticStyle:{"margin-bottom":"5px"}},[a("h4",[e._v(" "+e._s(e.$t("cfg.title.c"))+" "),a("let-button",{staticStyle:{float:"right"},attrs:{size:"mini",theme:"primary"},on:{click:e.pushNodeConfig}},[e._v(e._s(e.$t("cfg.btn.pushFile")))])],1)]):e._e(),e.nodeConfigList&&e.showOthers?a("wrapper",{ref:"nodeConfigListLoading"},[e.nodeConfigList.length?a("let-checkbox",{staticClass:"check-all",model:{value:e.nodeCheckAll,callback:function(t){e.nodeCheckAll=t},expression:"nodeCheckAll"}}):e._e(),a("let-table",{attrs:{data:e.nodeConfigList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{width:"40px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{label:t.row.id},model:{value:e.nodeCheckList,callback:function(t){e.nodeCheckList=t},expression:"nodeCheckList"}})]}}],null,!1,3731714217)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.fileName"),prop:"filename"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"posttime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"400px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.changeConfig(t.row,"nodeConfigList")}}},[e._v(e._s(e.$t("cfg.table.modCfg")))]),a("let-table-operation",{on:{click:function(a){return e.showMergedDetail(t.row.id)}}},[e._v(e._s(e.$t("cfg.table.viewMerge")))]),a("let-table-operation",{on:{click:function(a){return e.showDetail(t.row)}}},[e._v(e._s(e.$t("cfg.table.viewIpContent")))]),a("let-table-operation",{on:{click:function(a){return e.showHistory(t.row.id)}}},[e._v(e._s(e.$t("pub.btn.history")))]),a("let-table-operation",{on:{click:function(a){return e.handleRefFiles(t.row.id)}}},[e._v(e._s(e.$t("cfg.table.mangeRefFile")))])]}}],null,!1,2593104344)})],1)],1):e._e(),a("let-modal",{attrs:{title:e.configModal.isNew?e.$t("operate.add")+" "+e.$t("common.config"):e.$t("operate.update")+" "+e.$t("common.config"),width:"80%"},on:{"on-confirm":e.configDiff,close:e.closeConfigModal,"on-cancel":e.closeConfigModal},model:{value:e.configModal.show,callback:function(t){e.$set(e.configModal,"show",t)},expression:"configModal.show"}},[e.configModal.model?a("let-form",{ref:"configForm",attrs:{itemWidth:"100%"}},[a("let-form-item",{attrs:{label:e.$t("cfg.btn.fileName"),required:""}},[a("let-input",{attrs:{size:"small",disabled:!e.configModal.isNew,required:""},model:{value:e.configModal.model.filename,callback:function(t){e.$set(e.configModal.model,"filename",t)},expression:"configModal.model.filename"}})],1),e.configModal.isNew?e._e():a("let-form-item",{attrs:{label:e.$t("cfg.btn.reason"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.configModal.model.reason,callback:function(t){e.$set(e.configModal.model,"reason",t)},expression:"configModal.model.reason"}})],1),a("let-form-item",{attrs:{label:e.$t("cfg.btn.content"),required:""}},[a("let-input",{attrs:{size:"large",type:"textarea",rows:20,required:""},model:{value:e.configContent,callback:function(t){e.configContent=t},expression:"configContent"}})],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.$t("filter.title.diffTxt"),width:"1200px"},on:{"on-confirm":e.updateConfigDiff,close:e.closeConfigDiffModal,"on-cancel":e.closeConfigDiffModal},model:{value:e.configDiffModal.show,callback:function(t){e.$set(e.configDiffModal,"show",t)},expression:"configDiffModal.show"}},[e.configDiffModal.model?a("div",{staticStyle:{"padding-top":"30px"}},[a("div",{staticClass:"codediff_head"},[a("div",{staticClass:"codediff_th"},[e._v("旧内容:")]),a("div",{staticClass:"codediff_th"},[e._v("新内容:")])]),a("diff",{attrs:{"old-string":e.configDiffModal.model.oldData,"new-string":e.configDiffModal.model.newData,context:10,"output-format":"side-by-side"}})],1):e._e()]),a("let-modal",{attrs:{title:e.detailModal.title,width:"80%",footShow:!1},on:{close:e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model&&e.detailModal.model.table?a("let-table",{staticClass:"history-table",attrs:{data:e.detailModal.model.table,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("common.time"),prop:"posttime"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.reason"),prop:"reason"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.content"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.showTableDeatil(t.row)}}},[e._v(e._s(e.$t("operate.view")))])]}}],null,!1,3817607729)})],1):e._e(),a("div",{staticClass:"pre_con"},[e.detailModal.model&&!e.detailModal.model.table||e.detailModal.model&&e.detailModal.model.table&&e.detailModal.model.detail?a("pre",[e._v(e._s(e.detailModal.model.detail||e.$t("cfg.msg.empty")))]):e._e()]),a("div",{ref:"detailModalLoading",staticClass:"detail-loading"})],1),e.refFileModal.model?a("let-modal",{attrs:{title:this.$t("operate.add"),width:"80%"},on:{"on-confirm":e.addRefFile,close:e.closeRefFileModal},model:{value:e.refFileModal.show,callback:function(t){e.$set(e.refFileModal,"show",t)},expression:"refFileModal.show"}},[a("let-form",{ref:"refForm",attrs:{itemWidth:"100%"}},[a("let-form-item",{attrs:{label:e.$t("cfg.msg.refFile"),required:""}},[a("let-select",{attrs:{size:"small",placeholder:e.$t("pub.dlg.defaultValue"),required:""},model:{value:e.refFileModal.model.filename,callback:function(t){e.$set(e.refFileModal.model,"filename",t)},expression:"refFileModal.model.filename"}},e._l(e.refFileModal.model.fileList,(function(t){return a("let-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.filename))])})),1)],1)],1)],1):e._e(),a("let-modal",{attrs:{title:e.$t("cfg.table.mangeRefFile"),width:"700",footShow:!1},on:{close:e.closeDetailModal},model:{value:e.nodeRefFileListModal.show,callback:function(t){e.$set(e.nodeRefFileListModal,"show",t)},expression:"nodeRefFileListModal.show"}},[e.nodeRefFileListModal.model?a("wrapper",[a("let-button",{staticClass:"add-btn",attrs:{size:"small",theme:"primary"},on:{click:e.openNodeRefFileModal}},[e._v(e._s(e.$t("cfg.btn.addRef")))]),a("let-table",{attrs:{data:e.nodeRefFileListModal.model.refFileList,title:e.$t("cfg.title.b"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.fileName"),prop:"filename"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"posttime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.deleteRef(t.row.id,"nodeRef",t.row.config_id)}}},[e._v(e._s(e.$t("operate.delete")))]),a("let-table-operation",{on:{click:function(a){return e.showDetail(t.row)}}},[e._v(e._s(e.$t("operate.view")))]),a("let-table-operation",{on:{click:function(a){return e.showHistory(t.row.config_id)}}},[e._v(e._s(e.$t("pub.btn.history")))])]}}],null,!1,1797373192)})],1)],1):e._e()],1),a("let-modal",{attrs:{width:"700px",footShow:!1},on:{close:e.closePushResultModal},model:{value:e.pushResultModal.show,callback:function(t){e.$set(e.pushResultModal,"show",t)},expression:"pushResultModal.show"}},[e.pushResultModal.model?a("let-table",{attrs:{data:e.pushResultModal.model,title:e.$t("serverList.table.th.result"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("serverList.table.th.service")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:0!==t.row.ret_code?"danger":"success"},[e._v(e._s(t.row.server_name))])]}}],null,!1,1546843640)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.result")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"result",class:0!==t.row.ret_code?"danger":"success"},[e._v(e._s(t.row.err_msg))])]}}],null,!1,3216099087)})],1):e._e()],1)],1)},Ke=[],He=(a("8a79"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"section"},[e._t("default")],2)}),Ue=[],Ze=(a("33c3"),{}),Ye=Object(h["a"])(Ze,He,Ue,!1,null,"2643216f",null),Qe=Ye.exports,Xe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"diff_wrap",attrs:{id:"app"}},[a("div",{directives:[{name:"highlight",rawName:"v-highlight"}],domProps:{innerHTML:e._s(e.html)}})])},et=[],tt=a("bf68"),at=a("0eda"),rt=a("1487"),ot=a.n(rt),nt=(a("eba2"),a("1257"),{props:{oldString:{type:String,default:""},newString:{type:String,default:""},context:{type:Number,default:5},outputFormat:{type:String,default:"line-by-line"}},directives:{highlight:function(e){var t=e.querySelectorAll("code");t.forEach((function(e){ot.a.highlightBlock(e)}))}},computed:{html:function(){return this.createdHtml(this.oldString,this.newString,this.context,this.outputFormat)}},methods:{createdHtml:function(e,t,a,r){function o(e){return e.replace(/<span class="d2h-code-line-ctn">(.+?)<\/span>/g,'<span class="d2h-code-line-ctn"><code>$1</code></span>')}var n=["",e,t,"","",{context:a}],s=tt["createPatch"].apply(void 0,n),i=at["Diff2Html"].getJsonFromDiff(s,{inputFormat:"diff",outputFormat:r,showFiles:!1,matching:"lines"}),l=at["Diff2Html"].getPrettyHtml(i,{inputFormat:"json",outputFormat:r,showFiles:!1,matching:"lines"});return o(l)}}}),st=nt,it=(a("f8e0"),Object(h["a"])(st,Xe,et,!1,null,null,null)),lt=it.exports,ct={name:"ServerConfig",components:{wrapper:Qe,diff:lt},data:function(){return{oldStr:"old code",newStr:"new code",serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},checkedConfigId:"",configList:[],refFileList:[],nodeConfigList:null,nodeCheckList:[],configContent:"",configModal:{show:!1,isNew:!0,model:null},configDiffModal:{type:"",show:!1,isNew:!0,model:null},detailModal:{show:!1,title:"",model:null},refFileModal:{show:!1,model:{fileList:[]}},nodeRefFileListModal:{show:!1,model:null},pushResultModal:{show:!1,model:null}}},computed:{showOthers:function(){return 5===this.serverData.level},nodeCheckAll:{get:function(){return!(!this.nodeConfigList||!this.nodeConfigList.length)&&this.nodeCheckList.length===this.nodeConfigList.length},set:function(e){this.nodeCheckList=e?this.nodeConfigList.map((function(e){return e.id})):[]}}},watch:{checkedConfigId:function(){var e=this;this.$nextTick((function(){e.getRefFileList(),e.getNodeConfigList()}))}},methods:{getConfigList:function(e){var t=this,a=this.$refs.configListLoading.$loading.show();this.$tars.getJSON("/server/api/config_file_list",e).then((function(e){a.hide(),t.configList=e,t.refFileList=[],t.nodeConfigList=[],e[0]&&e[0].id&&(t.checkedConfigId=e[0].id)})).catch((function(e){a.hide(),t.$confirm(e.err_msg||e.message||t.$t("common.error"),t.$t("common.retry"),t.$t("common.alert")).then((function(){t.getConfigList()}))}))},addConfig:function(){this.configModal.model={filename:this.serverData.server_name+".conf",config:""},""==this.serverData.server_name&&(this.configModal.model.filename=this.serverData.application+".conf"),this.configModal.isNew=!0,this.configModal.show=!0},changeConfig:function(e,t){this.configModal.model=Object.assign({reason:""},e),this.configContent=e.config,this.configModal.target=t,this.configModal.isNew=!1,this.configModal.show=!0},updateConfigFile:function(){var e=this;if(this.$refs.configForm.validate()){var t=this.$Loading.show();this.configModal.model.filename=this.configModal.model.filename.replace(/(^\s*)|(\s*$)/g,"");var a=this.configModal.model;if(this.configModal.isNew){var r=Object.assign({application:this.serverData.application,level:this.serverData.level,server_name:this.serverData.server_name,set_name:this.serverData.set_name,set_area:this.serverData.set_area,set_group:this.serverData.set_group},a);this.$tars.postJSON("/server/api/add_config_file",r).then((function(a){t.hide(),e.configList.unshift(a),1===e.configList.length&&(e.checkedConfigId=a.id),e.$tip.success(e.$t("common.success")),e.closeConfigModal(),e.closeConfigDiffModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}else this.$tars.postJSON("/server/api/update_config_file",{config:a.config,id:a.id,reason:a.reason}).then((function(a){t.hide(),e[e.configModal.target]=e[e.configModal.target].map((function(e){return e.id===a.id?a:e})),e.checkedConfigId===a.id&&(e.getRefFileList(),e.getNodeConfigList()),e.$tip.success(e.$t("common.success")),e.closeConfigModal(),e.closeConfigDiffModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}},closeConfigModal:function(){this.$refs.configForm&&this.$refs.configForm.resetValid(),this.configModal.show=!1},deleteConfig:function(e){var t=this;this.$confirm(this.$t("cfg.msg.confirmCfg"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$tars.getJSON("/server/api/delete_config_file",{id:e}).then((function(e){a.hide(),t.getConfigList(t.serverData),t.getNodeConfigList(),t.$tip.success(t.$t("common.success"))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}))},getUnusedFileList:function(e){var t=this;this.showOthers&&this.$tars.getJSON("/server/api/unused_config_file_list",{config_id:e,application:this.serverData.application}).then((function(e){t.refFileModal.model.fileList=e})).catch((function(e){t.refFileModal.model.fileList=[],t.$tip.error({title:t.$t("common.error"),message:e.err_msg||e.message||t.$t("common.networkErr")})}))},getRefFileList:function(){var e=this;if(this.showOthers){var t=this.$refs.refFileListLoading.$loading.show();this.$tars.getJSON("/server/api/config_ref_list",{config_id:this.checkedConfigId}).then((function(a){t.hide(),a.map((function(e){var t=e.id;return e=Object.assign(e,e.reference),e.refrence_id=e.id,e.id=t,e})),e.refFileList=a})).catch((function(a){t.hide(),e.refFileList=[],e.$tip.error({title:e.$t("common.error"),message:a.err_msg||a.message||e.$t("common.networkErr")})}))}},openRefFileModal:function(){this.refFileModal.show=!0,this.refFileModal.isNodeRef=!1,this.getUnusedFileList(this.checkedConfigId)},openNodeRefFileModal:function(){this.refFileModal.show=!0,this.refFileModal.isNodeRef=!0,this.getUnusedFileList(this.refFileModal.id)},addRefFile:function(){var e=this;if(this.$refs.refForm.validate()){var t=this.$Loading.show();this.$tars.getJSON("/server/api/add_config_ref",{config_id:this.refFileModal.isNodeRef?this.refFileModal.id:this.checkedConfigId,reference_id:this.refFileModal.model.filename}).then((function(a){t.hide(),e.refFileModal.show=!1,e.refFileModal.isNodeRef?e.getNodeRefFileList(e.refFileModal.id):e.getRefFileList()})).catch((function(a){t.hide(),e.$tip.error({title:e.$t("common.error"),message:a.err_msg||a.message||e.$t("common.networkErr")})}))}},closeRefFileModal:function(){this.refFileModal.show=!1},deleteRef:function(e,t,a){var r=this;this.$confirm(this.$t("cfg.msg.confirm"),this.$t("common.alert")).then((function(){var o=r.$Loading.show();r.$tars.getJSON("/server/api/delete_config_ref",{id:e}).then((function(e){o.hide(),"nodeRef"==t?r.getNodeRefFileList(a):r.getRefFileList(),r.$tip.success(r.$t("common.success"))})).catch((function(e){o.hide(),r.$tip.error({title:r.$t("common.error"),message:e.err_msg||e.message||r.$t("common.networkErr")})}))}))},getNodeConfigList:function(){var e=this;if(this.showOthers){var t=this.$refs.nodeConfigListLoading.$loading.show(),a=Object.assign({config_id:this.checkedConfigId},this.serverData);this.$tars.getJSON("/server/api/node_config_file_list",a).then((function(a){t.hide(),e.nodeConfigList=a})).catch((function(a){t.hide(),e.nodeConfigList=[],e.$tip.error({title:e.$t("common.error"),message:a.err_msg||a.message||e.$t("common.networkErr")})}))}},pushNodeConfig:function(){var e=this;if(this.nodeCheckList.length){var t=this.$Loading.show();this.$tars.getJSON("/server/api/push_config_file",{ids:this.nodeCheckList.join(";")}).then((function(a){t.hide(),e.pushResultModal.model=a,e.pushResultModal.show=!0})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}else this.$tip.warning(this.$t("cfg.msg.selectNode"))},closePushResultModal:function(){this.pushResultModal.model=null,this.pushResultModal.show=!1},showDetail:function(e){this.detailModal.title=this.$t("cfg.title.viewConf"),this.detailModal.model={detail:e.config},this.detailModal.show=!0},showMergedDetail:function(e){var t=this;this.detailModal.title=this.$t("cfg.title.viewMerged"),this.detailModal.show=!0;var a=this.$loading.show({target:this.$refs.detailModalLoading});this.$tars.getJSON("/server/api/merged_node_config",{id:e}).then((function(e){a.hide(),t.detailModal.model={detail:e}})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},showHistory:function(e){var t=this;this.detailModal.title=this.$t("cfg.title.viewHistory"),this.detailModal.show=!0;var a=this.$loading.show({target:this.$refs.detailModalLoading});this.$tars.getJSON("/server/api/config_file_history_list",{config_id:e}).then((function(e){a.hide(),t.detailModal.model={table:e.rows,detail:""}})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},showTableDeatil:function(e){this.detailModal.model.detail=e.content},closeDetailModal:function(){this.detailModal.show=!1,this.detailModal.model=null},getNodeRefFileList:function(e){var t=this;this.$tars.getJSON("/server/api/config_ref_list",{config_id:e}).then((function(e){e.map((function(e){var t=e.id;return e=Object.assign(e,e.reference),e.refrence_id=e.id,e.id=t,e})),t.nodeRefFileListModal.model={refFileList:e}})).catch((function(e){t.nodeRefFileListModal.model={refFileList:[]},t.$tip.error({title:t.$t("common.error"),message:e.err_msg||e.message||t.$t("common.networkErr")})}))},handleRefFiles:function(e){this.nodeRefFileListModal.show=!0,this.nodeRefFileListModal.model=null,this.refFileModal.id=e,this.getNodeRefFileList(e)},configDiff:function(){this.$refs.configForm.validate()&&(this.configDiffModal.type="config",this.configDiffModal.show=!0,this.configDiffModal.isNew=!1,this.configDiffModal.model={oldData:this.configModal.model.config,newData:this.configContent})},updateConfigDiff:function(){var e=this.configDiffModal.type,t=this.configModal.model;if(t.filename.toLowerCase().endsWith(".json"))try{JSON.parse(this.configContent)}catch(s){return void alert("config format error:"+s.toString())}if(t.filename.toLowerCase().endsWith(".xml"))try{var a=new DOMParser,r=a.parseFromString(this.configContent,"text/xml"),o=r.getElementsByTagName("parsererror"),n="";if(o.length>0)return n="parsererror"==r.documentElement.nodeName?r.documentElement.childNodes[0].nodeValue:r.getElementsByTagName("parsererror")[0].innerHTML,void alert("config format error:"+n)}catch(s){return void alert("config format error:"+s.toString())}"config"===e&&(this.configModal.model.config=this.configContent,this.updateConfigFile())},closeConfigDiffModal:function(){this.configDiffModal.show=!1},nodeConfigDiff:function(){this.$refs.nodeConfigForm.validate()&&(this.configDiffModal.type="nodeConfig",this.configDiffModal.show=!0,this.configDiffModal.isNew=!1,this.configDiffModal.model={oldData:this.nodeConfigModal.model.config,newData:this.nodeConfigContent})}},created:function(){this.serverData=this.$parent.getServerData()},mounted:function(){this.getConfigList(this.serverData)}},ut=ct,dt=(a("dae8"),Object(h["a"])(ut,We,Ke,!1,null,null,null)),mt=dt.exports,pt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_server_monitor"},[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{attrs:{label:e.$t("monitor.search.a")}},[a("let-date-picker",{attrs:{size:"small",formatter:e.formatter},model:{value:e.query.thedate,callback:function(t){e.$set(e.query,"thedate",t)},expression:"query.thedate"}})],1),a("let-form-item",{attrs:{label:e.$t("monitor.search.b")}},[a("let-date-picker",{attrs:{size:"small",formatter:e.formatter},model:{value:e.query.predate,callback:function(t){e.$set(e.query,"predate",t)},expression:"query.predate"}})],1),a("let-form-item",{attrs:{label:e.$t("monitor.search.start")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.startshowtime,callback:function(t){e.$set(e.query,"startshowtime",t)},expression:"query.startshowtime"}})],1),a("let-form-item",{attrs:{label:e.$t("monitor.search.end")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.endshowtime,callback:function(t){e.$set(e.query,"endshowtime",t)},expression:"query.endshowtime"}})],1),a("tars-form-item",{attrs:{label:e.$t("monitor.search.interfaceName")},on:{onLabelClick:function(t){return e.groupBy("interface_name")}}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.interface_name,callback:function(t){e.$set(e.query,"interface_name",t)},expression:"query.interface_name"}})],1),a("tars-form-item",{attrs:{label:e.$t("monitor.search.master")},on:{onLabelClick:function(t){return e.groupBy("master_name")}}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.master_name,callback:function(t){e.$set(e.query,"master_name",t)},expression:"query.master_name"}})],1),a("tars-form-item",{attrs:{label:e.$t("monitor.search.slave")},on:{onLabelClick:function(t){return e.groupBy("slave_name")}}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.slave_name,callback:function(t){e.$set(e.query,"slave_name",t)},expression:"query.slave_name"}})],1),a("tars-form-item",{attrs:{label:e.$t("monitor.search.masterIP")},on:{onLabelClick:function(t){return e.groupBy("master_ip")}}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.master_ip,callback:function(t){e.$set(e.query,"master_ip",t)},expression:"query.master_ip"}})],1),a("tars-form-item",{attrs:{label:e.$t("monitor.search.slaveIP")},on:{onLabelClick:function(t){return e.groupBy("slave_ip")}}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.slave_ip,callback:function(t){e.$set(e.query,"slave_ip",t)},expression:"query.slave_ip"}})],1),a("let-form-item",[a("el-button",{attrs:{size:"small",type:"primary",disabled:e.loading,icon:e.loading?"el-icon-loading":""},on:{click:e.search}},[e._v(e._s(e.$t("operate.search")))])],1)],1),e.showChart?a("let-row",{ref:"charts",staticClass:"charts"},e._l(e.charts,(function(t){return a("let-col",{key:t.title,attrs:{span:12}},[e.allItems.length>0?a("compare-chart",e._b({},"compare-chart",t,!1)):e._e()],1)})),1):e._e(),e.enableHourFilter?a("hours-filter",{model:{value:e.hour,callback:function(t){e.hour=t},expression:"hour"}}):e._e(),a("let-table",{ref:"table",attrs:{data:e.pagedItems,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("common.time"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.show_time||t.row.show_date))]}}])}),a("let-table-column",{attrs:{title:e.$t("monitor.search.master")},scopedSlots:e._u([{key:"default",fn:function(t){return["%"!=t.row.master_name?a("span",[e._v(e._s(t.row.master_name))]):e._e(),"%"==t.row.master_name?a("span",{staticClass:"btn-link",on:{click:function(a){return e.groupBy("master_name",t.row)}}},[e._v(e._s(t.row.master_name))]):e._e()]}}])}),a("let-table-column",{attrs:{title:e.$t("monitor.search.slave")},scopedSlots:e._u([{key:"default",fn:function(t){return["%"!=t.row.slave_name?a("span",[e._v(e._s(t.row.slave_name))]):e._e(),"%"==t.row.slave_name?a("span",{staticClass:"btn-link",on:{click:function(a){return e.groupBy("slave_name",t.row)}}},[e._v(e._s(t.row.slave_name))]):e._e()]}}])}),a("let-table-column",{attrs:{title:e.$t("monitor.search.interfaceName")},scopedSlots:e._u([{key:"default",fn:function(t){return["%"!=t.row.interface_name?a("span",[e._v(e._s(t.row.interface_name))]):e._e(),"%"==t.row.interface_name?a("span",{staticClass:"btn-link",on:{click:function(a){return e.groupBy("interface_name",t.row)}}},[e._v(e._s(t.row.interface_name))]):e._e()]}}])}),a("let-table-column",{attrs:{title:e.$t("monitor.search.masterIP")},scopedSlots:e._u([{key:"default",fn:function(t){return["%"!=t.row.master_ip?a("span",[e._v(e._s(t.row.master_ip))]):e._e(),"%"==t.row.master_ip?a("span",{staticClass:"btn-link",on:{click:function(a){return e.groupBy("master_ip",t.row)}}},[e._v(e._s(t.row.master_ip))]):e._e()]}}])}),a("let-table-column",{attrs:{title:e.$t("monitor.search.slaveIP")},scopedSlots:e._u([{key:"default",fn:function(t){return["%"!=t.row.slave_ip?a("span",[e._v(e._s(t.row.slave_ip))]):e._e(),"%"==t.row.slave_ip?a("span",{staticClass:"btn-link",on:{click:function(a){return e.groupBy("slave_ip",t.row)}}},[e._v(e._s(t.row.slave_ip))]):e._e()]}}])}),a("let-table-column",{attrs:{prop:"the_total_count",align:"right"},scopedSlots:e._u([{key:"head",fn:function(t){return a("span",{},[e._v(e._s(e.$t("monitor.table.curr"))),a("br"),e._v(e._s(e.$t("monitor.table.total")))])}}])}),a("let-table-column",{attrs:{prop:"pre_total_count",align:"right"},scopedSlots:e._u([{key:"head",fn:function(t){return a("span",{},[e._v(e._s(e.$t("monitor.table.contrast"))),a("br"),e._v(e._s(e.$t("monitor.table.total")))])}}])}),a("let-table-column",{attrs:{prop:"total_count_wave",align:"right"},scopedSlots:e._u([{key:"head",fn:function(t){return a("span",{},[e._v(e._s(e.$t("monitor.table.fluctuating")))])}}])}),a("let-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"head",fn:function(t){return a("span",{},[e._v(e._s(e.$t("monitor.table.curr"))),a("br"),e._v(e._s(e.$t("monitor.table.a")))])}},{key:"default",fn:function(t){return[e._v(e._s(t.row.the_avg_time)+"ms")]}}])}),a("let-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"head",fn:function(t){return a("span",{},[e._v(e._s(e.$t("monitor.table.contrast"))),a("br"),e._v(e._s(e.$t("monitor.table.a")))])}},{key:"default",fn:function(t){return[e._v(e._s(t.row.pre_avg_time)+"ms")]}}])}),a("let-table-column",{attrs:{prop:"the_fail_rate",align:"right"},scopedSlots:e._u([{key:"head",fn:function(t){return a("span",{},[e._v(e._s(e.$t("monitor.table.curr"))),a("br"),e._v(e._s(e.$t("monitor.table.b")))])}}])}),a("let-table-column",{attrs:{prop:"pre_fail_rate",align:"right"},scopedSlots:e._u([{key:"head",fn:function(t){return a("span",{},[e._v(e._s(e.$t("monitor.table.contrast"))),a("br"),e._v(e._s(e.$t("monitor.table.b")))])}}])}),a("let-table-column",{attrs:{prop:"the_timeout_rate",align:"right"},scopedSlots:e._u([{key:"head",fn:function(t){return a("span",{},[e._v(e._s(e.$t("monitor.table.curr"))),a("br"),e._v(e._s(e.$t("monitor.table.c")))])}}])}),a("let-table-column",{attrs:{prop:"pre_timeout_rate",align:"right"},scopedSlots:e._u([{key:"head",fn:function(t){return a("span",{},[e._v(e._s(e.$t("monitor.table.contrast"))),a("br"),e._v(e._s(e.$t("monitor.table.c")))])}}])}),e.pageCount?a("let-pagination",{attrs:{slot:"pagination",total:e.pageCount,page:e.page,sum:e.itemsCount,"show-sums":"",jump:""},on:{change:e.changePage},slot:"pagination"}):e._e()],1)],1)},ht=[],ft=(a("4d63"),1e3),vt=60*ft,gt=60*vt,_t=24*gt;function bt(e){return null==e?new Date:e instanceof Date?e:new Date(e)}function $t(e,t){if(e=bt(e),t=t||"YYYY-MM-DD HH:mm:ss",isNaN(e.getTime()))return t;var a={"M+":e.getMonth()+1,"D+":e.getDate(),"H+":e.getHours(),"h+":e.getHours()%12===0?12:e.getHours()%12,"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};return/(Y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),/(dd+)/.test(t)&&(t=t.replace(RegExp.$1,"日一二三四五六七".split("")[e.getDay()])),Object.keys(a).forEach((function(e){if(new RegExp("("+e+")").test(t)){var r=RegExp.$1,o="".concat(a[e]);t=t.replace(r,1===r.length?o:"00".concat(o).substr(o.length))}})),t}var kt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"hours-filter"},[a("h4",[e._v(e._s(e.title))]),a("ul",e._l(e.hours,(function(t){return a("li",{key:t.val,class:{active:t.val===e.value},on:{click:function(a){return e.onChange(t.val)}}},[e._v(e._s(t.txt)+" ")])})),0)])},wt=[],yt=Array.apply(null,{length:24}).map((function(e,t){return t})),Mt=yt.map((function(e){return{val:e,txt:"0".concat(e).slice(-2)}})),xt=[{val:-1,txt:"all"}].concat(Mt),St={name:"HoursFilter",props:{title:{type:String,default:""},value:Number},filters:{format:function(e){return"0".concat(e).slice(-2)}},data:function(){return{hours:xt}},methods:{onChange:function(e){this.$emit("input",e)}}},Ct=St,Nt=(a("25d5"),Object(h["a"])(Ct,kt,wt,!1,null,null,null)),Lt=Nt.exports,Dt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"compare-chart"},[a("ve-line",e._b({},"ve-line",e.chartOptions,!1)),a("a",{staticClass:"compare-chart-zoom-in",attrs:{href:"javascript:"},on:{click:function(t){e.enlarge=!0}}},[a("icon",{attrs:{name:"zoom-in"}})],1),a("let-modal",{attrs:{width:"80%"},on:{close:function(t){e.enlarge=!1}},model:{value:e.enlarge,callback:function(t){e.enlarge=t},expression:"enlarge"}},[e.enlarge?a("ve-line",e._b({},"ve-line",e.largeChartOptions,!1)):e._e(),a("div",{attrs:{slot:"foot"},slot:"foot"})],1)],1)},Ot=[],Tt=(a("627c"),a("0a6d"),a("ba1a")),qt=a.n(Tt);r["default"].component(qt.a.name,qt.a);a("0a5e");var Pt={props:{title:String,timeColumn:String,dataColumns:Array,data:Array},data:function(){return{enlarge:!1}},computed:{chartOptions:function(){var e={},t=[this.timeColumn];return this.dataColumns.forEach((function(a){var r=a.name,o=a.label;e[r]=o,t.push(r)})),{title:{show:!0,text:this.title},grid:{bottom:40,top:50},legend:{top:5},colors:["#f56c77","#6accab"],settings:{labelMap:e,scale:[!0,!1],lineStyle:{width:1}},dataZoom:[{type:"inside",show:!0,xAxisIndex:[0],zoomOnMouseWheel:!0,start:0,end:100}],data:{columns:t,rows:this.data}}},largeChartOptions:function(){var e={},t=[this.timeColumn];return this.dataColumns.forEach((function(a){var r=a.name,o=a.label;e[r]=o,t.push(r)})),{title:{show:!0,text:this.title,left:"center",top:"bottom"},grid:{bottom:40,top:50},legend:{top:5},colors:["#f56c77","#6accab"],settings:{labelMap:e,scale:[!0,!1],lineStyle:{width:1}},data:{columns:t,rows:this.data},dataZoom:[{type:"inside",minValueSpan:12,zoomOnMouseWheel:"alt"},{minValueSpan:12}]}}}},Rt=Pt,It=(a("29ab"),Object(h["a"])(Rt,Dt,Ot,!1,null,null,null)),Et=It.exports,jt=20,At="YYYYMMDD",zt=function(e){return e&&e.length>0?e.map((function(e){var t=Object(he["a"])({},e),a=Object.keys(e),r=/^pre_.*/,o=/^the_.*/;return a.forEach((function(a){(r.test(a)||o.test(a))&&"0.00%"===e[a]&&(t[a]="0")})),t})):e},Ft={name:"ServerPropertyMonitor",components:{HoursFilter:Lt,CompareChart:Et},data:function(){var e=this.treeid,t=e.split("."),a="",r=!0;return"/k8s.html"==location.pathname?(r=!0,2==t.length&&(a=t[0]+"."+t[1])):(r=!1,2==t.length?a=t[0].substring(1)+"."+t[1].substring(1):5==t.length&&(a=t[0].substring(1)+"."+t[4].substring(1)+"."+t[1].substring(1)+t[2].substring(1)+t[3].substring(1))),{loading:!1,query:{thedate:$t(new Date,"YYYYMMDD"),predate:$t(Date.now()-_t,"YYYYMMDD"),startshowtime:"0000",endshowtime:"2360",master_name:"",slave_name:a,interface_name:"",master_ip:"",slave_ip:"",group_by:"",k8s:r},formatter:At,allItems:[],hour:-1,page:1,showChart:!0}},props:["treeid"],computed:{enableHourFilter:function(){return this.allItems.length&&this.allItems[0].show_time},filteredItems:function(){var e=this.hour;return e>=0&&this.enableHourFilter?this.allItems.filter((function(t){return+t.show_time.slice(0,2)===e})):this.allItems},itemsCount:function(){return this.filteredItems.length},pageCount:function(){return Math.ceil(this.filteredItems.length/jt)},pagedItems:function(){return this.filteredItems.slice(jt*(this.page-1),jt*this.page)},charts:function(){return[{title:this.$t("monitor.table.total"),timeColumn:"show_time",dataColumns:[{name:"the_total_count",label:this.$t("monitor.table.curr")},{name:"pre_total_count",label:this.$t("monitor.table.contrast")}],data:this.allItems},{title:this.$t("monitor.table.a"),timeColumn:"show_time",dataColumns:[{name:"the_avg_time",label:this.$t("monitor.table.curr")},{name:"pre_avg_time",label:this.$t("monitor.table.contrast")}],data:this.allItems},{title:this.$t("monitor.table.b"),timeColumn:"show_time",dataColumns:[{name:"the_fail_rate",label:this.$t("monitor.table.curr")},{name:"pre_fail_rate",label:this.$t("monitor.table.contrast")}],data:this.allItems},{title:this.$t("monitor.table.c"),timeColumn:"show_time",dataColumns:[{name:"the_timeout_rate",label:this.$t("monitor.table.curr")},{name:"pre_timeout_rate",label:this.$t("monitor.table.contrast")}],data:this.allItems}]},chartOptions:function(){return{title:{show:!0,text:"".concat(this.$t("monitor.table.curr")," ").concat(this.$t("monitor.table.total"))},grid:{bottom:40,top:50},legend:{top:5},settings:{labelMap:{the_value:this.$t("monitor.property.property"),pre_value:this.$t("monitor.property.propertyC")},scale:[!0,!1]},data:{columns:["show_time","the_value","pre_value"],rows:this.allItems}}}},mounted:function(){this.fetchData()},methods:{fetchData:function(){var e=this;return this.loading=!0,this.$tars.getJSON("/server/api/stat_monitor_data",this.query).then((function(t){e.loading=!1,e.allItems=zt(t)})).catch((function(t){e.loading=!1,e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},groupBy:function(e,t){this.query.group_by=e,this.showChart=!1,t&&(t.show_time&&(this.query.startshowtime=t.show_time,this.query.endshowtime=t.show_time),t.interface_name&&"%"!=t.interface_name&&(this.query.interface_name=t.interface_name),t.master_ip&&"%"!=t.master_ip&&(this.query.master_ip=t.master_ip),t.master_name&&"%"!=t.master_name&&(this.query.master_name=t.master_name),t.slave_ip&&"%"!=t.slave_ip&&(this.query.slave_ip=t.slave_ip),t.slave_name&&"%"!=t.slave_name&&(this.query.slave_name=t.slave_name)),this.fetchData()},search:function(){delete this.query.group_by,this.showChart=!0,this.fetchData()},changePage:function(e){this.page=e}}},Jt=Ft,Bt=(a("9bdc"),Object(h["a"])(Jt,pt,ht,!1,null,null,null)),Vt=Bt.exports,Gt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_property_monitor"},[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-group",[a("let-form-item",{attrs:{label:e.$t("monitor.search.a")}},[a("let-date-picker",{attrs:{size:"small",formatter:e.formatter},model:{value:e.query.thedate,callback:function(t){e.$set(e.query,"thedate",t)},expression:"query.thedate"}})],1),a("let-form-item",{attrs:{label:e.$t("monitor.search.b")}},[a("let-date-picker",{attrs:{size:"small",formatter:e.formatter},model:{value:e.query.predate,callback:function(t){e.$set(e.query,"predate",t)},expression:"query.predate"}})],1),a("let-form-item",{attrs:{label:e.$t("monitor.search.start")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.startshowtime,callback:function(t){e.$set(e.query,"startshowtime",t)},expression:"query.startshowtime"}})],1),a("let-form-item",{attrs:{label:e.$t("monitor.search.end")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.endshowtime,callback:function(t){e.$set(e.query,"endshowtime",t)},expression:"query.endshowtime"}})],1)],1),a("let-form-group",[a("tars-form-item",{attrs:{label:e.$t("monitor.search.master")},on:{onLabelClick:function(t){return e.groupBy("master_name")}}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.master_name,callback:function(t){e.$set(e.query,"master_name",t)},expression:"query.master_name"}})],1),a("tars-form-item",{attrs:{label:e.$t("monitor.search.masterIP")},on:{onLabelClick:function(t){return e.groupBy("master_ip")}}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.master_ip,callback:function(t){e.$set(e.query,"master_ip",t)},expression:"query.master_ip"}})],1),a("tars-form-item",{attrs:{label:e.$t("monitor.select.property")},on:{onLabelClick:function(t){return e.groupBy("property_name")}}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.property_name,callback:function(t){e.$set(e.query,"property_name",t)},expression:"query.property_name"}})],1),a("tars-form-item",{attrs:{label:e.$t("monitor.select.strategy")},on:{onLabelClick:function(t){return e.groupBy("policy")}}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.policy,callback:function(t){e.$set(e.query,"policy",t)},expression:"query.policy"}})],1),a("let-form-item",[a("el-button",{attrs:{size:"small",type:"primary",disabled:e.loading,icon:e.loading?"el-icon-loading":""},on:{click:e.search}},[e._v(e._s(e.$t("operate.search")))])],1)],1)],1),e.showChart?a("compare-chart",e._b({ref:"chart",staticClass:"chart"},"compare-chart",e.chartOptions,!1)):e._e(),e.enableHourFilter?a("hours-filter",{model:{value:e.hour,callback:function(t){e.hour=t},expression:"hour"}}):e._e(),a("let-table",{ref:"table",attrs:{data:e.pagedItems,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("common.time"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.show_time||t.row.show_date))]}}])}),a("let-table-column",{attrs:{title:e.$t("monitor.search.master")},scopedSlots:e._u([{key:"default",fn:function(t){return["%"!=t.row.master_name?a("span",[e._v(e._s(t.row.master_name))]):e._e(),"%"==t.row.master_name?a("span",{staticClass:"btn-link",on:{click:function(a){return e.groupBy("master_name",t.row)}}},[e._v(e._s(t.row.master_name))]):e._e()]}}])}),a("let-table-column",{attrs:{title:e.$t("monitor.search.masterIP"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return["%"!=t.row.master_ip?a("span",[e._v(e._s(t.row.master_ip))]):e._e(),"%"==t.row.master_ip?a("span",{staticClass:"btn-link",on:{click:function(a){return e.groupBy("master_ip",t.row)}}},[e._v(e._s(t.row.master_ip))]):e._e()]}}])}),a("let-table-column",{attrs:{title:e.$t("monitor.select.property"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return["%"!=t.row.property_name?a("span",[e._v(e._s(t.row.property_name))]):e._e(),"%"==t.row.property_name?a("span",{staticClass:"btn-link",on:{click:function(a){return e.groupBy("property_name",t.row)}}},[e._v(e._s(t.row.property_name))]):e._e()]}}])}),a("let-table-column",{attrs:{title:e.$t("monitor.select.strategy"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return["%"!=t.row.policy?a("span",[e._v(e._s(t.row.policy))]):e._e(),"%"==t.row.policy?a("span",{staticClass:"btn-link",on:{click:function(a){return e.groupBy("policy",t.row)}}},[e._v(e._s(t.row.policy))]):e._e()]}}])}),a("let-table-column",{attrs:{title:e.$t("monitor.property.property"),prop:"the_value",align:"right",width:"200px"}}),a("let-table-column",{attrs:{title:e.$t("monitor.property.propertyC"),prop:"pre_value",align:"right",width:"230px"}}),e.pageCount?a("let-pagination",{attrs:{slot:"pagination",total:e.pageCount,page:e.page,sum:e.itemsCount,"show-sums":"",jump:""},on:{change:e.changePage},slot:"pagination"}):e._e()],1)],1)},Wt=[],Kt=20,Ht="YYYYMMDD",Ut={name:"ServerPropertyMonitor",components:{HoursFilter:Lt,CompareChart:Et},data:function(){var e=this.treeid,t=e.split("."),a="",r=!0;return"/k8s.html"==location.pathname?(r=!0,2==t.length&&(a=t[0]+"."+t[1])):(r=!1,2==t.length?a=t[0].substring(1)+"."+t[1].substring(1):5==_slave_name_arr.length&&(a=t[0].substring(1)+"."+t[4].substring(1)+"."+t[1].substring(1)+t[2].substring(1)+t[3].substring(1))),{query:{thedate:$t(new Date,Ht),predate:$t(Date.now()-_t,Ht),startshowtime:"0000",endshowtime:"2360",master_name:a,master_ip:"",property_name:"",policy:"",group_by:"",k8s:r},loading:!1,formatter:Ht,allItems:[],hour:-1,page:1,showChart:!0}},props:["treeid"],computed:{enableHourFilter:function(){return this.allItems.length&&this.allItems[0].show_time},filteredItems:function(){var e=this.hour;return e>=0&&this.enableHourFilter?this.allItems.filter((function(t){return+t.show_time.slice(0,2)===e})):this.allItems},itemsCount:function(){return this.filteredItems.length},pageCount:function(){return Math.ceil(this.filteredItems.length/Kt)},pagedItems:function(){return this.filteredItems.slice(Kt*(this.page-1),Kt*this.page)},chartOptions:function(){return{title:this.$t("monitor.table.total"),timeColumn:"show_time",dataColumns:[{name:"the_value",label:this.$t("monitor.property.property")},{name:"pre_value",label:this.$t("monitor.property.propertyC")}],data:this.allItems}}},mounted:function(){this.fetchData()},methods:{fetchData:function(){var e=this;return this.loading=!0,this.$tars.getJSON("/server/api/property_monitor_data",this.query).then((function(t){e.loading=!1,e.allItems=t})).catch((function(t){e.loading=!1,e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},groupBy:function(e,t){this.query.group_by=e,this.showChart=!1,t&&(t.show_time&&(this.query.startshowtime=t.show_time,this.query.endshowtime=t.show_time),t.master_name&&"%"!=t.master_name&&(this.query.master_name=t.master_name),t.master_ip&&"%"!=t.master_ip&&(this.query.master_ip=t.master_ip),t.property_name&&"%"!=t.property_name&&(this.query.property_name=t.property_name),t.policy&&"%"!=t.policy&&(this.query.policy=t.policy)),this.fetchData()},search:function(){delete this.query.group_by,this.showChart=!0,this.fetchData()},changePage:function(e){this.page=e}}},Zt=Ut,Yt=(a("49de"),Object(h["a"])(Zt,Gt,Wt,!1,null,null,null)),Qt=Yt.exports,Xt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_manage"},[a("div",{staticClass:"table_head"},[a("h4",[e._v(" "+e._s(this.$t("serverList.title.serverList"))+" "),a("i",{staticClass:"el-icon-refresh-right",on:{click:e.getServerList}})])]),e.serverList?a("let-table",{ref:"serverListLoading",attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{attrs:{value:e.isCheckedAll,change:e.checkedAllChange},model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{value:t.row.id},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}],null,!1,2423312602)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.group"),prop:"group_name"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.group_name;return[e._v(e._s(/.*?(\d+)$/.exec(a)[1]))]}}],null,!1,686932489)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{staticClass:"buttonText",attrs:{href:"/static/logview/logview.html?app=DCache&server_name="+[t.row.server_name]+"&node_name="+[t.row.node_name],title:"点击查看服务日志(view server logs)",target:"_blank"}},[e._v(" "+e._s(t.row.server_name)+" ")])]}}],null,!1,3934331726)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name",width:"125px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.area"),prop:"area",width:"45px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.zb"),width:"45px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.server_type;return["M"===r?a("span",[e._v(e._s(e.$t("cache.mainEngine")))]):"S"===r?a("span",[e._v(e._s(e.$t("cache.standByEngine")))]):"I"===r?a("span",[e._v(e._s(e.$t("cache.mirror")))]):e._e()]}}],null,!1,3355360255)}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.routerPageNo"),prop:"routerPageNo",width:"65px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus"),width:"65px"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"===e.row.setting_state?"status-active":"status-off"})]}}],null,!1,2336342142)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus"),width:"65px"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"===e.row.present_state?"status-active":"activating"===e.row.present_state?"status-activating":"status-off"})]}}],null,!1,1428767809)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.processID"),prop:"process_id",width:"65px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"patch_version",width:"45px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.time"),width:"50px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(e.handleNoPublishedTime(t.row.patch_time)))])]}}],null,!1,453975453)}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.configServer(t.row.id)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{on:{click:function(a){return e.restartServer(t.row.id)}}},[e._v(e._s(e.$t("operate.restart")))]),a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.stopServer(t.row.id)}}},[e._v(e._s(e.$t("operate.stop"))+" ")]),a("br"),a("let-table-operation",{on:{click:function(a){return e.manageServant(t.row)}}},[e._v(e._s(e.$t("operate.servant")))]),a("let-table-operation",{on:{click:function(a){return e.showMoreCmd(t.row)}}},[e._v(e._s(e.$t("operate.more")))]),a("let-table-operation",{on:{click:function(a){return e.showStatus(t.row.id)}}},[e._v(e._s(e.$t("operate.status")))])]}}],null,!1,3612068016)}),a("template",{slot:"operations"},[a("let-button",{attrs:{theme:"primary"},on:{click:e.expandHandler}},[e._v(e._s(e.$t("dcache.expand")))]),a("let-button",{attrs:{theme:"primary",disabled:!e.hasCheckedServer},on:{click:e.shrinkageHandler}},[e._v(e._s(e.$t("dcache.Shrinkage"))+" ")]),a("let-button",{attrs:{theme:"primary",disabled:!e.hasCheckedServer},on:{click:e.serverMigrationHandler}},[e._v(" "+e._s(e.$t("dcache.serverMigration"))+" ")]),e.serverList.length?a("non-server-migration",{attrs:{disabled:!e.hasCheckedServer,"expand-servers":e.serverList}}):e._e(),a("let-button",{attrs:{theme:"primary",disabled:!e.hasCheckedServer},on:{click:e.switchHandler}},[e._v(e._s(e.$t("dcache.switch"))+" ")]),a("let-button",{attrs:{theme:"primary",disabled:!e.hasCheckedServer},on:{click:e.switchMIHandler}},[e._v(e._s(e.$t("dcache.switchMirrorAsMaster"))+" ")]),a("offline",{attrs:{disabled:!e.hasCheckedServer,"server-list":e.serverList},on:{"success-fn":e.getServerList}}),a("batch-publish",{attrs:{disabled:!e.hasCheckedServer,"checked-servers":e.checkedServers},on:{"success-fn":e.getServerList}}),a("batch-operation",{attrs:{disabled:!e.hasCheckedServer,"checked-servers":e.checkedServers,type:"restart"},on:{"success-fn":e.getServerList}}),a("batch-operation",{attrs:{disabled:!e.hasCheckedServer,"checked-servers":e.checkedServers,type:"stop"},on:{"success-fn":e.getServerList}})],1)],2):e._e(),e.serverNotifyList&&e.showOthers?a("let-table",{ref:"serverNotifyListLoading",attrs:{data:e.serverNotifyList,title:e.$t("serverList.title.serverStatus"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("common.time"),prop:"notifytime"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.serviceID"),prop:"server_id"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.threadID"),prop:"thread_id"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.result"),prop:"result"}})],1):e._e(),a("let-modal",{attrs:{title:e.$t("serverList.dlg.title.editService"),width:"800px",footShow:!(!e.configModal.model||!e.configModal.model.server_name)},on:{"on-confirm":e.saveConfig,close:e.closeConfigModal,"on-cancel":e.closeConfigModal},model:{value:e.configModal.show,callback:function(t){e.$set(e.configModal,"show",t)},expression:"configModal.show"}},[e.configModal.model&&e.configModal.model.server_name?a("let-form",{ref:"configForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("common.service")}},[e._v(e._s(e.configModal.model.server_name))]),a("let-form-item",{attrs:{label:e.$t("common.ip")}},[e._v(e._s(e.configModal.model.node_name))]),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.isBackup"),required:""}},[a("let-radio-group",{attrs:{size:"small",data:[{value:!0,text:e.$t("common.yes")},{value:!1,text:e.$t("common.no")}]},model:{value:e.configModal.model.bak_flag,callback:function(t){e.$set(e.configModal.model,"bak_flag",t)},expression:"configModal.model.bak_flag"}})],1),a("let-form-item",{attrs:{label:e.$t("common.template"),required:""}},[e.configModal.model.templates&&e.configModal.model.templates.length?a("let-select",{attrs:{size:"small",required:""},model:{value:e.configModal.model.template_name,callback:function(t){e.$set(e.configModal.model,"template_name",t)},expression:"configModal.model.template_name"}},e._l(e.configModal.model.templates,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1):a("span",[e._v(e._s(e.configModal.model.template_name))])],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.serviceType"),required:""}},[a("let-select",{attrs:{size:"small",required:""},model:{value:e.configModal.model.server_type,callback:function(t){e.$set(e.configModal.model,"server_type",t)},expression:"configModal.model.server_type"}},e._l(e.serverTypes,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.th.enableSet"),required:""}},[a("let-radio-group",{attrs:{size:"small",data:[{value:!0,text:e.$t("common.enable")},{value:!1,text:e.$t("common.disable")}]},model:{value:e.configModal.model.enable_set,callback:function(t){e.$set(e.configModal.model,"enable_set",t)},expression:"configModal.model.enable_set"}})],1),e.configModal.model.enable_set?a("let-form-item",{attrs:{label:e.$t("common.set.setName"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.errMsg.setName"),required:"",pattern:"^[a-z]+$","pattern-tip":e.$t("serverList.dlg.errMsg.setName")},model:{value:e.configModal.model.set_name,callback:function(t){e.$set(e.configModal.model,"set_name",t)},expression:"configModal.model.set_name"}})],1):e._e(),e.configModal.model.enable_set?a("let-form-item",{attrs:{label:e.$t("common.set.setArea"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.errMsg.setArea"),required:"",pattern:"^[a-z]+$","pattern-tip":e.$t("serverList.dlg.errMsg.setArea")},model:{value:e.configModal.model.set_area,callback:function(t){e.$set(e.configModal.model,"set_area",t)},expression:"configModal.model.set_area"}})],1):e._e(),e.configModal.model.enable_set?a("let-form-item",{attrs:{label:e.$t("common.set.setGroup"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.errMsg.setGroup"),required:"",pattern:"^[0-9\\*]+$","pattern-tip":e.$t("serverList.dlg.errMsg.setGroup")},model:{value:e.configModal.model.set_group,callback:function(t){e.$set(e.configModal.model,"set_group",t)},expression:"configModal.model.set_group"}})],1):e._e(),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.asyncThread"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.placeholder.thread"),required:"",pattern:"tars_nodejs"===e.configModal.model.server_type?"^[1-9][0-9]*$":"^([3-9]|[1-9][0-9]+)$","pattern-tip":"$t('serverList.dlg.placeholder.thread')"},model:{value:e.configModal.model.async_thread_num,callback:function(t){e.$set(e.configModal.model,"async_thread_num",t)},expression:"configModal.model.async_thread_num"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.defaultPath")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.base_path,callback:function(t){e.$set(e.configModal.model,"base_path",t)},expression:"configModal.model.base_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.exePath")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.exe_path,callback:function(t){e.$set(e.configModal.model,"exe_path",t)},expression:"configModal.model.exe_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.startScript")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.start_script_path,callback:function(t){e.$set(e.configModal.model,"start_script_path",t)},expression:"configModal.model.start_script_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.stopScript")}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.stop_script_path,callback:function(t){e.$set(e.configModal.model,"stop_script_path",t)},expression:"configModal.model.stop_script_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.monitorScript"),itemWidth:"724px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.configModal.model.monitor_script_path,callback:function(t){e.$set(e.configModal.model,"monitor_script_path",t)},expression:"configModal.model.monitor_script_path"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.privateTemplate"),labelWidth:"150px",itemWidth:"724px"}},[a("let-input",{attrs:{size:"large",type:"textarea",rows:4},model:{value:e.configModal.model.profile,callback:function(t){e.$set(e.configModal.model,"profile",t)},expression:"configModal.model.profile"}})],1)],1):a("div",{ref:"configFormLoading",staticClass:"loading-placeholder"})],1),a("let-modal",{attrs:{title:e.$t("serverList.table.servant.title"),width:"1200px",footShow:!1},on:{close:e.closeServantModal},model:{value:e.servantModal.show,callback:function(t){e.$set(e.servantModal,"show",t)},expression:"servantModal.show"}},[a("let-button",{staticClass:"tbm16",attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.configServant()}}},[e._v(e._s(e.$t("operate.add"))+" Servant ")]),e.servantModal.model?a("let-table",{attrs:{data:e.servantModal.model,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("operate.servant"),prop:"servant"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.adress"),prop:"endpoint"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.thread"),prop:"thread_num"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.connections"),prop:"max_connections"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),prop:"queuecap"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),prop:"queuetimeout"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.configServant(t.row.id)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.deleteServant(t.row.id)}}},[e._v(e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,2485221535)})],1):a("div",{ref:"servantModalLoading",staticClass:"loading-placeholder"})],1),a("let-modal",{attrs:{title:e.servantDetailModal.isNew?e.$t("operate.add")+" Servant":e.$t("operate.update")+" Servant",width:"800px",footShow:!!e.servantDetailModal.model},on:{"on-confirm":e.saveServantDetail,close:e.closeServantDetailModal,"on-cancel":e.closeServantDetailModal},model:{value:e.servantDetailModal.show,callback:function(t){e.$set(e.servantDetailModal,"show",t)},expression:"servantDetailModal.show"}},[e.servantDetailModal.model?a("let-form",{ref:"servantDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("serverList.servant.appService"),itemWidth:"724px"}},[a("span",[e._v(e._s(e.servantDetailModal.model.application)+"·"+e._s(e.servantDetailModal.model.server_name))])]),a("let-form-item",{attrs:{label:e.$t("serverList.servant.objName"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.servant.c"),required:"","pattern-tip":e.$t("serverList.servant.obj")},model:{value:e.servantDetailModal.model.obj_name,callback:function(t){e.$set(e.servantDetailModal.model,"obj_name",t)},expression:"servantDetailModal.model.obj_name"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.numOfThread"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.servant.thread"),required:"",pattern:"^[1-9][0-9]*$","pattern-tip":e.$t("serverList.servant.thread")},model:{value:e.servantDetailModal.model.thread_num,callback:function(t){e.$set(e.servantDetailModal.model,"thread_num",t)},expression:"servantDetailModal.model.thread_num"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.servant.adress"),required:"",itemWidth:"724px"}},[a("let-input",{ref:"endpoint",attrs:{size:"small",placeholder:"tcp -h 127.0.0.1 -t 60000 -p 12000",required:"",extraTip:e.isEndpointValid?"":e.$t("serverList.servant.error")},model:{value:e.servantDetailModal.model.endpoint,callback:function(t){e.$set(e.servantDetailModal.model,"endpoint",t)},expression:"servantDetailModal.model.endpoint"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.connections"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.max_connections,callback:function(t){e.$set(e.servantDetailModal.model,"max_connections",t)},expression:"servantDetailModal.model.max_connections"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.lengthOfQueue"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.queuecap,callback:function(t){e.$set(e.servantDetailModal.model,"queuecap",t)},expression:"servantDetailModal.model.queuecap"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.queueTimeout"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.queuetimeout,callback:function(t){e.$set(e.servantDetailModal.model,"queuetimeout",t)},expression:"servantDetailModal.model.queuetimeout"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.allowIP")}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.allow_ip,callback:function(t){e.$set(e.servantDetailModal.model,"allow_ip",t)},expression:"servantDetailModal.model.allow_ip"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.protocol"),required:""}},[a("let-radio-group",{attrs:{size:"small",data:[{value:"tars",text:"TARS"},{value:"not_tars",text:e.$t("serverList.servant.notTARS")}]},model:{value:e.servantDetailModal.model.protocol,callback:function(t){e.$set(e.servantDetailModal.model,"protocol",t)},expression:"servantDetailModal.model.protocol"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.treatmentGroup"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small"},model:{value:e.servantDetailModal.model.handlegroup,callback:function(t){e.$set(e.servantDetailModal.model,"handlegroup",t)},expression:"servantDetailModal.model.handlegroup"}})],1)],1):e._e()],1),a("let-modal",{staticClass:"more-cmd",attrs:{title:e.$t("operate.more"),width:"700px"},on:{"on-confirm":e.invokeMoreCmd,close:e.closeMoreCmdModal,"on-cancel":e.closeMoreCmdModal},model:{value:e.moreCmdModal.show,callback:function(t){e.$set(e.moreCmdModal,"show",t)},expression:"moreCmdModal.show"}},[e.moreCmdModal.model?a("let-form",{ref:"moreCmdForm"},[a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"setloglevel"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.logLevel"))+" ")]),a("let-select",{attrs:{size:"small",disabled:"setloglevel"!==e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.setloglevel,callback:function(t){e.$set(e.moreCmdModal.model,"setloglevel",t)},expression:"moreCmdModal.model.setloglevel"}},e._l(e.logLevels,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"loadconfig"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.pushFile"))+" ")]),a("let-select",{attrs:{size:"small",placeholder:e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length?e.$t("pub.dlg.defaultValue"):e.$t("pub.dlg.noConfFile"),disabled:!(e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length)||"loadconfig"!==e.moreCmdModal.model.selected,required:"loadconfig"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.loadconfig,callback:function(t){e.$set(e.moreCmdModal.model,"loadconfig",t)},expression:"moreCmdModal.model.loadconfig"}},e._l(e.moreCmdModal.model.configs,(function(t){return a("let-option",{key:t.filename,attrs:{value:t.filename}},[e._v(e._s(t.filename)+" ")])})),1)],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"command"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.sendCommand"))+" ")]),a("let-input",{attrs:{size:"small",disabled:"command"!==e.moreCmdModal.model.selected,required:"command"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.command,callback:function(t){e.$set(e.moreCmdModal.model,"command",t)},expression:"moreCmdModal.model.command"}})],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"connection"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(e._s(e.$t("serverList.servant.serviceLink"))+" ")])],1)],1):e._e()],1),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!1,width:"1200px",title:e.$t("dcache.expand")},model:{value:e.expandShow,callback:function(t){e.expandShow=t},expression:"expandShow"}},[e.expandShow?a("Expand",{attrs:{"expand-servers":e.lastGroupServers},on:{close:e.expandCloseHandler}}):e._e()],1),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!1,width:"1200px",title:e.$t("dcache.serverMigration")},model:{value:e.serverMigrationShow,callback:function(t){e.serverMigrationShow=t},expression:"serverMigrationShow"}},[e.serverMigrationShow?a("server-migration",{attrs:{"check-src-group-name":e.checkSrcGroupName,"expand-servers":e.lastGroupServers},on:{close:e.serverMigrationCloseHandler}}):e._e()],1)],1)},ea=[],ta=(a("a630"),a("6062"),a("3ca3"),a("ddb0"),a("2ef0")),aa=a.n(ta),ra=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"container"},[a("let-form",{ref:"detailForm",attrs:{inline:""}},[a("let-form-group",{attrs:{inline:"","label-position":"top"}},[a("let-table",{ref:"table",attrs:{data:e.servers,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("module.name"),prop:"module_name"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.module_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("module.serverGroup"),prop:"group_name"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.group_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.server_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.serverIp"),prop:"server_ip"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",filterable:"",required:""},model:{value:t.row.server_ip,callback:function(a){e.$set(t.row,"server_ip",a)},expression:"scope.row.server_ip"}},e._l(e.nodeList,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+" ")])})),1)]}}])}),a("let-table-column",{attrs:{title:e.$t("module.deployArea"),prop:"area",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.area)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceType"),width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.server_type;return["M"===r?a("span",[e._v(e._s(e.$t("cache.mainEngine")))]):"S"===r?a("span",[e._v(e._s(e.$t("cache.standByEngine")))]):"I"===r?a("span",[e._v(e._s(e.$t("cache.mirror")))]):e._e()]}}])}),a("let-table-column",{attrs:{title:e.$t("module.memorySize"),prop:"memory"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-input",{attrs:{size:"small",placeholder:e.$t("module.shmKeyRule")},model:{value:r.memory,callback:function(t){e.$set(r,"memory",t)},expression:"row.memory"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("module.shmKey"),prop:"shmKey",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",placeholder:e.$t("module.shmKeyRule")},model:{value:t.row.shmKey,callback:function(a){e.$set(t.row,"shmKey",a)},expression:"scope.row.shmKey"}})]}}])})],1)],1),a("div",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.submitServerConfig}},[e._v(e._s(e.$t("common.submit")))]),a("div",{staticClass:"alignRight"},[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.addNewGroup}},[e._v(e._s(e.$t("serviceExpand.newGroup")))]),e._v(" "),a("let-button",{attrs:{size:"small",theme:"danger",disabled:this.servers.length===this.expandServers.length},on:{click:e.deleteGroup}},[e._v(e._s(e.$t("serviceExpand.removeGroup")))])],1)],1)],1)],1)},oa=[],na=a("bc3a"),sa=a.n(na),ia=a("4328"),la=a.n(ia),ca=sa.a.create({baseURL:"/plugins/dcache/server/api",timeout:25e3,transformRequest:[function(e,t){return"multipart/form-data"===t["Content-Type"]?e:"application/json"===t["Content-Type"]?JSON.stringify(e):la.a.stringify(e)}]});ca.interceptors.request.use((function(e){return e}),(function(e){throw new Error(e)})),ca.interceptors.response.use((function(e){var t=e.data;if(200===t.ret_code)return t.data;throw new Error(t.err_msg)}),(function(e){throw new Error(e)}));var ua=ca;function da(e){var t=e.servers,a=e.appName,r=e.moduleName,o=e.status,n=void 0===o?"1":o,s=e.cache_version,i=e.srcGroupName,l=void 0===i?[]:i,c=e.dstGroupName,u=void 0===c?[]:c;return ua({method:"post",url:"/cache/expandModule",data:{appName:a,moduleName:r,servers:t,status:n,cache_version:s,srcGroupName:l,dstGroupName:u}})}function ma(e){var t=e.servers,a=e.appName,r=e.moduleName,o=e.cache_version,n=e.srcGroupName,s=e.dstGroupName,i=e.transferData;return ua({method:"post",url:"/cache/transferDCache",data:{servers:t,appName:a,moduleName:r,cache_version:o,srcGroupName:n,dstGroupName:s,transferData:i}})}function pa(e){var t=e.appName,a=e.moduleName,r=e.srcGroupName,o=e.dstGroupName,n=e.transferData;return ua({method:"post",url:"/cache/transferDCacheGroup",data:{appName:t,moduleName:a,srcGroupName:r,dstGroupName:o,transferData:n},headers:{"Content-Type":"application/json"}})}function ha(e){var t=e.releaseId;return ua({method:"get",url:"/cache/getReleaseProgress",params:{releaseId:t}})}function fa(e){var t=e.type,a=void 0===t?"1":t;return ua({method:"get",url:"/cache/getRouterChange",params:{type:a}})}function va(e){var t=e.appName,a=e.moduleName,r=e.type,o=e.srcGroupName;return ua({method:"get",url:"/cache/hasOperation",params:{appName:t,moduleName:a,type:r,srcGroupName:o}})}function ga(e){var t=e.appName,a=void 0===t?"":t,r=e.moduleName,o=void 0===r?"":r,n=e.type,s=void 0===n?"1":n,i=e.srcGroupName,l=void 0===i?[]:i,c=e.dstGroupName,u=void 0===c?[]:c;return ua({method:"post",url:"/cache/stopTransfer",data:{appName:a,moduleName:o,type:s,srcGroupName:l,dstGroupName:u}})}function _a(e){var t=e.appName,a=void 0===t?"":t,r=e.moduleName,o=void 0===r?"":r,n=e.type,s=void 0===n?"1":n,i=e.srcGroupName,l=void 0===i?[]:i,c=e.dstGroupName,u=void 0===c?[]:c;return ua({method:"post",url:"/cache/restartTransfer",data:{appName:a,moduleName:o,type:s,srcGroupName:l,dstGroupName:u}})}function ba(e){var t=e.appName,a=void 0===t?"":t,r=e.moduleName,o=void 0===r?"":r,n=e.type,s=void 0===n?"1":n,i=e.srcGroupName,l=void 0===i?[]:i,c=e.dstGroupName,u=void 0===c?[]:c;return ua({method:"post",url:"/cache/deleteTransfer",data:{appName:a,moduleName:o,type:s,srcGroupName:l,dstGroupName:u}})}function $a(e){var t=e.appName,a=void 0===t?"":t,r=e.moduleName,o=void 0===r?"":r,n=e.srcGroupName,s=void 0===n?[]:n;return ua({method:"post",url:"/cache/reduceDcache",data:{appName:a,moduleName:o,srcGroupName:s}})}function ka(e){var t=e.appName,a=void 0===t?"":t,r=e.moduleName,o=void 0===r?"":r,n=e.groupName,s=void 0===n?"":n;return ua({method:"post",url:"/cache/switchServer",data:{appName:a,moduleName:o,groupName:s}})}function wa(e){var t=e.appName,a=void 0===t?"":t,r=e.moduleName,o=void 0===r?"":r,n=e.groupName,s=void 0===n?"":n,i=e.imageIdc,l=void 0===i?"":i;return ua({method:"post",url:"/cache/switchMIServer",data:{appName:a,moduleName:o,groupName:s,imageIdc:l}})}function ya(e){var t=e.appName,a=void 0===t?"":t,r=e.moduleName,o=void 0===r?"":r,n=e.groupName,s=void 0===n?"":n;return ua({method:"get",url:"/cache/getSwitchInfo",params:{appName:a,moduleName:o,groupName:s}})}function Ma(e){var t=e.appName,a=e.moduleName,r=e.groupName,o=e.mirrorIdc,n=e.dbFlag,s=e.enableErase;return ua({method:"post",url:"/cache/recoverMirrorStatus",data:{appName:t,moduleName:a,groupName:r,mirrorIdc:o,dbFlag:n,enableErase:s}})}function xa(e){var t=e.unType,a=e.appName,r=e.moduleName,o=e.serverNames;return ua({method:"post",url:"/cache/uninstall4DCache",data:{unType:t,appName:a,moduleName:r,serverNames:o}})}function Sa(e){var t=e.appName,a=e.moduleName;return ua({method:"get",url:"/cache/getCacheServerList",params:{appName:t,moduleName:a}})}function Ca(e){var t=e.appName,a=e.moduleName;return ua({method:"get",url:"/cache/getModuleConfig",params:{appName:t,moduleName:a}})}function Na(){return ua({method:"get",url:"/cache/getConfig"})}function La(e){var t=e.applyId,a=e.replace;return ua({method:"get",url:"/cache/install_and_publish",params:{applyId:t,replace:a}})}function Da(e){var t=e.thedate,a=e.predate,r=e.startshowtime,o=e.endshowtime,n=e.moduleName,s=e.serverName;return ua({method:"get",url:"/cache/queryProperptyData",params:{thedate:t,predate:a,startshowtime:r,endshowtime:o,moduleName:n,serverName:s}})}function Oa(e){var t=e.moduleId;return ua({method:"get",url:"/get_module_config_info",params:{moduleId:t}})}function Ta(e){var t=e.module_name;return ua({method:"get",url:"/get_module_group",params:{module_name:t}})}function qa(){return ua({method:"get",url:"/get_region_list"})}function Pa(){return ua({method:"get",url:"/routerTree"})}function Ra(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"post",url:"/routerModule/create",data:a})}function Ia(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"post",url:"/routerModule/delete",data:a})}function Ea(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"post",url:"/routerModule/update",data:a})}function ja(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"get",url:"/routerModule/find",params:a})}function Aa(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"get",url:"/routerModule/list",params:a})}function za(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"post",url:"/routerGroup/create",data:a})}function Fa(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"post",url:"/routerGroup/delete",data:a})}function Ja(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"post",url:"/routerGroup/update",data:a})}function Ba(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"get",url:"/routerGroup/find",params:a})}function Va(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"get",url:"/routerGroup/list",params:a})}function Ga(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"post",url:"/routerRecord/create",data:a})}function Wa(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"post",url:"/routerRecord/delete",data:a})}function Ka(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"post",url:"/routerRecord/update",data:a})}function Ha(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"get",url:"/routerRecord/find",params:a})}function Ua(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"get",url:"/routerRecord/list",params:a})}function Za(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"post",url:"/routerServer/create",data:a})}function Ya(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"post",url:"/routerServer/delete",data:a})}function Qa(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"post",url:"/routerServer/update",data:a})}function Xa(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"get",url:"/routerServer/find",params:a})}function er(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"get",url:"/routerServer/list",params:a})}function tr(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"post",url:"/routerTransfer/create",data:a})}function ar(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"post",url:"/routerTransfer/delete",data:a})}function rr(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"post",url:"/routerTransfer/udpate",data:a})}function or(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"get",url:"/routerTransfer/find",params:a})}function nr(e){var t=e.data,a=void 0===t?{}:t;return ua({method:"get",url:"/routerTransfer/list",params:a})}var sr={mixins:[Me],data:function(){return{nodeList:[]}},methods:{submitServerConfig:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.detailForm.validate()){t.next=15;break}return a=e.servers,r=e.appName,o=e.moduleName,n=e.cache_version,e.dstGroupName,t.prev=2,t.next=5,da({servers:a,appName:r,moduleName:o,cache_version:n,srcGroupName:[]});case 5:s=t.sent,s.releaseId,e.$tip.success(e.$t("dcache.operationManage.hasExpand")),e.$emit("close"),t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](2),console.error(t.t0),e.$tip.error(t.t0.message);case 15:case"end":return t.stop()}}),t,null,[[2,11]])})))()}},mounted:function(){var e=this;this.$tars.getJSON("/server/api/node_list").then((function(t){e.nodeList=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},created:function(){this.getServers()}},ir=sr,lr=(a("b15e"),Object(h["a"])(ir,ra,oa,!1,null,null,null)),cr=lr.exports,ur=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"container"},[a("let-form",{ref:"detailForm",attrs:{inline:""}},[a("let-form-item",{attrs:{required:"",label:e.$t("dcache.migrationMethod")}},[a("let-radio-group",{attrs:{data:e.migrationMethods},model:{value:e.transferData,callback:function(t){e.transferData=t},expression:"transferData"}})],1),a("let-form-group",{attrs:{inline:"","label-position":"top"}},[a("let-table",{ref:"table",attrs:{data:e.servers,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("module.name"),prop:"module_name"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.module_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("module.serverGroup"),prop:"group_name"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.group_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.server_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.serverIp"),prop:"server_ip"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",filterable:"",required:""},model:{value:t.row.server_ip,callback:function(a){e.$set(t.row,"server_ip",a)},expression:"scope.row.server_ip"}},e._l(e.nodeList,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+" ")])})),1)]}}])}),a("let-table-column",{attrs:{title:e.$t("module.deployArea"),prop:"area"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.area)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceType"),width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.server_type;return["M"===r?a("span",[e._v(e._s(e.$t("cache.mainEngine")))]):"S"===r?a("span",[e._v(e._s(e.$t("cache.standByEngine")))]):"I"===r?a("span",[e._v(e._s(e.$t("cache.mirror")))]):e._e()]}}])}),a("let-table-column",{attrs:{title:e.$t("module.memorySize"),prop:"memory"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-input",{attrs:{size:"small",placeholder:e.$t("module.shmKeyRule")},model:{value:r.memory,callback:function(t){e.$set(r,"memory",t)},expression:"row.memory"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("module.shmKey"),prop:"shmKey"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",placeholder:e.$t("module.shmKeyRule")},model:{value:t.row.shmKey,callback:function(a){e.$set(t.row,"shmKey",a)},expression:"scope.row.shmKey"}})]}}])})],1)],1),a("div",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.submitServerConfig}},[e._v(e._s(e.$t("common.submit")))])],1)],1)],1)},dr=[],mr={mixins:[Me],props:{checkSrcGroupName:{required:!0,type:String}},data:function(){return{nodeList:[]}},methods:{submitServerConfig:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s,i,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.detailForm.validate()){t.next=12;break}return a=e.servers,r=e.appName,o=e.moduleName,n=e.cache_version,s=e.dstGroupName,i=e.transferData,l=e.checkSrcGroupName,t.prev=2,t.next=5,ma({servers:a,appName:r,moduleName:o,cache_version:n,srcGroupName:l,dstGroupName:s,transferData:i});case 5:e.$tip.success(e.$t("dcache.operationManage.hasServerMigration")),e.$emit("close"),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](2),e.$tip.error(t.t0.message);case 12:case"end":return t.stop()}}),t,null,[[2,9]])})))()}},mounted:function(){var e=this;this.$tars.getJSON("/server/api/node_list").then((function(t){e.nodeList=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},created:function(){this.getServers()}},pr=mr,hr=Object(h["a"])(pr,ur,dr,!1,null,null,null),fr=hr.exports,vr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticStyle:{display:"inline"}},[a("let-button",{attrs:{theme:"primary",disabled:e.disabled},on:{click:e.init}},[e._v(e._s(e.$t("dcache.nonServerMigration")))]),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0,width:"1000px",title:e.$t("dcache.nonServerMigration")},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[e.show?a("let-form",{ref:"detailForm",staticClass:"non-server-migration",attrs:{labelPosition:"right"}},[a("let-form-item",{attrs:{required:"",label:e.$t("dcache.operationManage.appName")+"："}},[e._v(" "+e._s(e.appName)+" ")]),a("let-form-item",{attrs:{required:"",label:e.$t("dcache.operationManage.moduleName")+"："}},[e._v(" "+e._s(e.moduleName)+" ")]),a("let-form-item",{attrs:{required:"",label:e.$t("dcache.operationManage.srcGroupName")+"："}},[e._v(" "+e._s(e.srcGroupName)+" ")]),a("let-form-item",{attrs:{itemWidth:"100%",required:"",label:e.$t("dcache.operationManage.dstGroupName")+"："}},[a("let-select",{attrs:{required:"",size:"small"},model:{value:e.groupName,callback:function(t){e.groupName=t},expression:"groupName"}},e._l(e.dstGroupNames,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{required:"",label:e.$t("dcache.migrationMethod")+"："}},[a("let-radio-group",{staticStyle:{width:"300px"},attrs:{data:e.migrationMethods},model:{value:e.transferData,callback:function(t){e.transferData=t},expression:"transferData"}})],1),a("div",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.submitServerConfig}},[e._v(e._s(e.$t("common.submit")))])],1)],1):e._e()],1)],1)},gr=[],_r={mixins:[Me],props:{disabled:Boolean,expandServers:{required:!1,type:Array}},data:function(){return{show:!1,groupName:"",dstGroupNames:[]}},computed:{srcGroupName:function(){var e=this.expandServers.find((function(e){return e.isChecked}));return e.group_name}},methods:{init:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s,i,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e.groupName="",a=e.expandServers.map((function(e){return e.group_name})),a=Array.from(new Set(a)),1!==a.length){t.next=6;break}return t.abrupt("return",e.$tip.error(e.$t("dcache.onlyOneServiceGroup")));case 6:if(r=e.expandServers.filter((function(e){return e.isChecked})),o=r.map((function(e){return e.group_name})),o=Array.from(new Set(o)),!(o.length>1)){t.next=11;break}return t.abrupt("return",e.$tip.error(e.$t("dcache.oneGroup")));case 11:return e.dstGroupNames=a.filter((function(e){return e!==o[0]})),n=e.appName,s=e.moduleName,i=e.srcGroupName,t.next=15,va({appName:n,moduleName:s,srcGroupName:i});case 15:if(l=t.sent,!l){t.next=18;break}throw new Error(e.$t("dcache.hasMigrationOperation"));case 18:e.show=!0,t.next=25;break;case 21:t.prev=21,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 25:case"end":return t.stop()}}),t,null,[[0,21]])})))()},submitServerConfig:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.detailForm.validate()){t.next=13;break}return t.prev=1,a=e.appName,r=e.moduleName,o=e.srcGroupName,n=e.groupName,s=e.transferData,t.next=5,pa({appName:a,moduleName:r,srcGroupName:o,dstGroupName:n,transferData:s});case 5:t.sent,e.$tip.success(e.$t("dcache.operationManage.hasnonServerMigration")),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),console.error(t.t0),e.$tip.error(t.t0.message);case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()}}},br=_r,$r=(a("a6f4"),Object(h["a"])(br,vr,gr,!1,null,null,null)),kr=$r.exports,wr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"batch-publish",staticStyle:{display:"inline"}},[a("let-button",{attrs:{theme:"primary",disabled:e.disabled},on:{click:e.init}},[e._v(e._s(e.$t("dcache.batchPublish")))]),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0,width:"1000px",title:e.$t("dcache.batchPublish")},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("let-form",[a("let-form-item",{attrs:{label:e.$t("service.serverName")}},e._l(e.checkedServers,(function(t){return a("p",[e._v(e._s(t.server_name))])})),0)],1),a("let-table",{attrs:{data:e.versionList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:t.row.id},model:{value:e.publishId,callback:function(t){e.publishId=t},expression:"publishId"}})]}}])}),a("let-table-column",{attrs:{title:"ID",prop:"id"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.id)+" "),a("span",{staticStyle:{color:"green",display:"inline-block",width:"1em",height:"1em"},attrs:{title:e.$t("releasePackage.default")}},[1==t.row.default_version?a("icon",{attrs:{name:"default"}}):e._e()],1)]}}])}),a("let-table-column",{attrs:{title:e.$t("releasePackage.moduleName"),prop:"server"}}),a("let-table-column",{attrs:{title:e.$t("releasePackage.cacheType")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(1===t.row.package_type?"KVCache":"MKVCache"))])]}}])}),a("let-table-column",{attrs:{title:e.$t("serverList.servant.comment"),prop:"comment"}}),a("let-table-column",{attrs:{title:e.$t("releasePackage.uploadTime"),prop:"posttime"}}),a("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.publishModal.totalPatchPage,page:e.publishModal.currPage},on:{change:e.patchChangePage},slot:"pagination"},[e._v(" abc ")]),a("template",{slot:"operations"},[a("let-button",{attrs:{disabled:!e.publishId,theme:"primary"},on:{click:e.publish}},[e._v(e._s(e.$t("apply.publish")))])],1)],2)],1),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0,width:"1000px",title:e.$t("dcache.batchPublish")},model:{value:e.releaseIng,callback:function(t){e.releaseIng=t},expression:"releaseIng"}},[e.releaseId&&e.releaseIng?a("tars-release-progress",{attrs:{"release-id":e.releaseId},on:{"close-fn":this.getServerList}}):e._e()],1)],1)},yr=[],Mr={components:{tarsReleaseProgress:ye},mixins:[Me],props:{disabled:Boolean,expandServers:{required:!1,type:Array},checkedServers:{required:!1,type:Array}},computed:{cacheVersion:function(){return this.checkedServers.length?this.checkedServers[0].cache_version:1}},data:function(){return{versionList:[],releaseId:null,show:!1,publishId:null,publishModal:{moduleName:"",application:"DCache",totalPatchPage:0,pageSize:5,currPage:1},releaseIng:!1}},methods:{init:function(){this.show=!0,this.releaseId=null,this.releaseIng=!1,this.publishId=null,this.getVersionList()},patchChangePage:function(e){this.publishModal.currPage=e,this.getVersionList()},serverPatchList:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o,n,s,i,l,c,u,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.application,o=void 0===r?"DCache":r,n=e.moduleName,s=void 0===n?"":n,i=e.currPage,l=void 0===i?1:i,c=e.pageSize,u=void 0===c?5:c,d=e.cacheVersion,a.next=3,t.$tars.getJSON("/server/api/server_patch_list",{application:o,module_name:s,curr_page:l,page_size:u,package_type:d});case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),a)})))()},getVersionList:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s,i,l,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.cacheVersion,r=e.publishModal,o=r.application,n=r.currPage,s=r.pageSize,t.next=4,e.serverPatchList({moduleName:1==e.cacheVersion?"KVCacheServer":"MKVCacheServer",application:o,currPage:n,pageSize:s,cacheVersion:a});case 4:i=t.sent,l=i.count,c=i.rows,e.publishModal.totalPatchPage=Math.ceil(l/s),e.versionList=c;case 9:case"end":return t.stop()}}),t)})))()},addTask:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o,n,s,i,l,c,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.serial,o=void 0!==r&&r,n=e.elegant,s=void 0!==n&&n,i=e.eachnum,l=void 0===i?1:i,c=e.items,u=void 0===c?[{server_id:"",command:"patch_tars",parameters:{patch_id:0,bak_flag:"",group_name:""}}]:c,a.next=3,t.$tars.postJSON("/server/api/add_task",{serial:o,elegant:s,eachnum:l,items:u});case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),a)})))()},publish:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=[],r=e.publishId,o=e.checkedServers,o.forEach((function(e){a.push({server_id:e.id.toString(),command:"patch_tars",parameters:{patch_id:r,bak_flag:e.bak_flag,update_text:"batch publish cache servers",group_name:1==e.cache_version?"KVCacheServer":"MKVCacheServer"}})})),t.next=5,e.addTask({items:a});case 5:n=t.sent,e.releaseIng=!0,e.releaseId=n;case 8:case"end":return t.stop()}}),t)})))()},getServerList:function(){this.show=!1,this.$emit("success-fn")}}},xr=Mr,Sr=(a("5979"),Object(h["a"])(xr,wr,yr,!1,null,null,null)),Cr=Sr.exports,Nr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticStyle:{display:"inline"}},[a("let-button",{attrs:{theme:"primary",disabled:e.disabled},on:{click:e.init}},[e._v(e._s(e.$t("dcache.offline")))]),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0,width:"1000px",title:e.$t("dcache.offline")},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("p",{staticStyle:{color:"red"}},[e._v(" "+e._s(e.hasRouterPageNo?e.$t("dcache.hasRouterPageNo"):"")+e._s(e.canOffline?"":e.$t("dcache.cantOffline"))+" ")]),a("let-table",{ref:"table",attrs:{data:e.offlineServers,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("module.name"),prop:"module_name"}}),a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("service.serverIp"),prop:"node_name"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.routerPageNo"),prop:"routerPageNo"}})],1),a("let-button",{attrs:{disabled:!e.canOffline,size:"small",theme:"primary"},on:{click:e.sureOffline}},[e._v(" "+e._s(e.$t("dcache.sureOffline"))+" ")])],1)],1)},Lr=[],Dr={props:{disabled:Boolean,serverList:Array},data:function(){return{show:!1,offlineServers:[],tip:"",unType:0,canOffline:!1}},computed:{checkedServers:function(){return this.serverList.filter((function(e){return!0===e.isChecked}))},hasRouterPageNo:function(){return!!this.checkedServers.find((function(e){return 0!==e.routerPageNo}))},appName:function(){return this.checkedServers[0]&&this.checkedServers[0].app_name},moduleName:function(){return this.checkedServers[0]&&this.checkedServers[0].module_name},hostServers:function(){return this.checkedServers.filter((function(e){return"M"===e.server_type}))},backupServers:function(){return this.checkedServers.filter((function(e){return"S"===e.server_type}))},allBackupServers:function(){return this.serverList.filter((function(e){return"S"===e.server_type}))},mirrorServers:function(){return this.checkedServers.filter((function(e){return"I"===e.server_type}))},allMirrorServers:function(){return this.serverList.filter((function(e){return"I"===e.server_type}))},allBackupMirrorServers:function(){return this.serverList.filter((function(e){return"M"!==e.server_type}))}},methods:{init:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.offlineServers=[],e.unType=0,e.canOffline=!1,e.$t,e.hostServers,e.backupServers,e.allBackupServers,e.mirrorServers,e.allMirrorServers,e.allBackupMirrorServers,a=e.appName,r=e.moduleName,t.next=7,va({appName:a,moduleName:r});case 7:if(o=t.sent,!o){t.next=10;break}throw new Error(e.$t("dcache.hasMigrationOperation"));case 10:e.offlineServers=e.checkedServers,n=e.getActiveServers(),n.length||(e.canOffline=!0),e.show=!0,t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 20:case"end":return t.stop()}}),t,null,[[0,16]])})))()},getActiveServers:function(){return this.offlineServers.filter((function(e){return"active"===e.present_state||"active"===e.setting_state}))},sureOffline:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s,i,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.offlineServers,r=e.unType,o=a.map((function(e){return"DCache.".concat(e.server_name)})),n=a[0].app_name,s=a[0].module_name,i={unType:r,appName:n,moduleName:s,serverNames:o},l=e.$Loading({text:"loading..."}),l.show(),t.prev=7,t.next=10,xa(i);case 10:t.sent,e.$tip.success("下线成功!"),e.show=!1,e.$emit("success-fn"),t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](7),e.$tip.error(t.t0.message);case 19:return t.prev=19,l.hide(),t.finish(19);case 22:case"end":return t.stop()}}),t,null,[[7,16,19,22]])})))()}}},Or=Dr,Tr=Object(h["a"])(Or,Nr,Lr,!1,null,null,null),qr=Tr.exports,Pr={components:{Expand:cr,ServerMigration:fr,nonServerMigration:kr,offline:qr,batchPublish:Cr,batchOperation:Ne},name:"ServerManage",data:function(){return{expandShow:!1,serverMigrationShow:!1,nonServerMigrationShow:!1,lastGroupServers:[],isCheckedAll:!1,serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""},serverList:[],serverNotifyList:[],pageNum:1,pageSize:20,total:1,serverTypes:["tars_cpp","tars_java","tars_php","tars_nodejs","not_tars","tars_go"],configModal:{show:!1,model:null},servantModal:{show:!1,model:null,currentServer:null},servantDetailModal:{show:!1,isNew:!0,model:null},logLevels:["NONE","TARS","DEBUG","INFO","WARN","ERROR"],moreCmdModal:{show:!1,model:null,currentServer:null},failCount:0}},props:["treeid"],computed:{showOthers:function(){return 5===this.serverData.level},isEndpointValid:function(){return!(!this.servantDetailModal.model||!this.servantDetailModal.model.endpoint)&&this.checkServantEndpoint(this.servantDetailModal.model.endpoint)},hasCheckedServer:function(){return 0!==this.serverList.filter((function(e){return!0===e.isChecked})).length},checkedServers:function(){return this.serverList.filter((function(e){return!0===e.isChecked}))},checkSrcGroupName:function(){return this.checkedServers[0]&&this.checkedServers[0].group_name}},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.serverList.forEach((function(t){t.isChecked=e}))},$route:function(e,t){this.getServerList(),this.getServerNotifyList(1)}},methods:{expandCloseHandler:function(){this.expandShow=!1,this.getServerList()},serverMigrationCloseHandler:function(){this.serverMigrationShow=!1,this.getServerList()},expandHandler:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,a=e.checkPatchVersion(),a){t.next=4;break}throw new Error(e.$t("dcache.noTheSamePatchVersion"));case 4:return r=e.serverList[0],o=r.app_name,n=r.module_name,t.next=8,va({appName:o,moduleName:n});case 8:if(s=t.sent,!s){t.next=11;break}throw new Error(e.$t("dcache.hasExpandOperation"));case 11:e.lastGroupServers=e.getLastGroupServers(),e.expandShow=!0,t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 18:case"end":return t.stop()}}),t,null,[[0,15]])})))()},shrinkageHandler:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s,i,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=e.serverList[0],r=a.app_name,o=a.module_name,t.next=5,va({appName:r,moduleName:o});case 5:if(n=t.sent,!n){t.next=8;break}throw new Error(e.$t("dcache.hasShrinkageOperation"));case 8:if(s=e.serverList.map((function(e){return e.group_name})),s=Array.from(new Set(s)),i=e.serverList.filter((function(e){return e.isChecked})),l=i.map((function(e){return e.group_name})),l=Array.from(new Set(l)),s.toString()!==l.toString()){t.next=15;break}throw new Error(e.$t("dcache.leaveOneServiceGroup"));case 15:return t.next=17,e.$confirm(e.$t("dcache.operationManage.ensureShrinkage"));case 17:return t.next=19,$a({appName:r,moduleName:o,srcGroupName:l});case 19:e.$tip.success(e.$t("dcache.operationManage.hasShrinkage")),t.next=26;break;case 22:t.prev=22,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 26:case"end":return t.stop()}}),t,null,[[0,22]])})))()},serverMigrationHandler:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s,i,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,a=e.checkPatchVersion(),a){t.next=4;break}throw new Error(e.$t("dcache.noTheSamePatchVersion"));case 4:if(r=aa.a.uniqBy(e.checkedServers,"group_name"),!(r.length>1)){t.next=7;break}throw new Error(e.$t("dcache.oneGroup"));case 7:return o=e.checkedServers[0],n=o.app_name,s=o.module_name,i=o.group_name,t.next=11,va({appName:n,moduleName:s,srcGroupName:i});case 11:if(l=t.sent,!l){t.next=14;break}throw new Error(e.$t("dcache.hasMigrationOperation"));case 14:e.lastGroupServers=e.getLastGroupServers(),e.serverMigrationShow=!0,t.next=22;break;case 18:t.prev=18,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 22:case"end":return t.stop()}}),t,null,[[0,18]])})))()},switchHandler:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,a=e.serverList[0],r=a.app_name,o=a.module_name,n=e.serverList.filter((function(e){return e.isChecked})),s=n.map((function(e){return e.group_name})),s=Array.from(new Set(s)),1==s.length){t.next=8;break}throw new Error(e.$t("dcache.operationManage.onceSwitch"));case 8:return t.next=10,e.$confirm(e.$t("dcache.operationManage.ensureSwitch"));case 10:return t.next=12,ka({appName:r,moduleName:o,groupName:s[0]});case 12:e.$tip.success(e.$t("dcache.operationManage.switchSuccess")),e.getServerList(),t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 20:case"end":return t.stop()}}),t,null,[[0,16]])})))()},switchMIHandler:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s,i,l,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,a=e.serverList[0],r=a.app_name,o=a.module_name,n=e.serverList.filter((function(e){return e.isChecked})),s=n.map((function(e){return e.group_name})),s=Array.from(new Set(s)),1==s.length){t.next=8;break}throw new Error(e.$t("dcache.operationManage.onceSwitch"));case 8:for(console.log("==>servers:",n),i="",l="active",c=0;c<n.length;c++)"I"==n[c].server_type?i=n[c].area:"M"==n[c].server_type&&(l=n[c].setting_state);if(""!=i){t.next=14;break}throw new Error(e.$t("dcache.operationManage.switchMINoImage"));case 14:if("inactive"==l){t.next=16;break}throw new Error(e.$t("dcache.operationManage.switchMIMasterNotInactive"));case 16:return t.next=18,e.$confirm(e.$t("dcache.operationManage.ensureSwitchMI")+i);case 18:return t.next=20,wa({appName:r,moduleName:o,groupName:s[0],imageIdc:i});case 20:e.$tip.success(e.$t("dcache.operationManage.switchSuccess")),e.getServerList(),t.next=28;break;case 24:t.prev=24,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 28:case"end":return t.stop()}}),t,null,[[0,24]])})))()},getLastGroupServers:function(){var e=this.serverList.sort((function(e,t){return e.group_name>t.group_name}))[this.serverList.length-1].group_name;return this.serverList.filter((function(t){return t.group_name===e}))},checkPatchVersion:function(){var e=!0,t={},a=this.serverList.filter((function(e){return!0===e.isChecked}));return a.forEach((function(a,r){var o=a.patch_version;if(0===r)return t[o]=o;t[o]||(e=!1)})),e},checkedAllChange:function(){},getServerList:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.$refs.serverListLoading.$loading.show(),t.prev=1,r=e.treeid&&e.treeid.split(".")||[],o=r[0]&&r[0].substring(1)||"",n=r[1]&&r[1].substring(1)||"",o&&n){t.next=7;break}return t.abrupt("return");case 7:return t.next=9,Sa({appName:o,moduleName:n});case 9:s=t.sent,s.forEach((function(t){var a=e.serverList.find((function(e){return e.id===t.id}));t.isChecked=!!a&&a.isChecked})),e.serverList=s.sort((function(e,t){return e.group_name<t.group_name?-1:e.group_name==t.group_name?0:1})),t.next=18;break;case 14:t.prev=14,t.t0=t["catch"](1),console.error(t.t0),e.$tip.error(t.t0.message);case 18:return t.prev=18,a.hide(),t.finish(18);case 21:case"end":return t.stop()}}),t,null,[[1,14,18,21]])})))()},getServerNotifyList:function(e){var t=this;if(this.showOthers){var a=this.$refs.serverNotifyListLoading.$loading.show();this.$tars.getJSON("/server/api/server_notify_list",{tree_node_id:this.treeid,page_size:this.pageSize,curr_page:e}).then((function(r){a.hide(),t.pageNum=e,t.total=Math.ceil(r.count/t.pageSize),t.serverNotifyList=r.rows})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))}},getTemplateList:function(){var e=this;this.$tars.getJSON("/server/api/template_name_list").then((function(t){e.configModal.model?e.configModal.model.templates=t:e.configModal.model={templates:t}})).catch((function(t){e.$tip.error("".concat(e.$t("serverList.restart.failed"),": ").concat(t.err_msg||t.message))}))},getServerConfig:function(e){var t=this,a=this.$loading.show({target:this.$refs.configFormLoading});this.$tars.getJSON("/server/api/server",{id:e}).then((function(e){a.hide(),t.configModal.model?t.configModal.model=Object.assign({},t.configModal.model,e):(e.templates=[],t.configModal.model=e)})).catch((function(e){a.hide(),t.closeConfigModal(),t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))},configServer:function(e){this.configModal.show=!0,this.getTemplateList(),this.getServerConfig(e)},saveConfig:function(){var e=this;if(this.$refs.configForm.validate()){var t=this.$Loading.show();this.$tars.postJSON("/server/api/update_server",Object(he["a"])({isBak:this.configModal.model.bak_flag},this.configModal.model)).then((function(a){t.hide(),e.serverList=e.serverList.map((function(e){return e.id===a.id?a:e})),e.closeConfigModal(),e.$tip.success(e.$t("serverList.restart.success"))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("serverList.restart.failed"),": ").concat(a.message||a.err_msg))}))}},closeConfigModal:function(){this.$refs.configForm&&this.$refs.configForm.resetValid(),this.configModal.show=!1,this.configModal.model=null},checkTaskStatus:function(e,t){var a=this;return new Promise((function(r,o){a.$tars.getJSON("/server/api/task",{task_no:e}).then((function(t){1===t.status||0===t.status?setTimeout((function(){r(a.checkTaskStatus(e))}),3e3):2===t.status?r("taskid: ".concat(t.task_no)):o(new Error("taskid: ".concat(t.task_no)))})).catch((function(n){t?o(new Error(n.err_msg||n.message||a.$t("common.networkErr"))):setTimeout((function(){r(a.checkTaskStatus(e,!0))}),3e3)}))}))},addTask:function(e,t,a){var r=this,o=this.$Loading.show();this.$tars.postJSON("/server/api/add_task",{serial:!0,items:[{server_id:e,command:t}]}).then((function(e){return r.checkTaskStatus(e).then((function(e){o.hide(),r.getServerList(),r.$tip.success({title:a.success,message:e})})).catch((function(e){throw e}))})).catch((function(e){o.hide(),r.getServerList(),r.$tip.error({title:a.error,message:e.err_msg||e.message||r.$t("common.networkErr")})}))},restartServer:function(e){this.addTask(e,"restart",{success:this.$t("serverList.restart.success"),error:this.$t("serverList.restart.failed")})},stopServer:function(e){var t=this;this.$confirm(this.$t("serverList.stopService.msg.stopService"),this.$t("common.alert")).then((function(){t.addTask(e,"stop",{success:t.$t("serverList.restart.success"),error:t.$t("serverList.restart.failed")})}))},undeployServer:function(e){var t=this;this.$confirm(this.$t("serverList.dlg.msg.undeploy"),this.$t("common.alert")).then((function(){t.addTask(e,"undeploy_tars",{success:t.$t("serverList.restart.success"),error:t.$t("serverList.restart.failed")}),t.closeMoreCmdModal()}))},manageServant:function(e){var t=this;this.servantModal.show=!0;var a=this.$loading.show({target:this.$refs.servantModalLoading});this.$tars.getJSON("/server/api/adapter_conf_list",{id:e.id}).then((function(r){a.hide(),t.servantModal.model=r,t.servantModal.currentServer=e})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))},closeServantModal:function(){this.servantModal.show=!1,this.servantModal.model=null,this.servantModal.currentServer=null},configServant:function(e){if(this.servantDetailModal.model={application:this.servantModal.currentServer.application,server_name:this.servantModal.currentServer.server_name,obj_name:"",node_name:"",endpoint:"",servant:"",thread_num:"",max_connections:"200000",queuecap:"10000",queuetimeout:"60000",allow_ip:"",protocol:"not_tars",handlegroup:""},this.servantDetailModal.isNew=!0,e){var t=this.servantModal.model.find((function(t){return t.id===e}));t.obj_name=t.servant.split(".")[2],this.servantDetailModal.model=Object.assign({},this.servantDetailModal.model,t),this.servantDetailModal.isNew=!1}this.servantDetailModal.show=!0},closeServantDetailModal:function(){this.$refs.servantDetailForm&&this.$refs.servantDetailForm.resetValid(),this.servantDetailModal.show=!1,this.servantDetailModal.model=null},checkServantEndpoint:function(e){var t=e.split(/\s-/),a=/^tcp|udp$/i,r=/^h\s(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/i,o=/^t\s([1-9]|[1-9]\d+)$/i,n=/^p\s\d{4,5}$/i,s=!0;if(a.test(t[0])){for(var i=0,l=1;l<t.length;l++)if(r&&r.test(t[l])&&(i++,this.servantDetailModal.model.node_name=t[l].split(/\s/)[1],r=null),o&&o.test(t[l])&&(i++,o=null),n&&n.test(t[l])){var c=t[l].substring(2);c<0||c>65535||i++,n=null}s=3===i}else s=!1;return s},saveServantDetail:function(){var e=this;if(this.$refs.servantDetailForm.validate()){var t=this.$Loading.show();if(this.servantDetailModal.isNew){var a=this.servantDetailModal.model;a.servant=[a.application,a.server_name,a.obj_name].join("."),this.$tars.postJSON("/server/api/add_adapter_conf",a).then((function(a){t.hide(),e.servantModal.model.unshift(a),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}else this.servantDetailModal.model.servant=this.servantDetailModal.model.application+"."+this.servantDetailModal.model.server_name+"."+this.servantDetailModal.model.obj_name,this.$tars.postJSON("/server/api/update_adapter_conf",this.servantDetailModal.model).then((function(a){t.hide(),e.servantModal.model=e.servantModal.model.map((function(e){return e.id===a.id?a:e})),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}},deleteServant:function(e){var t=this;this.$confirm(this.$t("serverList.servant.a"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$tars.getJSON("/server/api/delete_adapter_conf",{id:e}).then((function(r){a.hide(),t.servantModal.model=t.servantModal.model.map((function(t){if(t.id!==e)return t})).filter((function(e){return e})),t.$tip.success(t.$t("common.success"))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}))},showMoreCmd:function(e){var t=this;this.moreCmdModal.model={selected:"setloglevel",setloglevel:"NONE",loadconfig:"",command:"",configs:null},this.moreCmdModal.unwatch=this.$watch("moreCmdModal.model.selected",(function(){t.$refs.moreCmdForm&&t.$refs.moreCmdForm.resetValid()})),this.moreCmdModal.show=!0,this.moreCmdModal.currentServer=e,this.$tars.getJSON("/server/api/config_file_list",{level:5,application:e.application,server_name:e.server_name}).then((function(e){t.moreCmdModal.model&&(t.moreCmdModal.model.configs=e)})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},showStatus:function(e){this.sendCommand(e,"status")},sendCommand:function(e,t,a){var r=this,o=this.$Loading.show();this.$tars.getJSON("/server/api/send_command",{server_ids:e,command:t}).then((function(e){o.hide();var t=e[0].err_msg.replace(/\n/g,"<br>");if(0!==e[0].ret_code)throw new Error(t);var n={title:r.$t("common.success"),message:t};a&&(n.duration=0),r.$tip.success(n)})).catch((function(e){o.hide(),r.$tip.error({title:r.$t("common.error"),message:e.err_msg||e.message})}))},invokeMoreCmd:function(){var e=this.moreCmdModal.model,t=this.moreCmdModal.currentServer;"undeploy_tars"===e.selected?this.undeployServer(t.id):"setloglevel"===e.selected?this.sendCommand(t.id,"tars.setloglevel ".concat(e.setloglevel)):"loadconfig"===e.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(t.id,"tars.loadconfig ".concat(e.loadconfig)):"command"===e.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(t.id,e.command):"connection"===e.selected&&this.sendCommand(t.id,"tars.connection",!0)},closeMoreCmdModal:function(){this.$refs.moreCmdForm&&this.$refs.moreCmdForm.resetValid(),this.moreCmdModal.unwatch&&this.moreCmdModal.unwatch(),this.moreCmdModal.show=!1,this.moreCmdModal.model=null},handleNoPublishedTime:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$t("pub.dlg.unpublished");return"0000:00:00 00:00:00"===e?t:e}},created:function(){this.serverData=this.$parent.getServerData()},mounted:function(){this.getServerList(),this.getServerNotifyList(1)}},Rr=Pr,Ir=(a("bdcf"),Object(h["a"])(Rr,Xt,ea,!1,null,null,null)),Er=Ir.exports,jr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"moduleCache"},[a("h4",[e._v(" "+e._s(this.$t("serverList.title.serverList"))+" "),a("i",{staticClass:"el-icon-refresh-right",on:{click:e.getServerList}})]),a("br"),e.serverList?a("let-table",{ref:"serverListLoading",attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"node_name",width:"140px"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.zb"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.server_type;return["M"===r?a("span",[e._v(e._s(e.$t("cache.mainEngine")))]):"S"===r?a("span",[e._v(e._s(e.$t("cache.standByEngine")))]):"I"===r?a("span",[e._v(e._s(e.$t("cache.mirror")))]):e._e()]}}],null,!1,3355360255)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"===e.row.setting_state?"status-active":"status-off"})]}}],null,!1,2336342142)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus"),width:"65px"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:"active"===e.row.present_state?"status-active":"activating"===e.row.present_state?"status-activating":"status-off"})]}}],null,!1,1428767809)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.time")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"word-break":"break-word"}},[e._v(e._s(e.handleNoPublishedTime(t.row.patch_time)))])]}}],null,!1,3144837894)}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-table-operation",{on:{click:function(t){return e.editServerConfig(r)}}},[e._v(e._s(e.$t("cache.config.edit")))]),a("let-table-operation",{on:{click:function(t){return e.checkServerConfigList(r)}}},[e._v(e._s(e.$t("cache.config.view")))]),a("let-table-operation",{on:{click:function(t){return e.addServerConfig(r)}}},[e._v(e._s(e.$t("cache.config.add")))])]}}],null,!1,2273559844)})],1):e._e(),a("let-table",{attrs:{data:e.showConfigList,title:e.$t("cache.config.tableTitle"),"empty-msg":e.$t("common.nodata"),stripe:!0}},[a("let-table-column",{attrs:{width:"50"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{attrs:{value:e.isCheckedAll,change:e.checkedAllChange},model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{value:t.row.id},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("cache.config.remark"),prop:"remark",width:"300"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.path"),prop:"path",width:"100"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.item"),prop:"item",width:"100"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.config_value"),prop:"config_value",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.config_value;return[a("div",{staticStyle:{"white-space":"pre-wrap"}},[e._v(" "+e._s(r)+" ")])]}}])}),a("let-table-column",{attrs:{title:e.$t("cache.config.modify_value"),prop:"period",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-input",{attrs:{size:"small",type:"textarea",rows:1},on:{focus:e.inputFocus,blur:e.inputBlur},model:{value:r.modify_value,callback:function(t){e.$set(r,"modify_value",t)},expression:"row.modify_value"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("operate.operates")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-table-operation",{on:{click:function(t){return e.saveConfig(r)}}},[e._v(e._s(e.$t("operate.save")))]),a("let-table-operation",{staticClass:"danger",on:{click:function(t){return e.deleteConfig(r)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])}),e.total?a("let-pagination",{attrs:{slot:"pagination",total:e.total,page:e.pagination.page,"show-sums":"",sum:e.configList.length,jump:"",align:"right"},on:{change:e.changePage},slot:"pagination"}):e._e(),a("template",{slot:"operations"},[a("let-button",{attrs:{theme:"success",disabled:!e.hasCheckedItem},on:{click:e.saveConfigBatch}},[e._v(e._s(e.$t("cache.config.batchUpdate")))]),a("let-button",{attrs:{theme:"danger",disabled:!e.hasCheckedItem},on:{click:e.deleteServerConfigItemBatch}},[e._v(e._s(e.$t("cache.config.batchDelete")))]),a("let-button",{attrs:{theme:"primary"},on:{click:function(t){return e.addServerConfig({appName:e.appName,moduleName:e.moduleName})}}},[e._v(e._s(e.$t("cache.config.addModuleConfig")))])],1)],2),a("let-modal",{staticClass:"server_config_list_modal",attrs:{footShow:!1,closeOnClickBackdrop:!0,width:"80%",height:"80%",title:e.$t("cache.config.tableTitle")},model:{value:e.serverConfigListVisible,callback:function(t){e.serverConfigListVisible=t},expression:"serverConfigListVisible"}},[e.serverConfigListVisible?a("server-config-list",e._b({attrs:{moduleName:e.moduleName}},"server-config-list",e.checkServer,!1)):e._e()],1),a("let-modal",{staticClass:"server_config_list_modal",attrs:{footShow:!1,closeOnClickBackdrop:!0,width:"80%",height:"80%",title:e.$t("cache.config.tableTitle")},model:{value:e.serverConfigVisible,callback:function(t){e.serverConfigVisible=t},expression:"serverConfigVisible"}},[e.serverConfigVisible?a("server-config",e._b({},"server-config",e.checkServer,!1)):e._e()],1),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0},model:{value:e.addServerConfigVisible,callback:function(t){e.addServerConfigVisible=t},expression:"addServerConfigVisible"}},[e.addServerConfigVisible?a("add-server-config",e._b({on:{"call-back":e.getModuleConfig}},"add-server-config",e.checkServer,!1)):e._e()],1)],1)},Ar=[],zr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("let-table",{attrs:{data:e.configList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("cache.config.remark"),prop:"remark"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.path"),prop:"path"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.item"),prop:"item"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.value"),prop:"config_value"}})],1)],1)},Fr=[],Jr={props:{appName:{type:String,required:!0},moduleName:{type:String,required:!0},serverName:{type:String,required:!0},nodeName:{type:String,required:!0}},data:function(){return{configList:[]}},methods:{getServerConfig:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a={appName:e.appName,moduleName:e.moduleName,serverName:e.serverName,nodeName:e.nodeName},t.next=4,e.$ajax.getJSON("/server/api/cache/getServerConfig",a);case 4:r=t.sent,e.configList=r.filter((function(e){var t=r.filter((function(t){return t.path===e.path&&t.item===e.item})),a=t[t.length-1];return e===a})),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()}},created:function(){this.getServerConfig()}},Br=Jr,Vr=Object(h["a"])(Br,zr,Fr,!1,null,null,null),Gr=Vr.exports,Wr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("let-table",{attrs:{data:e.configList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("cache.config.remark"),prop:"remark"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.path"),prop:"path"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.item"),prop:"item",width:"150px"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.value"),prop:"config_value",width:"150px"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.modify_value"),prop:"config_value"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-input",{attrs:{size:"small"},model:{value:r.modify_value,callback:function(t){e.$set(r,"modify_value",t)},expression:"row.modify_value"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("operate.operates")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-table-operation",{on:{click:function(t){return e.saveConfig(r)}}},[e._v(e._s(e.$t("operate.save")))]),a("let-table-operation",{staticClass:"danger",on:{click:function(t){return e.deleteConfig(r)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1)],1)},Kr=[],Hr={props:{serverName:{type:String,required:!0},nodeName:{type:String,required:!0}},data:function(){return{configList:[]}},methods:{getServerConfig:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a={serverName:e.serverName,nodeName:e.nodeName},t.next=4,e.$ajax.getJSON("/server/api/cache/getServerNodeConfig",a);case 4:r=t.sent,r.forEach((function(e){return e.modify_value=""})),e.configList=r,t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},deleteConfig:function(e){var t=this,a=e.id;this.$confirm(this.$t("cache.config.deleteConfig"),this.$t("common.alert")).then(Object(fe["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$ajax.getJSON("/server/api/cache/deleteServerConfigItem",{id:a});case 3:return e.sent,e.next=6,t.getServerConfig();case 6:e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.t0.message||e.t0.err_msg));case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))))},saveConfig:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.id,o=e.modify_value,a.prev=1,a.next=4,t.$ajax.getJSON("/server/api/cache/updateServerConfigItem",{id:r,configValue:o});case 4:return a.sent,a.next=7,t.getServerConfig();case 7:a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](1),t.$tip.error("".concat(t.$t("common.error"),": ").concat(a.t0.message||a.t0.err_msg));case 12:case"end":return a.stop()}}),a,null,[[1,9]])})))()}},created:function(){this.getServerConfig()}},Ur=Hr,Zr=Object(h["a"])(Ur,Wr,Kr,!1,null,null,null),Yr=Zr.exports,Qr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("let-form",{ref:"addConfigForm",attrs:{type:"medium",title:e.$t("cache.config.addConfig")}},[a("let-form-item",{attrs:{label:e.$t("cache.config.item"),required:""}},[a("let-select",{attrs:{size:"small"},model:{value:e.itemId,callback:function(t){e.itemId=t},expression:"itemId"}},e._l(e.list,(function(t){return a("let-option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.path)+"__"+e._s(t.item)+"("+e._s(t.remark)+")")])})),1)],1),a("let-form-item",{attrs:{label:e.$t("cache.config.itemValue"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.configValue,callback:function(t){e.configValue=t},expression:"configValue"}})],1),a("br"),a("let-form-item",{attrs:{label:" "}},[a("let-button",{attrs:{theme:"primary"},on:{click:e.submit}},[e._v(e._s(e.$t("cache.add")))])],1)],1)],1)},Xr=[],eo={props:{serverName:{type:String,required:!1},nodeName:{type:String,required:!1},appName:{type:String,required:!1},moduleName:{type:String,required:!1}},computed:{isModule:function(){return!(!this.appName||!this.moduleName)}},data:function(){return{itemId:"",list:[],configValue:""}},methods:{submit:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.addConfigForm.validate()){t.next=16;break}return t.prev=1,a={itemId:e.itemId,configValue:e.configValue,serverName:e.serverName,nodeName:e.nodeName,appName:e.appName,moduleName:e.moduleName},t.next=5,e.$ajax.postJSON("/server/api/cache/addServerConfigItem",a);case 5:e.$tip.success("".concat(e.$t("cache.config.addSuccess"))),e.configValue="",e.itemId="",e.getConfig(),e.moduleName&&e.$emit("call-back"),t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](1),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 16:case"end":return t.stop()}}),t,null,[[1,12]])})))()},getConfig:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Na();case 3:if(a=t.sent,r=e.isModule,o=e.appName,n=e.moduleName,!r){t.next=10;break}return t.next=8,Ca({appName:o,moduleName:n});case 8:s=t.sent,a=a.filter((function(e){var t=s.filter((function(t){return"".concat(t.path,"__").concat(t.item)==="".concat(e.path,"__").concat(e.item)})).length;return!t}));case 10:e.list=a,t.next=17;break;case 13:t.prev=13,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 17:case"end":return t.stop()}}),t,null,[[0,13]])})))()}},created:function(){this.getConfig(),window.config=this}},to=eo,ao=Object(h["a"])(to,Qr,Xr,!1,null,null,null),ro=ao.exports,oo={components:{ServerConfigList:Gr,ServerConfig:Yr,addServerConfig:ro},data:function(){return{appName:"",moduleName:"",configList:[],serverList:[],serverConfigListVisible:!1,serverConfigVisible:!1,addServerConfigVisible:!1,checkServer:{},isCheckedAll:!1,pagination:{page:1}}},computed:{showConfigList:function(){return this.configList.slice(100*(this.pagination.page-1),100*this.pagination.page)},total:function(){return Math.ceil(this.configList.length/100)},hasCheckedItem:function(){return 0!==this.showConfigList.filter((function(e){return!0===e.isChecked})).length}},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.showConfigList.forEach((function(t){t.isChecked=e}))}},methods:{checkedAllChange:function(){},changePage:function(e){this.pagination.page=e},inputFocus:function(e){e.target.rows=4},inputBlur:function(e){e.target.rows=1},getModuleConfig:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=e.appName,r=e.moduleName,t.next=4,Ca({appName:a,moduleName:r});case 4:o=t.sent,o.forEach((function(e){e.modify_value="",e.isChecked=!1})),e.configList=o,t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},getServerList:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$Loading.show(),t.prev=1,r=e.appName,o=e.moduleName,t.next=5,Sa({appName:r,moduleName:o});case 5:n=t.sent,e.serverList=n,t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](1),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 12:a.hide();case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()},saveConfig:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.id,o=e.modify_value,a.prev=1,a.next=4,t.$ajax.getJSON("/server/api/cache/updateServerConfigItem",{id:r,configValue:o});case 4:return a.sent,a.next=7,t.getModuleConfig();case 7:a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](1),t.$tip.error("".concat(t.$t("common.error"),": ").concat(a.t0.message||a.t0.err_msg));case 12:case"end":return a.stop()}}),a,null,[[1,9]])})))()},saveConfigBatch:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.showConfigList.filter((function(e){return e.isChecked})).map((function(e){return{indexId:e.id,configValue:e.modify_value}})),t.prev=1,t.next=4,e.$ajax.postJSON("/server/api/cache/updateServerConfigItemBatch",{serverConfigList:a});case 4:return t.sent,t.next=7,e.getModuleConfig();case 7:t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](1),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 12:case"end":return t.stop()}}),t,null,[[1,9]])})))()},deleteConfig:function(e){var t=this,a=e.id;this.$confirm(this.$t("cache.config.deleteConfig"),this.$t("common.alert")).then(Object(fe["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$ajax.getJSON("/server/api/cache/deleteServerConfigItem",{id:a});case 3:return e.sent,e.next=6,t.getModuleConfig();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error(e.t0),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.t0.message||e.t0.err_msg));case 12:case"end":return e.stop()}}),e,null,[[0,8]])}))))},deleteServerConfigItemBatch:function(e){var t=this,a=(e.id,this.showConfigList.filter((function(e){return e.isChecked})).map((function(e){return{indexId:e.id}})));this.$confirm(this.$t("cache.config.deleteConfig"),this.$t("common.alert")).then(Object(fe["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$ajax.postJSON("/server/api/cache/deleteServerConfigItemBatch",{serverConfigList:a});case 3:return e.sent,e.next=6,t.getModuleConfig();case 6:e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.t0.message||e.t0.err_msg));case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))))},handleNoPublishedTime:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$t("pub.dlg.unpublished");return"0000:00:00 00:00:00"===e?t:e},checkServerConfigList:function(e){this.serverConfigListVisible=!0,this.checkServer={appName:this.appName,serverName:e.server_name,nodeName:e.node_name}},editServerConfig:function(e){this.serverConfigVisible=!0,this.checkServer={serverName:e.server_name,nodeName:e.node_name}},addServerConfig:function(e){this.addServerConfigVisible=!0,this.checkServer={serverName:e.server_name,nodeName:e.node_name,moduleName:e.moduleName,appName:e.appName}}},created:function(){var e=this.$parent.getServerData(),t=e.application,a=e.module_name;this.appName=t,this.moduleName=a,this.getModuleConfig(),this.getServerList()}},no=oo,so=(a("d57b"),Object(h["a"])(no,jr,Ar,!1,null,null,null)),io=so.exports,lo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_manage"},[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-group",[a("let-form-item",{attrs:{label:e.$t("monitor.search.a")}},[a("let-date-picker",{attrs:{size:"small",formatter:e.formatter},model:{value:e.query.thedate,callback:function(t){e.$set(e.query,"thedate",t)},expression:"query.thedate"}})],1),a("let-form-item",{attrs:{label:e.$t("monitor.search.b")}},[a("let-date-picker",{attrs:{size:"small",formatter:e.formatter},model:{value:e.query.predate,callback:function(t){e.$set(e.query,"predate",t)},expression:"query.predate"}})],1),a("let-form-item",{attrs:{label:e.$t("monitor.search.start")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.startshowtime,callback:function(t){e.$set(e.query,"startshowtime",t)},expression:"query.startshowtime"}})],1),a("let-form-item",{attrs:{label:e.$t("monitor.search.end")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.endshowtime,callback:function(t){e.$set(e.query,"endshowtime",t)},expression:"query.endshowtime"}})],1)],1),a("let-form-group",[a("tars-form-item",{attrs:{label:e.$t("module.name")},on:{onLabelClick:function(t){return e.groupBy("moduleName")}}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.moduleName,callback:function(t){e.$set(e.query,"moduleName",t)},expression:"query.moduleName"}})],1),a("tars-form-item",{attrs:{label:e.$t("service.serverName")},on:{onLabelClick:function(t){return e.groupBy("serverName")}}},[a("let-select",{attrs:{size:"small",filterable:""},model:{value:e.query.serverName,callback:function(t){e.$set(e.query,"serverName",t)},expression:"query.serverName"}},e._l(e.cacheServerList,(function(t){return a("let-option",{key:t.id,attrs:{value:t.application+"."+t.server_name}},[e._v(" "+e._s(t.application+"."+t.server_name)+" ")])})),1)],1),a("let-form-item",[a("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))])],1)],1)],1),e.showChart?a("let-row",{ref:"charts",staticClass:"charts"},e._l(e.charts,(function(t){return a("let-col",{key:t.title,attrs:{span:12}},[e.allItems.length>0?a("compare-chart",e._b({},"compare-chart",t,!1)):e._e()],1)})),1):e._e(),a("hours-filter",{model:{value:e.hour,callback:function(t){e.hour=t},expression:"hour"}}),a("let-table",{ref:"table",attrs:{data:e.pagedItems,"empty-msg":e.$t("common.nodata"),stripe:""}},[a("let-table-column",{attrs:{title:e.$t("common.time"),prop:"show_time"}}),a("let-table-column",{attrs:{title:e.$t("module.name"),prop:"moduleName"}}),a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"serverName"}}),e._l(e.keys,(function(t){return[a("let-table-column",{attrs:{title:e.$t("monitor.table.curr")+"/"+e.$t("monitor.table.contrast")+" "+t,prop:"value"}})]})),e.pageCount?a("let-pagination",{attrs:{slot:"pagination",total:e.pageCount,page:e.page,sum:e.itemsCount,"show-sums":"",jump:""},on:{change:e.changePage},slot:"pagination"}):e._e()],2)],1)},co=[],uo=20,mo="YYYYMMDD",po={name:"ServerPropertyMonitor",components:{HoursFilter:Lt,CompareChart:Et},data:function(){var e=this.treeid;return{query:{thedate:$t(new Date,mo),predate:$t(Date.now()-_t,mo),startshowtime:"0000",endshowtime:"2360",moduleName:e.split(".")[1].substr(1),serverName:""},appName:e.split(".")[0].substr(1),cacheServerList:[],formatter:mo,allItems:[],hour:-1,page:1,showChart:!0,keys:[]}},props:["treeid"],computed:{filteredItems:function(){var e=this.hour;return e>=0?this.allItems.filter((function(t){return+t.show_time.slice(0,2)===e})):this.allItems},itemsCount:function(){return this.filteredItems.length},pageCount:function(){return Math.ceil(this.filteredItems.length/uo)},pagedItems:function(){return this.filteredItems.slice(uo*(this.page-1),uo*this.page)},chartOptions:function(){return{title:this.$t("monitor.table.total"),timeColumn:"show_time",dataColumns:[{name:"the_value",label:this.$t("monitor.property.property")},{name:"pre_value",label:this.$t("monitor.property.propertyC")}],data:this.allItems}},charts:function(){var e=this;return this.keys.map((function(t){return{title:t,timeColumn:"show_time",dataColumns:[{name:"the_".concat(t),label:e.$t("monitor.table.curr")},{name:"pre_".concat(t),label:e.$t("monitor.table.contrast")}],data:e.allItems}}))}},mounted:function(){this.fetchCacheServerList()},methods:{fetchCacheServerList:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Sa({appName:e.appName,moduleName:e.query.moduleName});case 3:e.cacheServerList=t.sent,t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 9:case"end":return t.stop()}}),t,null,[[0,6]])})))()},fetchData:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s,i,l,c,u,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$refs.charts&&e.$refs.charts.$loading.show(),r=e.$refs.table.$loading.show(),t.prev=2,o=e.query,n=e.query,s=n.group_by,i=n.serverName,l=Object(he["a"])({},o),"serverName"===s&&""===i&&(l=Object(he["a"])(Object(he["a"])({},l),{},{serverName:""})),t.next=8,Da(l);case 8:c=t.sent,u=c.data,d=c.keys,e.allItems=u||[],e.keys=d||[],e.keys.forEach((function(t,a){e.allItems.forEach((function(e){e.value=e["the_".concat(t)]+"/"+e["pre_".concat(t)]}))})),t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](2),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 19:return t.prev=19,a&&a.hide(),r.hide(),t.finish(19);case 23:case"end":return t.stop()}}),t,null,[[2,16,19,23]])})))()},groupBy:function(e){this.query.group_by=e,this.showChart=!1,this.fetchData()},search:function(){delete this.query.group_by,this.showChart=!0,this.fetchData()},changePage:function(e){this.page=e}}},ho=po,fo=(a("8ef7"),Object(h["a"])(ho,lo,co,!1,null,null,null)),vo=fo.exports,go={name:"Server",components:{manage:qe,publish:Ge,config:mt,"server-monitor":Vt,"property-monitor":Qt,cache:Er,moduleCache:io,propertyMonitor:vo},data:function(){return{treeErrMsg:"load failed",treeData:null,treeid:"",isIconPlay:!1,serverData:{level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:"",module_name:""},serverType:"",BTabs:[]}},computed:{base:function(){return"/server/".concat(this.treeid)}},watch:{treeid:function(){this.serverData=this.getServerData()},$route:function(e,t){"/server"===e.path&&this.getTreeData()}},directives:{vscroll:{componentUpdated:function(e){var t=e||"",a=e.children||[],r="";if(a.forEach((function(e){var t=e.getAttribute("class");t.indexOf("active")>-1&&(r=e)})),r.offsetLeft<t.scrollLeft){var o=r.offsetLeft;t.scrollTo(o,0)}else if(r.offsetLeft+r.offsetWidth>t.scrollLeft+t.offsetWidth){var n=r.offsetLeft+r.offsetWidth-t.offsetWidth;t.scrollTo(n,0)}}}},methods:{iconLoading:function(){var e=this;e.isIconPlay||(e.isIconPlay=!0,setTimeout((function(){e.isIconPlay=!1}),1e3))},getNewServerName:function(e){var t=e&&e.split(".");if(!t)return e;if(1==t.length){var a=e&&e.split(".")[0].substring(1);return"".concat(a)}if(t.length>1){var r=e&&e.split(".")[0].substring(1),o=e&&e.split(".")[1].substring(1);return"".concat(r,".").concat(o)}},getName:function(e){var t="";return e.lastIndexOf("/")>-1&&(t=e.substring(e.lastIndexOf("/")+1,e.length)),t},treeSearch:function(e){this.getTreeData(e)},selectTree:function(e,t){if(t.children&&t.children.length);else{var a=t.serverType;!a&&(a="tars"),this.serverType=a}this.selectBTabs(e,t),this.checkCurrBTabs()},handleData:function(e,t){var a=this;e&&e.length&&e.forEach((function(e){e.label=e.name,e.nodeKey=e.id,a.treeid===e.nodeKey&&(e.expand=!0),e.children&&e.children.length&&a.handleData(e.children)}))},getTreeData:function(e){var t=this;this.treeData=null,e=e||1,this.$nextTick((function(){var a=t.$loading.show();t.$ajax.getJSON("/server/api/dtree",{type:e}).then((function(e){a.hide(),t.treeData=e,t.handleData(t.treeData,!0)})).catch((function(e){a.hide(),t.treeErrMsg=e.err_msg||e.message||"加载失败",t.treeData=!1}))}))},getServerData:function(){if(!this.treeid)return{};var e=this.treeid.split("."),t={level:5,application:"",server_name:"",set_name:"",set_area:"",set_group:""};return e.forEach((function(e){var a=+e.substr(0,1),r=e.substr(1);switch(a){case 1:t.application=r;break;case 2:t.set_name=r;break;case 3:t.set_area=r;break;case 4:t.set_group=r;break;case 5:t.server_name=r;break;case 6:t.module_name=r;break;default:break}t.level=a})),t},checkTreeid:function(){this.treeid=this.getLocalStorage("tars_dcache_treeid")||""},clickTab:function(e){var t=this.treeid,a=this.BTabs;a&&a.forEach((function(a){a.id===t&&(a.path=e)})),this.setLocalStorage("tars_dcache_tabs",JSON.stringify(a))},isTrueTreeLevel:function(){var e=this.$route.path.split("/"),t=e[e.length-1],a=!1;5===this.serverData.level||"publish"!==t&&"server-monitor"!==t&&"property-monitor"!==t&&"user-manage"!==t||(a=!0),5!==this.serverData.level&&4!==this.serverData.level&&1!==this.serverData.level&&"config"===t&&(a=!0),a&&this.$router.replace("manage")},checkBTabs:function(){var e=this.BTabs,t=this.getLocalStorage("tars_dcache_tabs");t&&t.length>0&&t.forEach((function(t){e.push({id:t.id,path:t.path})}))},checkCurrBTabs:function(){var e=this;this.$nextTick((function(){var t=e.$refs.btabs||"",a=t.children||[],r="";if(a.forEach((function(e){var t=e.getAttribute("class");t.indexOf("active")>-1&&(r=e)})),r.offsetLeft<t.scrollLeft){var o=r.offsetLeft;t.scrollTo(o,0)}else if(r.offsetLeft+r.offsetWidth>t.scrollLeft+t.offsetWidth){var n=r.offsetLeft+r.offsetWidth-t.offsetWidth;t.scrollTo(n,0)}}))},selectBTabs:function(e,t){var a=this.BTabs,r=!1;a.forEach((function(a){a.id===e&&(r=!0,a.path=t.moduleName?"/server/".concat(e,"/cache"):"/server/".concat(e,"/manage"))})),r||this.BTabs.push({id:e,path:t.moduleName?"/server/".concat(e,"/cache"):"/server/".concat(e,"/manage")}),this.treeid=e,this.setLocalStorage("tars_dcache_treeid",JSON.stringify(e)),this.setLocalStorage("tars_dcache_tabs",JSON.stringify(a))},clickBTabs:function(e,t){this.treeid=t,this.setLocalStorage("tars_dcache_treeid",JSON.stringify(t))},closeBTabs:function(e){var t=this.BTabs,a=0;t.forEach((function(t,r){t.id===e&&(a=r)})),t.splice(a,1),this.setLocalStorage("tars_dcache_tabs",JSON.stringify(t)),t.length>0?this.treeid=t[t.length-1].id:this.treeid="",this.setLocalStorage("tars_dcache_treeid",JSON.stringify(this.treeid)),this.getTreeData()},closeAllBTabs:function(){this.BTabs=[],this.treeid="",this.setLocalStorage("tars_dcache_tabs",JSON.stringify(this.BTabs)),this.setLocalStorage("tars_dcache_treeid",JSON.stringify(this.treeid)),this.getTreeData()},getLocalStorage:function(e){var t="";return window.localStorage&&(t=JSON.parse(JSON.parse(localStorage.getItem(e)))),t},setLocalStorage:function(e,t){var a="";return window.localStorage&&(a=localStorage.setItem(e,JSON.stringify(t))),a}},created:function(){this.serverData=this.getServerData(),this.isTrueTreeLevel()},mounted:function(){this.checkTreeid(),this.checkBTabs(),this.getTreeData(),window.dcacheIndex=this}},_o=go,bo=(a("3cc4"),Object(h["a"])(_o,ce,ue,!1,null,null,null)),$o=bo.exports,ko=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation"},[a("let-tabs",{attrs:{activekey:e.$route.matched[1]?e.$route.matched[1].path:"/operation/apply"},on:{click:e.onTabClick}},[a("let-tab-pane",{attrs:{tab:e.$t("apply.createTitle"),tabkey:"/operation/apply"}}),a("let-tab-pane",{attrs:{tab:e.$t("module.createTitle"),tabkey:"/operation/module"}}),a("let-tab-pane",{attrs:{tab:e.$t("region.title"),tabkey:"/operation/region"}})],1),a("router-view",{staticClass:"page_operation_children"})],1)},wo=[],yo={name:"Oparetion",methods:{onTabClick:function(e){this.$router.replace(e)}}},Mo=yo,xo=(a("548c"),Object(h["a"])(Mo,ko,wo,!1,null,null,null)),So=xo.exports,Co=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_apply"},[a("let-steps",{staticClass:"apply_steps",attrs:{current:e.step}},[a("let-step",{attrs:{title:e.$t(e.title1)}}),a("let-step",{attrs:{title:e.$t(e.title2)}}),a("let-step",{attrs:{title:e.$t(e.title3)}})],1),a("router-view",{staticClass:"page_operation_apply_children"})],1)},No=[],Lo={data:function(){var e=this.$route.fullPath,t=1;return e.indexOf("createApply")>-1?t=1:e.indexOf("createService")>-1?t=2:e.indexOf("installAndPublish")>-1&&(t=3),{title1:"apply.createApply",title2:"apply.createRouterProxyService",title3:"apply.installAndPublish",step:t}},watch:{$route:function(e,t){var a=e.fullPath;a.indexOf("createApply")>-1?this.step=1:a.indexOf("createService")>-1?this.step=2:a.indexOf("installAndPublish")>-1&&(this.step=3)}},methods:{}},Do=Lo,Oo=(a("de6f"),Object(h["a"])(Do,Co,No,!1,null,null,null)),To=Oo.exports,qo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_create_apply"},[a("let-form",{ref:"detailForm",attrs:{inline:""}},[a("let-form-item",{attrs:{label:e.$t("apply.title"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.name,callback:function(t){e.$set(e.model,"name",t)},expression:"model.name"}})],1),a("let-form-item",{attrs:{label:e.$t("region.idcArea"),itemWidth:"240px"}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},on:{change:e.changeSelect},model:{value:e.model.idcArea,callback:function(t){e.$set(e.model,"idcArea",t)},expression:"model.idcArea"}},e._l(e.regions,(function(t){return a("let-option",{key:t.label,attrs:{value:t.label}},[e._v(" "+e._s(t.region)+" ")])})),1)],1),a("let-form-item",{attrs:{label:e.$t("region.setArea"),itemWidth:"240px"}},[a("let-select",{attrs:{size:"small",multiple:!0},model:{value:e.model.setArea,callback:function(t){e.$set(e.model,"setArea",t)},expression:"model.setArea"}},e._l(e.setRegions,(function(t){return a("let-option",{key:t.label,attrs:{value:t.label}},[e._v(" "+e._s(t.region)+" ")])})),1)],1),a("div",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.createApply}},[e._v(e._s(e.$t("apply.createApply")))])],1)],1)],1)},Po=[],Ro=function(){return{name:"",admin:"",idcArea:"",setArea:[]}},Io={data:function(){return{regions:[],setRegions:[],model:Ro()}},methods:{changeSelect:function(){var e=this;this.model.setArea=[];var t=this.regions.concat();t.splice(t.indexOf(t.find((function(t){return t.label==e.model.idcArea}))),1),this.setRegions=t},createApply:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.model,a="/server/api/add_apply",r=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(a){r.hide(),a.hasApply?e.$confirm(e.$t("dcache.applyExists"),e.$t("common.alert")).then(Object(fe["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:r.show(),e.$ajax.postJSON("/server/api/overwrite_apply",t).then((function(t){r.hide(),e.$tip.success(e.$t("common.success")),e.$router.push("/operation/apply/createService/"+t.id)})).catch((function(t){r.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}));case 2:case"end":return a.stop()}}),a)})))).catch((function(){})):(r.hide(),e.$tip.success(e.$t("common.success")),e.$router.push("/operation/apply/createService/"+a.id))})).catch((function(t){r.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},getRegionList:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,qa();case 3:a=t.sent,e.regions=a,t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})))()}},created:function(){this.getRegionList()},beforeRouteEnter:function(e,t,a){H.getJSON("/server/api/has_dcache_patch_package").then((function(e){e?a():a((function(e){e.$tip.warning("".concat(e.$t("common.warning"),": ").concat(e.$t("apply.uploadPatchPackage"))),e.$router.push("/releasePackage/proxyList")}))})).catch((function(e){console.error(e.message||e.err_msg)}))}},Eo=Io,jo=Object(h["a"])(Eo,qo,Po,!1,null,null,null),Ao=jo.exports,zo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_create_service"},[a("let-form",{ref:"detailForm",attrs:{"label-position":"top"}},[a("let-form-group",{attrs:{title:e.$t("apply.RouterConfigInfo"),inline:"","label-position":"top"}},[a("let-form-item",{attrs:{label:e.$t("service.serverName"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.apply.Router.server_name,callback:function(t){e.$set(e.apply.Router,"server_name",t)},expression:"apply.Router.server_name"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.template"),itemWidth:"240px",required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.templateTips")},model:{value:e.apply.Router.template_file,callback:function(t){e.$set(e.apply.Router,"template_file",t)},expression:"apply.Router.template_file"}},e._l(e.templates,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("service.serverIp"),itemWidth:"300px",required:""}},[a("let-select",{attrs:{size:"small",required:"",placeholder:"Please Choose"},model:{value:e.apply.Router.server_ip,callback:function(t){e.$set(e.apply.Router,"server_ip",t)},expression:"apply.Router.server_ip"}},e._l(e.nodeList,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+" ")])})),1)],1),a("br"),a("span",{staticStyle:{"margin-left":"20px"}},[e._v(e._s(e.$t("service.routerDbNameTip")))]),a("br"),a("br"),a("let-form-item",{attrs:{label:e.$t("service.routerDbName"),itemWidth:"240px",required:""}},[a("let-input",{staticStyle:{display:"inline-block"},attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.apply.Router.router_db_name,callback:function(t){e.$set(e.apply.Router,"router_db_name",t)},expression:"apply.Router.router_db_name"}})],1),a("let-tag",{staticStyle:{"margin-left":"20px"},attrs:{theme:"danger"}},[e._v(e._s(e.$t("service.databaseTips")))]),a("br"),a("let-form-item",{attrs:{label:e.$t("service.routerDbName"),itemWidth:"240px",required:""}},[a("let-radio",{attrs:{label:!0},model:{value:e.apply.dbMethod,callback:function(t){e.$set(e.apply,"dbMethod",t)},expression:"apply.dbMethod"}},[e._v(e._s(e.$t("service.chooseRouterDb")))])],1),e.apply.dbMethod?a("let-form-item",{attrs:{label:e.$t("service.routerDbName"),itemWidth:"240px",required:""}},[a("let-select",{attrs:{size:"small",required:""},model:{value:e.apply.routerDbId,callback:function(t){e.$set(e.apply,"routerDbId",t)},expression:"apply.routerDbId"}},e._l(e.routerDb,(function(t){return a("let-option",{key:t.id,attrs:{value:t.id}},[e._v(" "+e._s(t.router_db_flag)+" ")])})),1)],1):e._e(),a("br"),a("let-form-item",{attrs:{label:e.$t("service.routerDbName"),itemWidth:"240px",required:""}},[a("let-radio",{attrs:{label:!1},model:{value:e.apply.dbMethod,callback:function(t){e.$set(e.apply,"dbMethod",t)},expression:"apply.dbMethod"}},[e._v(e._s(e.$t("service.inputRouterDb")))])],1),e.apply.dbMethod?e._e():a("span",[a("let-form-item",{attrs:{label:e.$t("service.routerDbIp"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.apply.Router.router_db_ip,callback:function(t){e.$set(e.apply.Router,"router_db_ip",t)},expression:"apply.Router.router_db_ip"}})],1),a("let-form-item",{attrs:{label:e.$t("service.routerDbPort"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.apply.Router.router_db_port,callback:function(t){e.$set(e.apply.Router,"router_db_port",t)},expression:"apply.Router.router_db_port"}})],1),a("let-form-item",{attrs:{label:e.$t("service.routerDbUser"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.apply.Router.router_db_user,callback:function(t){e.$set(e.apply.Router,"router_db_user",t)},expression:"apply.Router.router_db_user"}})],1),a("let-form-item",{attrs:{label:e.$t("service.routerDbPass"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.apply.Router.router_db_pass,callback:function(t){e.$set(e.apply.Router,"router_db_pass",t)},expression:"apply.Router.router_db_pass"}})],1)],1)],1),a("let-form-group",{attrs:{title:e.$t("apply.ProxyConfigInfo"),inline:"","label-position":"top"}},[a("let-table",{ref:"table",attrs:{data:e.apply.Proxy,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name",width:"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.server_name,callback:function(a){e.$set(t.row,"server_name",a)},expression:"scope.row.server_name"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("service.multipleIp"),prop:"server_ip",width:"40%",required:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"",multiple:"",placeholder:"Please Choose"},model:{value:t.row.server_ip,callback:function(a){e.$set(t.row,"server_ip",a)},expression:"scope.row.server_ip"}},e._l(e.nodeList,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+" ")])})),1)]}}])}),a("let-table-column",{attrs:{title:e.$t("region.idcArea"),prop:"idc_area"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.idc_area)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.template"),prop:"template_file",width:"10%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.templateTips")},model:{value:t.row.template_file,callback:function(a){e.$set(t.row,"template_file",a)},expression:"scope.row.template_file"}},e._l(e.templates,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)]}}])}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),prop:"appName",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-table-operation",{on:{click:function(t){return e.ensureDelete(r)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1)],1),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.createService}},[e._v(e._s(e.$t("apply.createRouterProxyService"))+" ")])],1)],1)},Fo=[],Jo=(a("3e8f"),function(){return{apply_id:17,create_person:"adminUser",router_db_ip:"",router_db_name:"",router_db_pass:"",router_db_port:"3306",router_db_user:"",server_ip:"",server_name:"",template_file:""}}),Bo=function(){return{apply_id:17,create_person:"adminUser",idc_area:"SZ",server_ip:[],server_name:"",template_file:""}},Vo={data:function(){var e=this.$route.params.applyId;return{nodeList:[],templates:[],applyId:e,apply:{dbMethod:!1,routerDbId:0,Router:Jo(),Proxy:[Bo()]},routerDb:[]}},methods:{getNodeList:function(){var e=this;return this.$tars.getJSON("/server/api/node_list").then((function(t){e.nodeList=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},templateNameList:function(){var e=this;return this.$tars.getJSON("/server/api/template_name_list").then((function(t){e.templates=t,e.apply.Router.template_file="tars.cpp.default",e.apply.Proxy.forEach((function(e){return e.template_file="tars.cpp.default"}))})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},changeStatus:function(){},getApplyInfo:function(){var e=this,t=this.applyId;return this.$ajax.getJSON("/server/api/get_apply_and_router_and_proxy",{applyId:t}).then((function(t){e.apply=t||{}})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},createService:function(){var e=this;if(void 0!=this.apply.dbMethod){for(var t=0;t<this.apply.Proxy.length;t++){var a=this.apply.Proxy[t];if(0==a.server_ip.length)return void this.$tip.error("".concat(this.$t("apply.proxyIp")))}if(this.$refs.detailForm.validate()){var r=this.apply,o="/server/api/save_router_proxy",n=this.checkDuplicateIp(r.Proxy);if(n)this.$tip.error(this.$t("apply.duplicateIp"));else{var s=this.$Loading.show();this.$ajax.postJSON(o,r).then((function(t){s.hide();var a=e.applyId;e.$router.push("/operation/apply/installAndPublish/"+a)})).catch((function(t){s.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}}}else this.$tip.error("".concat(this.$t("apply.dbMethod")))},checkDuplicateIp:function(e){var t=[],a=!1;return e.forEach((function(e){e.server_ip.filter((function(e){return e})).forEach((function(e){t.indexOf(e)>-1?a=!0:t.push(e)}))})),a},loadRouterDb:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",e.$ajax.getJSON("/server/api/load_router_db").then((function(t){e.routerDb=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))})));case 1:case"end":return t.stop()}}),t)})))()},ensureDelete:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$confirm(t.$t("dcache.operationManage.ensureDelete"));case 3:return a.abrupt("return",t.$ajax.postJSON("/server/api/delete_apply_proxy",{id:e.id}).then((function(a){1==a&&t.apply.Proxy.forEach((function(a,r,o){if(a.id==e.id)return o.splice(r,1),void(t.apply.Proxy=o)}))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))})));case 6:a.prev=6,a.t0=a["catch"](0),t.$tip.error(a.t0.message);case 9:case"end":return a.stop()}}),a,null,[[0,6]])})))()}},created:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getApplyInfo();case 2:return t.next=4,e.templateNameList();case 4:return t.next=6,e.getNodeList();case 6:return t.next=8,e.loadRouterDb();case 8:case"end":return t.stop()}}),t)})))()}},Go=Vo,Wo=(a("72c4"),Object(h["a"])(Go,zo,Fo,!1,null,null,null)),Ko=Wo.exports,Ho=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_install_and_publish"},[a("let-form",{ref:"detailForm",attrs:{"label-position":"top"}},[a("let-form-group",{attrs:{title:e.$t("common.baseInfo"),inline:"","label-position":"top"}},[a("let-form-item",{attrs:{label:e.$t("apply.name"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.name)+" ")]),a("let-form-item",{attrs:{label:e.$t("common.admin"),itemWidth:"240px"}},[e._v(" "+e._s(e.apply.admin)+" ")]),a("let-form-item",{attrs:{label:e.$t("region.idcArea"),itemWidth:"240px"}},[e._v(" "+e._s(e.apply.idc_area)+" ")]),a("let-form-item",{attrs:{label:e.$t("region.setArea"),itemWidth:"240px"}},[e._v(" "+e._s(e.apply.set_area.join(","))+" ")]),a("let-form-item",{attrs:{label:e.$t("common.createPerson"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.create_person)+" ")])],1),a("let-form-group",{attrs:{title:e.$t("apply.RouterConfigInfo"),inline:"","label-position":"top"}},[a("let-form-item",{attrs:{label:e.$t("service.serverName"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.server_name)+" ")]),a("let-form-item",{attrs:{label:e.$t("service.serverIp"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.server_ip)+" ")]),a("let-form-item",{attrs:{label:e.$t("service.templateFile"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.template_file)+" ")]),a("let-form-item",{attrs:{label:e.$t("service.routerDbName"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.router_db_name)+" ")]),a("br"),a("let-form-item",{attrs:{label:e.$t("service.routerDbIp"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.router_db_ip)+" ")]),a("let-form-item",{attrs:{label:e.$t("service.routerDbPort"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.router_db_port)+" ")]),a("let-form-item",{attrs:{label:e.$t("service.routerDbUser"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.router_db_user)+" ")]),a("let-form-item",{attrs:{label:e.$t("service.routerDbPass"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.apply.Router.router_db_pass)+" ")])],1),a("let-form-group",{attrs:{title:e.$t("apply.ProxyConfigInfo"),inline:"","label-position":"top"}},[a("let-table",{ref:"table",attrs:{data:e.apply.Proxy,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name",width:"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.server_name)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.multipleIp"),prop:"server_ip",width:"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.server_ip)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("region.idcArea"),prop:"idc_area"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.idc_area)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("service.templateFile"),prop:"template_file"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.template_file)+" ")]}}])})],1)],1),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.installAndPublish}},[e._v(e._s(e.$t("apply.installAndPublish"))+" ")])],1),a("let-modal",{attrs:{title:e.$t("publishLog.title"),width:"800px"},on:{"on-confirm":e.confirmPublish},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[a("let-table",{ref:"ProgressTable",staticStyle:{"margin-top":"20px"},attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("module.title"),prop:"module",width:"20%"}}),a("let-table-column",{attrs:{title:e.$t("publishLog.releaseId"),prop:"releaseId",width:"20%"}}),a("let-table-column",{attrs:{title:e.$t("publishLog.releaseProgress"),prop:"percent"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row,o=r.percent,n=r.errMsg;return[n?a("p",{staticStyle:{color:"red"}},[e._v(e._s(n))]):a("span",[e._v(e._s(o))]),100===o||n?e._e():a("icon",{staticClass:"spinner-icon",attrs:{name:"spinner"}})]}}])})],1),a("let-tag",{staticStyle:{margin:"auto"},attrs:{theme:"success",checked:""}},[e._v(e._s(e.$t("publishLog.publishInfo")))])],1)],1)},Uo=[],Zo=(a("2ff6"),function(){return{apply_id:17,create_person:"adminUser",router_db_ip:"",router_db_name:"",router_db_pass:"",router_db_port:"",router_db_user:"",server_ip:"",server_name:"",template_file:""}}),Yo=function(){return{apply_id:17,create_person:"adminUser",idc_area:"sz",server_ip:"",server_name:"",template_file:""}},Qo={data:function(){var e=this.$route.params.applyId;return{applyId:e,showModal:!1,items:[],apply:{set_area:[],Router:Zo(),Proxy:[Yo()]},timerId:null}},methods:{getApplyInfo:function(){var e=this,t=this.applyId;this.$ajax.getJSON("/server/api/get_apply_and_router_and_proxy",{applyId:t}).then((function(t){e.apply=t||{}})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},installAndPublish:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s,i,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$loading.show(),t.prev=1,r=e.applyId,t.next=5,La({applyId:r});case 5:o=t.sent,n=o.proxy,s=o.router,e.showModal=!0,i=n.releaseId,l=s.releaseId,e.items=[{module:"ProxyServer",releaseId:i,percent:"0",errMsg:"",timer:""},{module:"RouterServer",releaseId:l,percent:"0",errMsg:"",timer:""}],e.items.forEach((function(t){return e.repeatGetReleaseProgress(t)})),t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](1),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 18:a.hide();case 19:case"end":return t.stop()}}),t,null,[[1,15]])})))()},repeatGetReleaseProgress:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return clearTimeout(e.timer),a.prev=1,a.next=4,ha({releaseId:e.releaseId});case 4:r=a.sent,o=r.percent,e.percent=o,100===o?clearTimeout(e.timer):e.timer=setTimeout(t.repeatGetReleaseProgress.bind(t,e),1e3),a.next=15;break;case 10:a.prev=10,a.t0=a["catch"](1),t.$tip.error("".concat(t.$t("common.error"),": ").concat(a.t0.message||a.t0.err_msg)),e.errMsg=a.t0,clearTimeout(e.timer);case 15:case"end":return a.stop()}}),a,null,[[1,10]])})))()},confirmPublish:function(){this.showModal=!1,document.body.classList.remove("has-modal-open"),this.$router.push("/operation/module/createModule")}},beforeRouteLeave:function(e,t,a){clearTimeout(this.timerId),a()},created:function(){this.getApplyInfo()}},Xo=Qo,en=(a("d118"),Object(h["a"])(Xo,Ho,Uo,!1,null,null,null)),tn=en.exports,an=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_module"},[a("let-steps",{staticClass:"apply_steps",attrs:{current:e.step}},[a("let-step",{attrs:{title:e.$t(e.title1)}}),a("let-step",{attrs:{title:e.$t(e.title2)}}),a("let-step",{attrs:{title:e.$t(e.title3)}}),a("let-step",{attrs:{title:e.$t(e.title4)}})],1),a("router-view",{staticClass:"page_operation_apply_children"})],1)},rn=[],on={data:function(){var e=this.$route.fullPath,t=1;return e.indexOf("createApply")>-1?t=1:e.indexOf("moduleConfig")>-1?t=2:e.indexOf("serverConfig")>-1?t=3:e.indexOf("installAndPublish")>-1&&(t=4),{title1:"module.createModule",title2:"module.moduleConfig",title3:"module.serverConfig",title4:"apply.installAndPublish",step:t}},watch:{$route:function(e,t){var a=e.fullPath;a.indexOf("createApply")>-1?this.step=1:a.indexOf("moduleConfig")>-1?this.step=2:a.indexOf("serverConfig")>-1?this.step=3:a.indexOf("installAndPublish")>-1&&(this.step=4)}},methods:{}},nn=on,sn=(a("b4ba"),Object(h["a"])(nn,an,rn,!1,null,null,null)),ln=sn.exports,cn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_create_module"},[a("let-form",{ref:"detailForm",attrs:{inline:""}},[a("let-form-item",{attrs:{label:e.$t("apply.title"),itemWidth:"240px",required:""}},[a("let-select",{attrs:{size:"small",required:"",filterable:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.apply_id,callback:function(t){e.$set(e.model,"apply_id",t)},expression:"model.apply_id"}},e._l(e.applys,(function(t){return a("let-option",{key:t.id,attrs:{value:t.id}},[e._v(" "+e._s(t.name)+" ")])})),1)],1),a("let-form-item",{attrs:{label:e.$t("module.name"),itemWidth:"240px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty"),pattern:"^[a-zA-Z0-9]+$"},model:{value:e.model.module_name,callback:function(t){e.$set(e.model,"module_name",t)},expression:"model.module_name"}})],1),a("div",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.createModule}},[e._v(e._s(e.$t("common.nextStep")))])],1)],1),a("let-modal",{attrs:{title:e.$t("module.update"),width:"800px"},on:{"on-confirm":e.onConfirmUpdate},model:{value:e.showUpdate,callback:function(t){e.showUpdate=t},expression:"showUpdate"}},[a("let-form",{attrs:{"label-position":"top"}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},on:{change:e.changeUpdate},model:{value:e.model.update,callback:function(t){e.$set(e.model,"update",t)},expression:"model.update"}},e._l(e.updateModuleType,(function(t){return a("let-option",{key:t.key,attrs:{value:t.key}},[e._v(" "+e._s(e.$t(t.value))+" ")])})),1),e.info.length>0?a("let-tag",{staticStyle:{"margin-top":"20px"},attrs:{size:"small"}},[e._v(e._s(e.info))]):e._e()],1)],1)],1)},un=[],dn=function(){return{apply_id:"",module_name:"",follower:"",update:0}},mn=[{key:0,value:"cache.installFull",info:"cache.installFullInfo"},{key:1,value:"cache.installDbAccess",info:"cache.installDbAccessInfo"},{key:2,value:"cache.installBackup",info:""},{key:3,value:"cache.installMirror",info:""}],pn={data:function(){return{model:dn(),applys:[],updateModuleType:mn,showUpdate:!1,info:"",moduleInfo:{}}},methods:{changeUpdate:function(){this.info=this.$t(this.updateModuleType[this.model.update].info)},onConfirmUpdate:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a="/server/api/add_module_base_info",t.next=4,e.$ajax.postJSON(a,e.model);case 4:r=t.sent,e.$router.push("/operation/module/moduleConfig/"+r.id),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},createModule:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.applys.filter((function(t){return t.id==e.model.apply_id}))[0].name,0==e.model.module_name.indexOf(a)&&e.model.module_name.length>a.length){t.next=4;break}return e.$tip.error("".concat(e.$t("module.namingError"))),t.abrupt("return");case 4:if(!e.$refs.detailForm.validate()){t.next=29;break}return r=e.$Loading.show(),t.prev=6,o=e.model,t.next=10,e.$ajax.getJSON("/server/api/has_module_info",o);case 10:if(n=t.sent,n.hasModule){t.next=19;break}return s="/server/api/add_module_base_info",t.next=15,e.$ajax.postJSON(s,o);case 15:i=t.sent,e.$router.push("/operation/module/moduleConfig/"+i.id),t.next=21;break;case 19:e.changeUpdate(),e.showUpdate=!0;case 21:t.next=26;break;case 23:t.prev=23,t.t0=t["catch"](6),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 26:return t.prev=26,r.hide(),t.finish(26);case 29:case"end":return t.stop()}}),t,null,[[6,23,26,29]])})))()}},beforeRouteEnter:function(e,t,a){W.getJSON("/server/api/get_apply_list").then((function(e){e.length?a((function(t){e=e.sort((function(e,t){var a=e.name.toLowerCase(),r=t.name.toLowerCase();return a<r?-1:a>r?1:0})),t.applys=e})):a((function(e){e.$tip.warning("".concat(e.$t("common.warning"),": ").concat(e.$t("module.createApplyTips"))),e.$router.push("/operation/apply/createApply")}))})).catch((function(e){alert(e.message||e.err_msg)}))}},hn=pn,fn=Object(h["a"])(hn,cn,un,!1,null,null,null),vn=fn.exports,gn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_module_info"},[a("let-form",{ref:"detailForm",attrs:{inline:""}},[a("let-form-item",{attrs:{label:e.$t("module.name"),itemWidth:"150px",required:""}},[a("let-poptip",{attrs:{placement:"top",content:e.$t("module.namingRule"),trigger:"hover"}},[a("let-input",{attrs:{disabled:"",size:"small",placeholder:e.$t("module.namingRule"),required:"","required-tip":e.$t("deployService.table.tips.empty"),pattern:"^[a-zA-Z][a-zA-Z0-9]+$","pattern-tip":e.$t("module.namingRule")},model:{value:e.moduleInfo.module_name,callback:function(t){e.$set(e.moduleInfo,"module_name",t)},expression:"moduleInfo.module_name"}})],1)],1),a("let-form-item",{attrs:{label:e.$t("module.cacheType"),itemWidth:"200px",required:""}},[a("let-select",{attrs:{size:"small",disabled:0!=e.moduleInfo.update,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},e._l(e.types,(function(t){return a("let-option",{key:t.key,attrs:{value:t.key}},[e._v(" "+e._s(t.value)+" ")])})),1)],1),a("let-form-item",{attrs:{label:e.$t("cache.perRecordAvg"),itemWidth:"200px",required:""}},[a("let-input",{attrs:{size:"small",disabled:0!=e.moduleInfo.update,placeholder:e.$t("cache.perRecordAvgUnit"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.per_record_avg,callback:function(t){e.$set(e.model,"per_record_avg",t)},expression:"model.per_record_avg"}})],1),a("let-form-item",{attrs:{label:e.$t("module.deployArea"),itemWidth:"100px"}},[a("let-select",{attrs:{size:"small",required:"",disabled:0!=e.moduleInfo.update},on:{change:e.changeSelect},model:{value:e.model.idc_area,callback:function(t){e.$set(e.model,"idc_area",t)},expression:"model.idc_area"}},e._l(e.regions,(function(t){return a("let-option",{key:t.label,attrs:{value:t.label}},[e._v(" "+e._s(t.region)+" ")])})),1)],1),a("let-form-item",{attrs:{label:e.$t("module.openBackup"),itemWidth:"100px",required:""}},[a("let-switch",{attrs:{disabled:0!=e.moduleInfo.update},model:{value:e.model.open_backup,callback:function(t){e.$set(e.model,"open_backup",t)},expression:"model.open_backup"}},[a("span",{attrs:{slot:"1"},slot:"1"},[e._v(e._s(e.$t("module.openBackup")))]),a("span",{attrs:{slot:"0"},slot:"0"},[e._v(e._s(e.$t("module.closeBackup")))])])],1),a("let-form-item",{attrs:{label:e.$t("region.setArea"),itemWidth:"200px"}},[a("let-select",{attrs:{size:"small",disabled:0!=e.moduleInfo.update&&3!=e.moduleInfo.update,multiple:""},model:{value:e.model.set_area,callback:function(t){e.$set(e.model,"set_area",t)},expression:"model.set_area"}},e._l(e.setRegions,(function(t){return a("let-option",{key:t.label,attrs:{value:t.label}},[e._v(" "+e._s(t.region)+" ")])})),1)],1),a("br"),a("let-form-item",{attrs:{label:e.$t("module.scenario"),itemWidth:"240px",required:""}},[a("let-select",{attrs:{size:"small",disabled:0!=e.moduleInfo.update&&1!=e.moduleInfo.update,required:"","required-tip":e.$t("deployService.table.tips.empty")},on:{change:e.changeDbAccessServant},model:{value:e.model.cache_module_type,callback:function(t){e.$set(e.model,"cache_module_type",t)},expression:"model.cache_module_type"}},e._l(e.cacheModuleType,(function(t){return a("let-option",{key:t.key,attrs:{value:t.key}},[e._v(" "+e._s(e.$t(t.value))+" ")])})),1)],1),1==e.model.cache_module_type?a("let-form-item",{attrs:{label:e.$t("cache.cacheType"),itemWidth:"500px",required:""}},[a("let-radio-group",{attrs:{size:"small",disabled:0!=e.moduleInfo.update&&1!=e.moduleInfo.update,required:"",data:e.cacheTypeOption},model:{value:e.model.key_type,callback:function(t){e.$set(e.model,"key_type",t)},expression:"model.key_type"}})],1):e._e(),2==e.model.cache_module_type?a("let-form-item",{attrs:{label:e.$t("cache.dbAccessServantObj"),itemWidth:"400px",required:""}},[a("let-input",{attrs:{size:"small",disabled:0!=e.moduleInfo.update&&1!=e.moduleInfo.update,placeholder:e.$t("cache.dbAccessServantObjEx"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.dbAccessServant,callback:function(t){e.$set(e.model,"dbAccessServant",t)},expression:"model.dbAccessServant"}})],1):e._e(),a("br"),a("br"),a("let-form-item",{attrs:{label:e.$t("cache.moduleRemark"),itemWidth:"516px",required:""}},[a("let-input",{attrs:{size:"small",type:"textarea",rows:4,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.model.module_remark,callback:function(t){e.$set(e.model,"module_remark",t)},expression:"model.module_remark"}})],1),a("div",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.addModuleConfig}},[e._v(e._s(e.$t("common.nextStep")))])],1)],1)],1)},_n=[],bn=a("ade3"),$n=function(){var e;return e={admin:"",idc_area:"",key_type:null,module_name:"",cache_module_type:2},Object(bn["a"])(e,"key_type",""),Object(bn["a"])(e,"dbAccessServant",""),Object(bn["a"])(e,"per_record_avg","100"),Object(bn["a"])(e,"total_record","1000"),Object(bn["a"])(e,"max_read_flow","100000"),Object(bn["a"])(e,"max_write_flow","100000"),Object(bn["a"])(e,"module_remark",""),Object(bn["a"])(e,"set_area",[]),Object(bn["a"])(e,"module_id",""),Object(bn["a"])(e,"apply_id",""),Object(bn["a"])(e,"open_backup",!1),Object(bn["a"])(e,"cache_version",1),Object(bn["a"])(e,"mkcache_struct",0),e},kn=[{key:"1-0",value:"key-value(KVCache)"},{key:"2-1",value:"k-k-row(MKVCache)"},{key:"2-2",value:"Set(MKVCache)"},{key:"2-3",value:"List(MKVCache)"},{key:"2-4",value:"Zset(MKVCache)"}],wn=[{key:1,value:"cache.title"},{key:2,value:"cache.cachePersistent"}],yn=[{key:"0",value:"string"}],Mn={data:function(){var e=[{value:"1",text:this.$t("cache.cacheTypeTip1")},{value:"2",text:this.$t("cache.cacheTypeTip2")},{value:"3",text:this.$t("cache.cacheTypeTip3")}];return{cacheTypeOption:e,keyTypeOption:yn,cacheModuleType:wn,regions:[],setRegions:[],types:kn,moduleInfo:{update:0},model:$n()}},computed:{type:{get:function(){return this.model.cache_version?this.model.cache_version+"-"+this.model.mkcache_struct:""},set:function(e){var t=e.split("-");this.model.cache_version=t[0],this.model.mkcache_struct=t[1]}}},methods:{addModuleConfig:function(){var e=this;if(3!=this.moduleInfo.update||0!=this.model.set_area.length){if(this.$refs.detailForm.validate()){var t=this.model,a=this.$Loading.show();this.$ajax.postJSON("/server/api/overwrite_module_config",t).then((function(t){a.hide(),e.$router.push("/operation/module/serverConfig/"+t.module_id)})).catch((function(t){a.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg)),e.$router.push("/operation/module/serverConfig/"+data.module_id)}))}}else this.$tip.error("".concat(this.$t("common.error"),": ").concat(this.$t("module.chooseMirror")))},changeDbAccessServant:function(){1==this.model.cache_module_type?this.model.dbAccessServant="":this.model.dbAccessServant="DCache."+this.moduleInfo.module_name+"DbAccessServer.DbAccessObj"},changeSelect:function(){var e=this;if(3!=this.moduleInfo.update){var t=this.regions.concat();t.splice(t.indexOf(t.find((function(t){return t.label==e.model.idc_area}))),1),this.setRegions=t}else{var a=this.model.set_area.slice(0);a.push(this.model.idc_area);var r=this.regions.concat();r=r.filter((function(e){for(var t=0;t<a.length;t++)if(a[t]==e.label)return!1;return!0})),this.model.set_area=[],this.setRegions=r}},getRegionList:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$ajax.getJSON("/server/api/get_region_list");case 3:e.regions=t.sent,t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 9:case 10:case"end":return t.stop()}}),t,null,[[0,6]])})))()},getModuleInfo:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=e.$route.params.moduleId,t.next=4,e.$ajax.getJSON("/server/api/get_module_info",{moduleId:a});case 4:if(e.moduleInfo=t.sent,0==e.moduleInfo.update){t.next=9;break}return t.next=8,e.$ajax.getJSON("/server/api/get_module_config_info_by_module_name",{module_name:e.moduleInfo.module_name});case 8:e.model=t.sent;case 9:e.model.apply_id=e.moduleInfo.apply_id,e.model.module_id=e.moduleInfo.id,e.model.module_name=e.moduleInfo.module_name,e.changeDbAccessServant(),e.regions&&(e.model.idc_area=e.regions[0].label),t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 19:case 20:case"end":return t.stop()}}),t,null,[[0,16]])})))()}},created:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getRegionList();case 2:e.getModuleInfo();case 3:case"end":return t.stop()}}),t)})))()}},xn=Mn,Sn=(a("6e27"),Object(h["a"])(xn,gn,_n,!1,null,null,null)),Cn=Sn.exports,Nn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_create_service"},[a("let-form",{ref:"detailForm",attrs:{inline:""}},[e.moduleData.length>0?a("let-form-group",{attrs:{title:e.$t("module.serverInfo"),inline:"","label-position":"top"}},[a("let-table",{ref:"table",attrs:{data:e.moduleData,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("module.name"),prop:"module_name"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.module_name)+" ")]}}],null,!1,3619543743)}),a("let-table-column",{attrs:{title:e.$t("module.serverGroup"),prop:"group_name"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.group_name)+" ")]}}],null,!1,3294421626)}),a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.server_name)+" ")]}}],null,!1,445723232)}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceType"),prop:"server_type"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.mapServerType(t.row.server_type))+" ")]}}],null,!1,2269225375)}),a("let-table-column",{attrs:{title:e.$t("service.serverIp"),prop:"server_ip"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{required:"",size:"small"},model:{value:t.row.server_ip,callback:function(a){e.$set(t.row,"server_ip",a)},expression:"scope.row.server_ip"}},e._l(e.nodeList,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+" ")])})),1)]}}],null,!1,51958731)}),a("let-table-column",{attrs:{title:e.$t("module.shmKey"),prop:"shmKey"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",placeholder:e.$t("module.shmKeyRule")},model:{value:t.row.shmKey,callback:function(a){e.$set(t.row,"shmKey",a)},expression:"scope.row.shmKey"}})]}}],null,!1,627567251)}),a("let-table-column",{attrs:{title:e.$t("deployService.form.template")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.templateTips")},model:{value:t.row.template_name,callback:function(a){e.$set(t.row,"template_name",a)},expression:"scope.row.template_name"}},e._l(e.templates,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)]}}],null,!1,3938279393)}),a("let-table-column",{attrs:{title:e.$t("module.memorySize"),prop:"memory"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{staticStyle:{width:"60px"},attrs:{size:"small",placeholder:e.$t("module.memorySize"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.memory,callback:function(a){e.$set(t.row,"memory",a)},expression:"scope.row.memory"}})]}}],null,!1,882486889)}),a("let-table-column",{attrs:{title:e.$t("module.deployArea"),prop:"area"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.area)+" ")]}}],null,!1,4009109098)})],1)],1):e._e(),e.isDbAccess()?a("div",[a("let-form-group",{attrs:{title:e.$t("module.dbAccessInfo")+"("+e.dbAccess.servant+")",inline:"","label-position":"top"}},[1==this.cacheVersion?a("let-form-item",{attrs:{label:e.$t("service.isSerializated"),itemWidth:"400px",required:""}},[a("let-radio-group",{attrs:{size:"small",data:e.cacheTypeOption},model:{value:e.dbAccess.isSerializated,callback:function(t){e.$set(e.dbAccess,"isSerializated",t)},expression:"dbAccess.isSerializated"}})],1):e._e(),a("br"),a("let-form-item",{attrs:{label:e.$t("service.multipleIp"),itemWidth:"350px",required:""}},[a("let-select",{attrs:{size:"small",required:"",multiple:"",placeholder:"Please Choose"},model:{value:e.dbAccess.dbaccess_ip,callback:function(t){e.$set(e.dbAccess,"dbaccess_ip",t)},expression:"dbAccess.dbaccess_ip"}},e._l(e.nodeList,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(" "+e._s(t)+" ")])})),1)],1),a("br"),a("let-form-item",{attrs:{label:e.$t("cache.db.DBPrefix"),itemWidth:"200px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.dbAccess.db_prefix,callback:function(t){e.$set(e.dbAccess,"db_prefix",t)},expression:"dbAccess.db_prefix"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.db.tablePrefix"),itemWidth:"200px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.dbAccess.table_prefix,callback:function(t){e.$set(e.dbAccess,"table_prefix",t)},expression:"dbAccess.table_prefix"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.db.dbNum"),itemWidth:"200px",required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.dbAccess.db_num,callback:function(t){e.$set(e.dbAccess,"db_num",t)},expression:"dbAccess.db_num"}},[a("let-option",{key:"1",attrs:{value:"1"}},[e._v(" 1 ")]),a("let-option",{key:"10",attrs:{value:"10"}},[e._v(" 10 ")])],1)],1),a("let-form-item",{attrs:{label:e.$t("cache.db.tableNum"),itemWidth:"200px",required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.dbAccess.table_num,callback:function(t){e.$set(e.dbAccess,"table_num",t)},expression:"dbAccess.table_num"}},[a("let-option",{key:"1",attrs:{value:"1"}},[e._v(" 1 ")]),a("let-option",{key:"10",attrs:{value:"10"}},[e._v(" 10 ")])],1)],1),a("let-form-item",{attrs:{label:e.$t("cache.db.tableCharset"),itemWidth:"200px",required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.dbAccess.db_charset,callback:function(t){e.$set(e.dbAccess,"db_charset",t)},expression:"dbAccess.db_charset"}},[a("let-option",{key:"utf8mb4",attrs:{value:"utf8mb4"}},[e._v("utf8mb4")]),a("let-option",{key:"utf8",attrs:{value:"utf8"}},[e._v("utf8")]),a("let-option",{key:"gbk",attrs:{value:"gbk"}},[e._v("gbk")]),a("let-option",{key:"latin1",attrs:{value:"latin1"}},[e._v("latin1")])],1)],1),e.accessDb.length>0?a("div",[a("let-form-item",{attrs:{label:e.$t("cache.accessDbName"),itemWidth:"240px",required:""}},[a("let-radio",{attrs:{label:!0},model:{value:e.dbAccess.dbMethod,callback:function(t){e.$set(e.dbAccess,"dbMethod",t)},expression:"dbAccess.dbMethod"}},[e._v(e._s(e.$t("cache.chooseAccessDb")))])],1),e.dbAccess.dbMethod?a("let-form-item",{attrs:{itemWidth:"200px"}},[a("let-select",{attrs:{size:"small",required:""},model:{value:e.dbAccess.accessDbId,callback:function(t){e.$set(e.dbAccess,"accessDbId",t)},expression:"dbAccess.accessDbId"}},e._l(e.accessDb,(function(t){return a("let-option",{key:t.id,attrs:{value:t.id}},[e._v(" "+e._s(t.access_db_flag)+" ")])})),1)],1):e._e()],1):e._e(),a("br"),a("let-form-item",{attrs:{label:e.$t("cache.accessDbName"),itemWidth:"240px",required:""}},[a("let-radio",{attrs:{label:!1},model:{value:e.dbAccess.dbMethod,callback:function(t){e.$set(e.dbAccess,"dbMethod",t)},expression:"dbAccess.dbMethod"}},[e._v(e._s(e.$t("cache.inputAccessDb")))])],1),a("br"),e.dbAccess.dbMethod?e._e():a("span",[a("let-form-item",{attrs:{label:e.$t("cache.db.dbHost"),itemWidth:"200px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.dbAccess.db_host,callback:function(t){e.$set(e.dbAccess,"db_host",t)},expression:"dbAccess.db_host"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.db.dbUser"),itemWidth:"200px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.dbAccess.db_user,callback:function(t){e.$set(e.dbAccess,"db_user",t)},expression:"dbAccess.db_user"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.db.dbPass"),itemWidth:"200px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.dbAccess.db_pwd,callback:function(t){e.$set(e.dbAccess,"db_pwd",t)},expression:"dbAccess.db_pwd"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.db.dbPort"),itemWidth:"200px",required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.dbAccess.db_port,callback:function(t){e.$set(e.dbAccess,"db_port",t)},expression:"dbAccess.db_port"}})],1)],1)],1)],1):e._e(),a("div",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.submitServerConfig}},[e._v(e._s(e.$t("common.nextStep")))])],1)],1),a("let-modal",{attrs:{title:e.$t("module.MultiKeyConfig"),width:"1000px"},on:{"on-confirm":e.submitMKCache},model:{value:e.showMKModal,callback:function(t){e.showMKModal=t},expression:"showMKModal"}},[a("let-form",{ref:"multiKeyForm",attrs:{"label-position":"top"}},[a("let-form-group",{attrs:{title:e.$t("MKCache.mainKey"),inline:"","label-position":"top"}},[a("let-table",{ref:"mainKey",attrs:{data:e.mkCacheStructure.mainKey,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("MKCache.fieldName"),prop:"fieldName",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.fieldName,callback:function(a){e.$set(t.row,"fieldName",a)},expression:"scope.row.fieldName"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("MKCache.dataType"),prop:"dataType",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.dataType,callback:function(a){e.$set(t.row,"dataType",a)},expression:"scope.row.dataType"}},e._l(e.keyTypeOption,(function(t){return a("let-option",{key:t.key,attrs:{value:t.value}},[e._v(" "+e._s(t.value)+" ")])})),1)]}}])}),a("let-table-column",{attrs:{title:e.$t("MKCache.dataType"),prop:"dataType",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.DBType,callback:function(a){e.$set(t.row,"DBType",a)},expression:"scope.row.DBType"}},e._l(e.keyDbTypeOption,(function(t){return a("let-option",{key:t.key,attrs:{value:t.value}},[e._v(" "+e._s(t.value)+" ")])})),1)]}}])}),a("let-table-column",{attrs:{title:e.$t("MKCache.fieldProperty"),prop:"property",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.property)+" ")]}}])})],1)],1),e.multiKey?a("let-form-group",{attrs:{title:e.$t("MKCache.unionKey"),inline:"","label-position":"top"}},[a("let-table",{ref:"unionKey",attrs:{data:e.mkCacheStructure.unionKey,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("MKCache.fieldName"),prop:"fieldName",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.fieldName,callback:function(a){e.$set(t.row,"fieldName",a)},expression:"scope.row.fieldName"}})]}}],null,!1,4011857556)}),a("let-table-column",{attrs:{title:e.$t("MKCache.dataType"),prop:"dataType",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.dataType,callback:function(a){e.$set(t.row,"dataType",a)},expression:"scope.row.dataType"}},e._l(e.keyTypeOption,(function(t){return a("let-option",{key:t.key,attrs:{value:t.value}},[e._v(" "+e._s(t.value)+" ")])})),1)]}}],null,!1,3544666356)}),a("let-table-column",{attrs:{title:e.$t("MKCache.dataDbType"),prop:"DBType",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.DBType,callback:function(a){e.$set(t.row,"DBType",a)},expression:"scope.row.DBType"}},e._l(e.keyDbTypeOption,(function(t){return a("let-option",{key:t.key,attrs:{value:t.value}},[e._v(" "+e._s(t.value)+" ")])})),1)]}}],null,!1,596108868)}),a("let-table-column",{attrs:{title:e.$t("MKCache.fieldProperty"),prop:"property",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.property)+" ")]}}],null,!1,2792689594)}),a("let-table-column",{attrs:{title:e.$t("MKCache.defaultValue"),prop:"defaultValue",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small"},model:{value:t.row.defaultValue,callback:function(a){e.$set(t.row,"defaultValue",a)},expression:"scope.row.defaultValue"}})]}}],null,!1,3960107341)}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:e.addUnionKey}},[e._v(e._s(e.$t("operate.add")))]),a("let-table-operation",{on:{click:function(a){return e.deleteUnionKey(t.$index)}}},[e._v(e._s(e.$t("operate.delete")))])]}}],null,!1,2698535212)})],1)],1):e._e(),a("let-form-group",{attrs:{title:e.$t("MKCache.dataValue"),inline:"","label-position":"top"}},[a("let-table",{ref:"dataValue",attrs:{data:e.mkCacheStructure.value,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("MKCache.fieldName"),prop:"fieldName",width:"20%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.fieldName,callback:function(a){e.$set(t.row,"fieldName",a)},expression:"scope.row.fieldName"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("MKCache.dataType"),prop:"dataType",width:"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.dataType,callback:function(a){e.$set(t.row,"dataType",a)},expression:"scope.row.dataType"}},e._l(e.dataTypeOption,(function(t){return a("let-option",{key:t.key,attrs:{value:t.value}},[e._v(" "+e._s(t.value)+" ")])})),1)]}}])}),a("let-table-column",{attrs:{title:e.$t("MKCache.dataDbType"),prop:"DBType",width:"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.DBType,callback:function(a){e.$set(t.row,"DBType",a)},expression:"scope.row.DBType"}},e._l(e.dataDbTypeOption,(function(t){return a("let-option",{key:t.key,attrs:{value:t.value}},[e._v(" "+e._s(t.value)+" ")])})),1)]}}])}),a("let-table-column",{attrs:{title:e.$t("MKCache.fieldProperty"),prop:"property",width:"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.property,callback:function(a){e.$set(t.row,"property",a)},expression:"scope.row.property"}},e._l(e.propertyOption,(function(t){return a("let-option",{key:t.key,attrs:{value:t.value}},[e._v(" "+e._s(t.value)+" ")])})),1)]}}])}),a("let-table-column",{attrs:{title:e.$t("MKCache.defaultValue"),prop:"defaultValue",width:"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.defaultValue,callback:function(a){e.$set(t.row,"defaultValue",a)},expression:"scope.row.defaultValue"}})]}}])}),e.dbAccess.isSerializated?a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:e.addValue}},[e._v(e._s(e.$t("operate.add")))]),a("let-table-operation",{on:{click:function(a){return e.deleteValue(t.$index)}}},[e._v(e._s(e.$t("operate.delete")))])]}}],null,!1,1663387276)}):e._e()],1)],1)],1)],1)],1)},Ln=[],Dn=function(){return{module_id:"",accessDbId:0,dbMethod:!0,isSerializated:!1,dbaccess_ip:[],servant:"",db_num:"1",db_prefix:"db_",table_num:"1",table_prefix:"t_",db_charset:"utf8mb4",db_host:"",db_user:"",db_pwd:"",db_port:"3306"}},On=[{key:"string",value:"string"}],Tn=[{key:"int",value:"int"},{key:"long",value:"long"},{key:"string",value:"string"},{key:"byte",value:"byte"},{key:"float",value:"float"},{key:"double",value:"double"}],qn=[{key:"varchar(64)",value:"varchar(64)"},{key:"varchar(128)",value:"varchar(128)"},{key:"varchar(180)",value:"varchar(180)"},{key:"varchar(255)",value:"varchar(255)"},{key:"varchar(1000)",value:"varchar(1000)"}],Pn=[{key:"int",value:"int"},{key:"bigint",value:"bigint"},{key:"varchar(128)",value:"varchar(128)"},{key:"text",value:"MEDIUMTEXT"},{key:"blob",value:"MEDIUMBLOB"},{key:"float",value:"float"},{key:"double",value:"double"}],Rn=[{key:"require",value:"require"},{key:"optional",value:"optional"}],In={data:function(){var e=[{value:!1,text:this.$t("cache.sTypeTip1")},{value:!0,text:this.$t("cache.sTypeTip2")}],t=this.$route.params.moduleId;return{moduleId:t,accessDb:[],moduleInfo:{ModuleBase:{update:0}},dbAccess:Dn(),moduleData:[],nodeList:[],templates:[],cacheVersion:1,isMkCache:!1,multiKey:!1,cacheTypeOption:e,keyTypeOption:On,keyDbTypeOption:qn,dataDbTypeOption:Pn,dataTypeOption:Tn,propertyOption:Rn,showMKModal:!1,mkCacheStructure:{mainKey:[{fieldName:"USERID",keyType:"mkey",dataType:"string",DBType:"varchar(128)",property:"require",defaultValue:"",maxLen:"100"}],unionKey:[{fieldName:"",keyType:"ukey",dataType:"string",DBType:"varchar(128)",property:"require",defaultValue:"",maxLen:""}],value:[{fieldName:"VALUE",keyType:"value",dataType:"string",DBType:"MEDIUMBLOB",property:"require",defaultValue:"",maxLen:""}]}}},mounted:function(){var e=this;this.$tars.getJSON("/server/api/node_list").then((function(t){e.nodeList=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},methods:{isNewInstall:function(){return 0==this.moduleInfo.ModuleBase.update},isDbAccess:function(){return""!=this.dbAccess.servant&&(0==this.moduleInfo.ModuleBase.update||1==this.moduleInfo.ModuleBase.update)},isBackup:function(){return 2==this.moduleInfo.ModuleBase.update},isMirror:function(){return 3==this.moduleInfo.ModuleBase.update},submitServerConfig:function(){if(void 0!=this.dbAccess.dbMethod){if(this.$refs.detailForm.validate())if(this.isDbAccess()&&this.isMkCache){if(this.isDbAccess()&&0==this.dbAccess.dbaccess_ip.length)return void this.$tip.error("".concat(this.$t("cache.dbaccessIp")));this.showMKModal=!0}else this.checkSameShmKey(this.moduleData)?this.addServerConfig():this.$tip.error(this.$t("module.shmKeyError"))}else this.$tip.error("".concat(this.$t("module.dbMethod")))},loadAccessDb:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",e.$ajax.getJSON("/server/api/load_access_db").then((function(t){e.accessDb=t,t.length>0?(e.dbAccess.dbMethod=!0,e.dbAccess.accessDbId=t[0].id):e.dbAccess.dbMethod=!1})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))})));case 1:case"end":return t.stop()}}),t)})))()},checkSameShmKey:function(e){return!0},addServerConfig:function(){var e=this,t=this.moduleData,a=this.dbAccess;if(this.isDbAccess()&&0==this.dbAccess.dbaccess_ip.length)this.$tip.error("".concat(this.$t("cache.dbaccessIp")));else{var r="/server/api/add_server_config",o=this.$Loading.show();this.$ajax.postJSON(r,{moduleData:t,dbAccess:a}).then((function(t){o.hide(),e.$tip.success(e.$t("common.success")),e.$router.push("/operation/module/installAndPublish/"+e.moduleId)})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},templateNameList:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$tars.getJSON("/server/api/template_name_list");case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})))()},getModuleConfigInfo:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.delegateYield(regeneratorRuntime.mark((function t(){var s,i,l,c,u,d,m,p,h,f,v,g,_;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.templateNameList();case 2:return s=t.sent,e.templates=s,i=e.$route.params.moduleId,t.next=7,Oa({moduleId:i});case 7:return l=t.sent,e.moduleInfo=l,c=l.module_name,t.next=12,Ta({module_name:c});case 12:for(r in u=t.sent,a=0,u)u.hasOwnProperty(r)&&a++;if(l.area=l.idc_area,d=1===l.cache_version?"KV":"MKV",l.group_name=l.module_name+d+"Group1",l.server_name=l.module_name+d+"CacheServer1-1",l.server_type=0,l.memory=50,0!=a){t.next=27;break}e.isNewInstall()&&e.moduleData.push(Object(he["a"])({},l)),(e.isBackup()||e.isNewInstall()&&l.open_backup)&&(m=Object(he["a"])(Object(he["a"])({},l),{},{server_name:l.module_name+d+"CacheServer1-2",server_type:1}),e.moduleData.push(m)),(e.isMirror()||e.isNewInstall())&&l.set_area.length>0&&l.set_area.forEach((function(t,a){var r=Object(he["a"])(Object(he["a"])({},l),{},{area:t,server_name:l.module_name+d+"CacheServer1-"+(a+3),server_type:2});e.moduleData.push(r)})),t.next=50;break;case 27:if(!e.isNewInstall()){t.next=31;break}for(o in u)for(r=0;r<u[o].length;r++)p=u[o][r],h=Object(he["a"])(Object(he["a"])({},l),{},{group_name:l.module_name+d+"Group"+o,server_name:p.server_name,server_type:p.server_type}),e.moduleData.push(h);t.next=50;break;case 31:if(!e.isBackup()){t.next=49;break}t.t0=regeneratorRuntime.keys(u);case 33:if((t.t1=t.t0()).done){t.next=47;break}o=t.t1.value,n=!1,r=0;case 37:if(!(r<u[o].length)){t.next=44;break}if(1!=u[o][r].server_type){t.next=41;break}return n=!0,t.abrupt("break",44);case 41:r++,t.next=37;break;case 44:for(r=0;r<u[o].length;r++)f=u[o][r],v=Object(he["a"])(Object(he["a"])({},l),{},{group_name:l.module_name+d+"Group"+o,server_name:f.server_name,server_type:f.server_type}),n&&1==f.server_type?e.moduleData.push(v):n||(g=Object(he["a"])(Object(he["a"])({},v),{},{server_name:v.module_name+d+"CacheServer"+o+"-2",server_type:1}),e.moduleData.push(g));t.next=33;break;case 47:t.next=50;break;case 49:if(e.isMirror())for(o in _=function(){var t=u[o][0],a=Object(he["a"])(Object(he["a"])({},l),{},{group_name:l.module_name+d+"Group"+o,server_name:t.server_name,server_type:t.server_type});l.set_area.length>0&&l.set_area.forEach((function(t,r){var n=Object(he["a"])(Object(he["a"])({},a),{},{area:t,group_name:l.module_name+d+"Group"+o,server_name:a.module_name+d+"CacheServer"+o+"-"+(r+3),server_type:2});e.moduleData.push(n)}))},u)_();case 50:e.moduleData=e.moduleData.map((function(e){return Object(he["a"])(Object(he["a"])({},e),{},{template_name:s.includes("DCache.Cache")?"DCache.Cache":"tars.cpp.default"})})),e.isMkCache=2===l.cache_version,e.multiKey=2===l.cache_version&&1===l.mkcache_struct,e.cacheVersion=l.cache_version,1===l.cache_version&&sessionStorage.setItem("mkCache",JSON.stringify(e.mkCacheStructure)),e.multiKey&&(e.dbAccess.isSerializated=!0),e.dbAccess.module_id=e.moduleId,e.dbAccess.db_prefix="db_"+l.module_name+"_",e.dbAccess.table_prefix="t_"+l.module_name+"_",e.dbAccess.servant=l.dbAccessServant;case 60:case"end":return t.stop()}}),t)}))(),"t0",2);case 2:t.next=7;break;case 4:t.prev=4,t.t1=t["catch"](0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t1.message||t.t1.err_msg));case 7:case"end":return t.stop()}}),t,null,[[0,4]])})))()},mapServerType:function(e){return 0===e?this.$t("module.mainServer"):1===e?this.$t("module.backServer"):this.$t("module.mirror")},addUnionKey:function(){this.mkCacheStructure.unionKey.push({fieldName:"",keyType:"ukey",dataType:"",property:"require",DBType:"",defaultValue:"",maxLen:""})},deleteUnionKey:function(e){this.mkCacheStructure.unionKey.length>1?this.mkCacheStructure.unionKey.splice(e,1):this.$tip.error(this.$t("MKCache.error"))},addValue:function(){this.mkCacheStructure.value.push({fieldName:"",keyType:"value",dataType:"",DBType:"",property:"",defaultValue:"",maxLen:""})},deleteValue:function(e){this.mkCacheStructure.value.length>1?this.mkCacheStructure.value.splice(e,1):this.$tip.error(this.$t("MKCache.error"))},submitMKCache:function(){void 0!=this.dbAccess.dbMethod?this.$refs.multiKeyForm.validate()&&(sessionStorage.setItem("mkCache",JSON.stringify(this.mkCacheStructure)),this.showMKModal=!1,document.body.classList.remove("has-modal-open"),this.addServerConfig()):this.$tip.error("".concat(this.$t("module.dbMethod")))}},created:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return sessionStorage.clear(),t.next=3,e.getModuleConfigInfo();case 3:if(!e.isDbAccess()){t.next=6;break}return t.next=6,e.loadAccessDb();case 6:case"end":return t.stop()}}),t)})))()}},En=In,jn=Object(h["a"])(En,Nn,Ln,!1,null,null,null),An=jn.exports,zn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_install_and_publish"},[a("let-form",{ref:"detailForm",attrs:{"label-position":"top"}},[a("let-form-group",{attrs:{title:e.$t("common.baseInfo"),inline:"","label-position":"top"}},[a("let-form-item",{attrs:{label:e.$t("module.moduleId"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.moduleInfo.module_id)+" ")]),a("let-form-item",{attrs:{label:e.$t("module.name"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.moduleInfo.module_name)+" ")]),a("let-form-item",{attrs:{label:e.$t("module.cacheType"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.mapCacheType(e.moduleInfo))+" ")])],1),a("let-form-group",{attrs:{title:e.$t("module.moduleInfo"),inline:"","label-position":"top"}},[a("let-form-item",{attrs:{label:e.$t("module.deployArea"),itemWidth:"240px"}},[e._v(" "+e._s(e.moduleInfo.idc_area)+" ")]),a("let-form-item",{attrs:{label:e.$t("region.setArea"),itemWidth:"240px"}},[e._v(" "+e._s(e.moduleInfo.set_area&&e.moduleInfo.set_area.join(","))+" ")]),a("let-form-item",{attrs:{label:e.$t("module.scenario"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.mapModuleType(e.moduleInfo.cache_module_type))+" ")]),a("let-form-item",{attrs:{label:e.$t("cache.perRecordAvg"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.moduleInfo.per_record_avg)+" ")]),a("let-form-item",{attrs:{label:e.$t("cache.moduleRemark"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.moduleInfo.module_remark)+" ")])],1),e.serverConf.length>0&&1!=this.moduleInfo.ModuleBase.update?a("let-form-group",{attrs:{title:e.$t("module.serverInfo"),inline:"","label-position":"top"}},[a("let-table",{ref:"table",attrs:{data:e.serverConf,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("module.name"),prop:"module_name",width:"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.module_name)+" ")]}}],null,!1,3619543743)}),a("let-table-column",{attrs:{title:e.$t("module.serverGroup"),prop:"group_name",width:"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.group_name)+" ")]}}],null,!1,3294421626)}),a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"server_name"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.server_name)+" ")]}}],null,!1,445723232)}),a("let-table-column",{attrs:{title:e.$t("service.serverIp"),prop:"server_ip"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.server_ip)+" ")]}}],null,!1,4116377982)}),a("let-table-column",{attrs:{title:e.$t("module.deployArea"),prop:"area"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.area)+" ")]}}],null,!1,4009109098)}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceType"),prop:"server_type"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.mapServerType(t.row.server_type))+" ")]}}],null,!1,2269225375)}),a("let-table-column",{attrs:{title:e.$t("module.memorySize"),prop:"memory"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.memory)+" ")]}}],null,!1,3952335548)}),a("let-table-column",{attrs:{title:e.$t("module.shmKey"),prop:"shmKey"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.shmKey)+" ")]}}],null,!1,462509756)})],1)],1):e._e(),this.isDbAccess()?a("let-form-group",{attrs:{title:e.$t("module.dbAccessInfo"),inline:"","label-position":"top"}},[a("let-form-item",{attrs:{label:e.$t("module.servant"),itemWidth:"400px"}},[e._v(" "+e._s(e.dbAccess.servant)+" ")]),a("let-form-item",{attrs:{label:e.$t("service.isSerializated"),itemWidth:"350px"}},[e._v(" "+e._s(e.mapSerializeType(e.dbAccess.isSerializated))+" ")]),a("let-form-item",{attrs:{label:e.$t("module.dbAccessIp"),itemWidth:"400px"}},[e._v(" "+e._s(e.dbAccess.dbaccess_ip)+" ")]),a("br"),a("let-form-item",{attrs:{label:e.$t("cache.db.dbNum"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.dbAccess.db_num)+" ")]),a("let-form-item",{attrs:{label:e.$t("cache.db.DBPrefix"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.dbAccess.db_prefix)+" ")]),a("let-form-item",{attrs:{label:e.$t("cache.db.tableNum"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.dbAccess.table_num)+" ")]),a("let-form-item",{attrs:{label:e.$t("cache.db.tablePrefix"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.dbAccess.table_prefix)+" ")]),a("br"),a("let-form-item",{attrs:{label:e.$t("cache.db.dbHost"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.dbAccess.db_host)+" ")]),a("let-form-item",{attrs:{label:e.$t("cache.db.dbPort"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.dbAccess.db_port)+" ")]),a("let-form-item",{attrs:{label:e.$t("cache.db.dbUser"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.dbAccess.db_user)+" ")]),a("let-form-item",{attrs:{label:e.$t("cache.db.tableCharset"),itemWidth:"240px",required:""}},[e._v(" "+e._s(e.dbAccess.db_charset)+" ")])],1):e._e(),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.installAndPublish}},[e._v(e._s(e.$t("apply.installAndPublish"))+" ")])],1),a("let-modal",{attrs:{title:e.$t("publishLog.title"),width:"800px"},on:{"on-confirm":e.confirmPublish},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[a("let-table",{ref:"ProgressTable",attrs:{data:e.releaseProgress,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("service.serverName"),prop:"serverName",width:"30%"}}),a("let-table-column",{attrs:{title:e.$t("service.serverIp"),prop:"nodeName",width:"30%"}}),a("let-table-column",{attrs:{title:e.$t("publishLog.releaseId"),prop:"releaseId",width:"15%"}}),a("let-table-column",{attrs:{title:e.$t("publishLog.releaseProgress"),prop:"percent"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.percent))]),100!=t.row.percent?a("icon",{staticClass:"spinner-icon",attrs:{name:"spinner"}}):e._e()]}}])})],1)],1)],1)},Fn=[],Jn={data:function(){var e=this.$route.params.moduleId;return{moduleId:e,moduleInfo:{},serverConf:[],dbAccess:{servant:""},releaseProgress:[],showModal:!1,timerId:null}},methods:{isDbAccess:function(){return""!=this.dbAccess.servant&&(0==this.moduleInfo.ModuleBase.update||1==this.moduleInfo.ModuleBase.update)},getModuleFullInfo:function(){var e=this,t=this.moduleId;this.$ajax.getJSON("/server/api/get_module_full_info",{moduleId:t}).then((function(t){e.moduleInfo=t.item||{},e.serverConf=t.serverConf||[],e.dbAccess=t.dbAccess||{servant:""},e.dbAccess.servant=e.dbAccess.servant||""})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},installAndPublish:function(){var e=this,t=this.$loading.show(),a=this.moduleId,r=sessionStorage.getItem("mkCache");this.$ajax.getJSON("/server/api/module_install_and_publish",{moduleId:a,mkCache:r}).then((function(a){t.hide();var r=a.releaseRsp.releaseId;e.getTaskRepeat({releaseId:r}),e.$tip.success(a.releaseRsp.errMsg)})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},getTaskRepeat:function(e){var t=this,a=e.releaseId;clearTimeout(this.timerId),this.showModal=!0;var r=function e(){t.$ajax.getJSON("/server/api/get_module_release_progress",{releaseId:a}).then((function(a){var r=!0;a.progress.forEach((function(e){100!==parseInt(e.percent,10)&&(r=!1)})),r?clearTimeout(t.timerId):t.timerId=setTimeout(e,1e3),t.releaseProgress=a.progress})).catch((function(e){clearTimeout(t.timerId),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))};r()},getReleaseProgress:function(e){var t=this;this.$ajax.getJSON("/server/api/get_module_release_progress",{releaseId:e}).then((function(e){t.showModal=!0,t.releaseProgress=e.progress})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},mapSerializeType:function(e){return e?this.$t("cache.sTypeTip2"):this.$t("cache.sTypeTip1")},mapServerType:function(e){return 0===e?this.$t("module.mainServer"):1===e?this.$t("module.backServer"):this.$t("module.mirror")},mapModuleType:function(e){return 1===e?this.$t("cache.title"):this.$t("cache.cachePersistent")},mapCacheType:function(e){if(!e)return null;if(1===e.cache_version)return"key-value(KVCache)";switch(e.mkcache_struct){case 1:return"k-k-row(MKVCache)";case 2:return"Set(MKVCache)";case 3:return"List(MKVCache)";case 4:return"Zset(MKVCache)";default:return null}},confirmPublish:function(){this.showModal=!1,document.body.classList.remove("has-modal-open"),this.$router.push("/server"),window.dcacheIndex&&window.dcacheIndex.getTreeData&&window.dcacheIndex.getTreeData()}},beforeRouteLeave:function(e,t,a){clearTimeout(this.timerId),a()},created:function(){this.getModuleFullInfo()}},Bn=Jn,Vn=(a("00a7"),Object(h["a"])(Bn,zn,Fn,!1,null,null,null)),Gn=Vn.exports,Wn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation_region"},[a("div",[a("let-button",{attrs:{theme:"primary",size:"mini"},on:{click:e.addRegion}},[e._v(e._s(e.$t("region.add")))])],1),a("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata"),title:e.$t("region.list")}},[a("let-table-column",{attrs:{title:e.$t("region.serial"),width:"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.$index+1))]}}])}),a("let-table-column",{attrs:{title:e.$t("region.title"),prop:"region",width:"25%"}}),a("let-table-column",{attrs:{title:e.$t("region.label"),prop:"label"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editRegion(t.row)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{on:{click:function(a){return e.removeItem(t.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{title:e.$t(e.title),width:"600px"},on:{"on-confirm":e.saveItem},model:{value:e.showModel,callback:function(t){e.showModel=t},expression:"showModel"}},[a("let-form",{ref:"detailForm"},[a("let-form-item",{attrs:{label:e.$t("region.title"),required:""}},[a("let-input",{attrs:{size:"small",required:"",placeholder:e.$t("region.regionTips")},model:{value:e.model.region,callback:function(t){e.$set(e.model,"region",t)},expression:"model.region"}})],1),a("let-form-item",{attrs:{label:e.$t("region.label"),required:""}},[a("let-input",{attrs:{size:"small",required:"",placeholder:e.$t("region.labelTips")},model:{value:e.model.label,callback:function(t){e.$set(e.model,"label",t)},expression:"model.label"}})],1)],1)],1)],1)},Kn=[],Hn={data:function(){return{title:"region.add",items:[],showModel:!1,model:{}}},mounted:function(){this.fetchData()},methods:{fetchData:function(){var e=this;this.$ajax.getJSON("/server/api/get_region_list").then((function(t){e.items=t||[]})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},addRegion:function(){this.showModel=!0,this.title="region.add",this.model={region:"",label:""}},editRegion:function(e){this.showModel=!0,this.showModel=!0,this.title="region.modify",this.model=e},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.model,a=t.id?"/server/api/update_region":"/server/api/add_region",r=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){r.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){r.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this,a=e.id;this.$ajax.getJSON("/server/api/delete_region",{id:a}).then((function(e){t.$tip.success(t.$t("common.success")),t.fetchData()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.showModel=!1,this.model={}}}},Un=Hn,Zn=Object(h["a"])(Un,Wn,Kn,!1,null,null,null),Yn=Zn.exports,Qn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation"},[a("let-tabs",{attrs:{activekey:e.$route.matched[1]?e.$route.matched[1].path:"/operation/apply"},on:{click:e.onTabClick}},[a("let-tab-pane",{attrs:{tab:e.$t("releasePackage.proxyList"),tabkey:"/releasePackage/proxyList"}}),a("let-tab-pane",{attrs:{tab:e.$t("releasePackage.accessList"),tabkey:"/releasePackage/accessList"}}),a("let-tab-pane",{attrs:{tab:e.$t("releasePackage.routerList"),tabkey:"/releasePackage/routerList"}}),a("let-tab-pane",{attrs:{tab:e.$t("releasePackage.kvcacheList"),tabkey:"/releasePackage/kvcacheList"}}),a("let-tab-pane",{attrs:{tab:e.$t("releasePackage.mkvcacheList"),tabkey:"/releasePackage/mkvcacheList"}})],1),a("router-view",{staticClass:"page_operation_children"})],1)},Xn=[],es={methods:{onTabClick:function(e){this.$router.replace(e)}}},ts=es,as=(a("1cf6"),Object(h["a"])(ts,Qn,Xn,!1,null,null,null)),rs=as.exports,os=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"container"},[a("div",[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:function(t){e.uploadModal.show=!e.uploadModal.show}}},[e._v(" "+e._s(e.$t("releasePackage.uploadPackage"))+" ")])],1),a("let-table",{attrs:{data:e.packages.rows,title:e.$t("serverList.title.serverList"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:"ID",prop:"id"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{attrs:{title:e.$t("releasePackage.default")}},[1==t.row.default_version?a("i",{staticClass:"el-icon-refresh-right",staticStyle:{color:"green"}}):e._e()]),e._v(" "+e._s(t.row.id)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("releasePackage.moduleName"),prop:"server"}}),a("let-table-column",{attrs:{title:e.$t("serverList.servant.comment"),prop:"comment"}}),a("let-table-column",{attrs:{title:e.$t("releasePackage.uploadTime"),prop:"posttime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.setDefault(t.row)}}},[e._v(e._s(e.$t("operate.default")))]),a("let-table-operation",{on:{click:function(a){return e.deletePackage(t.row.id)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.upload"),width:"880px",footShow:!1},on:{"on-cancel":e.closeUploadModal},model:{value:e.uploadModal.show,callback:function(t){e.$set(e.uploadModal,"show",t)},expression:"uploadModal.show"}},[e.uploadModal.model?a("let-form",{ref:"uploadForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.uploadPatchPackage(t)}}},[a("let-form-item",{attrs:{label:e.$t("releasePackage.moduleName")}},[e._v(" "+e._s(e.uploadModal.model.application)+"."+e._s(e.uploadModal.model.module_name)+" ")]),a("let-form-item",{attrs:{label:e.$t("pub.dlg.releasePkg"),itemWidth:"400px"}},[a("let-uploader",{attrs:{placeholder:e.$t("pub.dlg.defaultValue")},on:{upload:e.uploadFile}},[e._v(e._s(e.$t("common.submit"))+" ")]),e.uploadModal.model.file?a("span",[e._v(e._s(e.uploadModal.model.file.name))]):e._e()],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.uploadModal.model.comment,callback:function(t){e.$set(e.uploadModal.model,"comment",t)},expression:"uploadModal.model.comment"}})],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("serverList.servant.upload")))])],1):e._e()],1)],1)},ns=[],ss=(a("3ab4"),{data:function(){return{uploadModal:{show:!1,model:{application:"DCache",module_name:"ProxyServer",file:{},comment:""}},packages:{count:0,rows:[]}}},methods:{closeUploadModal:function(){this.uploadModal.show=!1},uploadFile:function(e){this.uploadModal.model.file=e},uploadPatchPackage:function(){var e=this;if(this.$refs.uploadForm.validate()){var t=this.$Loading.show(),a=new FormData;a.append("application",this.uploadModal.model.application),a.append("module_name",this.uploadModal.model.module_name),a.append("task_id",(new Date).getTime()),a.append("suse",this.uploadModal.model.file),a.append("comment",this.uploadModal.model.comment),this.$tars.postForm("/server/api/upload_patch_package",a).then((function(){t.hide(),e.closeUploadModal(),e.getPatchPackage()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}},getPatchPackage:function(){var e=this;this.$tars.getJSON("/server/api/server_patch_list",{application:"DCache",module_name:"ProxyServer"}).then((function(t){e.packages=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},deletePackage:function(e){var t=this;this.$confirm(this.$t("releasePackage.confirmDeleteTip"),this.$t("common.alert")).then((function(){t.$tars.postJSON("/server/api/delete_patch_package",{id:e}).then((function(e){t.getPatchPackage()}))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},setDefault:function(e){var t=this,a=e.id,r=e.package_type;this.$tars.postJSON("/server/api/set_patch_package_default",{id:a,package_type:r,application:this.uploadModal.model.application,module_name:this.uploadModal.model.module_name}).then((function(e){t.$tip.success("".concat(t.$t("common.success"))),t.getPatchPackage()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}},created:function(){this.getPatchPackage()}}),is=ss,ls=Object(h["a"])(is,os,ns,!1,null,null,null),cs=ls.exports,us=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"container"},[a("div",[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:function(t){e.uploadModal.show=!e.uploadModal.show}}},[e._v(" "+e._s(e.$t("releasePackage.uploadPackage"))+" ")])],1),a("let-table",{attrs:{data:e.packages.rows,title:e.$t("serverList.title.serverList"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:"ID",prop:"id"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{color:"green",display:"inline-block"},attrs:{title:e.$t("releasePackage.default")}},[1==t.row.default_version?a("i",{staticClass:"el-icon-refresh-right"}):e._e()]),e._v(" "+e._s(t.row.id)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("releasePackage.moduleName"),prop:"server"}}),a("let-table-column",{attrs:{title:e.$t("serverList.servant.comment"),prop:"comment"}}),a("let-table-column",{attrs:{title:e.$t("releasePackage.uploadTime"),prop:"posttime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.setDefault(t.row)}}},[e._v(e._s(e.$t("operate.default")))]),a("let-table-operation",{on:{click:function(a){return e.deletePackage(t.row.id)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.upload"),width:"880px",footShow:!1},on:{"on-cancel":e.closeUploadModal},model:{value:e.uploadModal.show,callback:function(t){e.$set(e.uploadModal,"show",t)},expression:"uploadModal.show"}},[e.uploadModal.model?a("let-form",{ref:"uploadForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.uploadPatchPackage(t)}}},[a("let-form-item",{attrs:{label:e.$t("releasePackage.moduleName")}},[e._v(" "+e._s(e.uploadModal.model.application)+"."+e._s(e.uploadModal.model.module_name)+" ")]),a("let-form-item",{attrs:{label:e.$t("pub.dlg.releasePkg"),itemWidth:"400px"}},[a("let-uploader",{attrs:{placeholder:e.$t("pub.dlg.defaultValue")},on:{upload:e.uploadFile}},[e._v(e._s(e.$t("common.submit"))+" ")]),e.uploadModal.model.file?a("span",[e._v(e._s(e.uploadModal.model.file.name))]):e._e()],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.uploadModal.model.comment,callback:function(t){e.$set(e.uploadModal.model,"comment",t)},expression:"uploadModal.model.comment"}})],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("serverList.servant.upload")))])],1):e._e()],1)],1)},ds=[],ms={data:function(){return{uploadModal:{show:!1,model:{application:"DCache",module_name:"CombinDbAccessServer",file:{},comment:""}},packages:{count:0,rows:[]}}},methods:{closeUploadModal:function(){this.uploadModal.show=!1},uploadFile:function(e){this.uploadModal.model.file=e},uploadPatchPackage:function(){var e=this;if(this.$refs.uploadForm.validate()){var t=this.$Loading.show(),a=new FormData;a.append("application",this.uploadModal.model.application),a.append("module_name",this.uploadModal.model.module_name),a.append("task_id",(new Date).getTime()),a.append("suse",this.uploadModal.model.file),a.append("comment",this.uploadModal.model.comment),this.$tars.postForm("/server/api/upload_patch_package",a).then((function(){t.hide(),e.closeUploadModal(),e.getPatchPackage()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}},getPatchPackage:function(){var e=this;this.$tars.getJSON("/server/api/server_patch_list",{application:"DCache",module_name:"CombinDbAccessServer"}).then((function(t){e.packages=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},deletePackage:function(e){var t=this;this.$confirm(this.$t("releasePackage.confirmDeleteTip"),this.$t("common.alert")).then((function(){t.$tars.postJSON("/server/api/delete_patch_package",{id:e}).then((function(e){t.getPatchPackage()}))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},setDefault:function(e){var t=this,a=e.id,r=e.package_type;this.$tars.postJSON("/server/api/set_patch_package_default",{id:a,package_type:r,application:this.uploadModal.model.application,module_name:this.uploadModal.model.module_name}).then((function(e){t.getPatchPackage()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}},created:function(){this.getPatchPackage()}},ps=ms,hs=Object(h["a"])(ps,us,ds,!1,null,null,null),fs=hs.exports,vs=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"container"},[a("div",[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:function(t){e.uploadModal.show=!e.uploadModal.show}}},[e._v(" "+e._s(e.$t("releasePackage.uploadPackage"))+" ")])],1),a("let-table",{attrs:{data:e.packages.rows,title:e.$t("serverList.title.serverList"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:"ID",prop:"id"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{color:"green",display:"inline-block"},attrs:{title:e.$t("releasePackage.default")}},[1==t.row.default_version?a("i",{staticClass:"el-icon-refresh-right"}):e._e()]),e._v(" "+e._s(t.row.id)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("releasePackage.moduleName"),prop:"server"}}),a("let-table-column",{attrs:{title:e.$t("serverList.servant.comment"),prop:"comment"}}),a("let-table-column",{attrs:{title:e.$t("releasePackage.uploadTime"),prop:"posttime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.setDefault(t.row)}}},[e._v(e._s(e.$t("operate.default")))]),a("let-table-operation",{on:{click:function(a){return e.deletePackage(t.row.id)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.upload"),width:"880px",footShow:!1},on:{"on-cancel":e.closeUploadModal},model:{value:e.uploadModal.show,callback:function(t){e.$set(e.uploadModal,"show",t)},expression:"uploadModal.show"}},[e.uploadModal.model?a("let-form",{ref:"uploadForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.uploadPatchPackage(t)}}},[a("let-form-item",{attrs:{label:e.$t("releasePackage.moduleName")}},[e._v(" "+e._s(e.uploadModal.model.application)+"."+e._s(e.uploadModal.model.module_name)+" ")]),a("let-form-item",{attrs:{label:e.$t("pub.dlg.releasePkg"),itemWidth:"400px"}},[a("let-uploader",{attrs:{placeholder:e.$t("pub.dlg.defaultValue")},on:{upload:e.uploadFile}},[e._v(e._s(e.$t("common.submit"))+" ")]),e.uploadModal.model.file?a("span",[e._v(e._s(e.uploadModal.model.file.name))]):e._e()],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.uploadModal.model.comment,callback:function(t){e.$set(e.uploadModal.model,"comment",t)},expression:"uploadModal.model.comment"}})],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("serverList.servant.upload")))])],1):e._e()],1)],1)},gs=[],_s={data:function(){return{uploadModal:{show:!1,model:{application:"DCache",module_name:"RouterServer",file:{},comment:""}},packages:{count:0,rows:[]}}},methods:{closeUploadModal:function(){this.uploadModal.show=!1},uploadFile:function(e){this.uploadModal.model.file=e},uploadPatchPackage:function(){var e=this;if(this.$refs.uploadForm.validate()){var t=this.$Loading.show(),a=new FormData;a.append("application",this.uploadModal.model.application),a.append("module_name",this.uploadModal.model.module_name),a.append("task_id",(new Date).getTime()),a.append("suse",this.uploadModal.model.file),a.append("comment",this.uploadModal.model.comment),this.$tars.postForm("/server/api/upload_patch_package",a).then((function(){t.hide(),e.closeUploadModal(),e.getPatchPackage()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}},getPatchPackage:function(){var e=this;this.$tars.getJSON("/server/api/server_patch_list",{application:"DCache",module_name:"RouterServer"}).then((function(t){e.packages=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},deletePackage:function(e){var t=this;this.$confirm(this.$t("releasePackage.confirmDeleteTip"),this.$t("common.alert")).then((function(){t.$tars.postJSON("/server/api/delete_patch_package",{id:e}).then((function(e){t.getPatchPackage()}))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},setDefault:function(e){var t=this,a=e.id,r=e.package_type;this.$tars.postJSON("/server/api/set_patch_package_default",{id:a,package_type:r,application:this.uploadModal.model.application,module_name:this.uploadModal.model.module_name}).then((function(e){t.$tip.success("".concat(t.$t("common.success"))),t.getPatchPackage()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}},created:function(){this.getPatchPackage()}},bs=_s,$s=Object(h["a"])(bs,vs,gs,!1,null,null,null),ks=$s.exports,ws=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"container"},[a("div",[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:function(t){e.uploadModal.show=!e.uploadModal.show}}},[e._v(" "+e._s(e.$t("releasePackage.uploadPackage"))+" ")])],1),a("let-table",{attrs:{data:e.packages.rows,title:e.$t("serverList.title.serverList"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:"ID",prop:"id"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{color:"green",display:"inline-block"},attrs:{title:e.$t("releasePackage.default")}},[1==t.row.default_version?a("i",{staticClass:"el-icon-refresh-right"}):e._e()]),e._v(" "+e._s(t.row.id)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("releasePackage.moduleName"),prop:"server"}}),a("let-table-column",{attrs:{title:e.$t("serverList.servant.comment"),prop:"comment"}}),a("let-table-column",{attrs:{title:e.$t("releasePackage.uploadTime"),prop:"posttime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.setDefault(t.row)}}},[e._v(e._s(e.$t("operate.default")))]),a("let-table-operation",{on:{click:function(a){return e.deletePackage(t.row.id)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.upload"),width:"880px",footShow:!1},on:{"on-cancel":e.closeUploadModal},model:{value:e.uploadModal.show,callback:function(t){e.$set(e.uploadModal,"show",t)},expression:"uploadModal.show"}},[e.uploadModal.model?a("let-form",{ref:"uploadForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.uploadPatchPackage(t)}}},[a("let-form-item",{attrs:{label:e.$t("releasePackage.moduleName")}},[e._v(" "+e._s(e.uploadModal.model.application)+"."+e._s(e.uploadModal.model.module_name)+" ")]),a("let-form-item",{attrs:{label:e.$t("pub.dlg.releasePkg"),itemWidth:"400px"}},[a("let-uploader",{attrs:{placeholder:e.$t("pub.dlg.defaultValue")},on:{upload:e.uploadFile}},[e._v(e._s(e.$t("common.submit"))+" ")]),e.uploadModal.model.file?a("span",[e._v(e._s(e.uploadModal.model.file.name))]):e._e()],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.uploadModal.model.comment,callback:function(t){e.$set(e.uploadModal.model,"comment",t)},expression:"uploadModal.model.comment"}})],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("serverList.servant.upload")))])],1):e._e()],1)],1)},ys=[],Ms={data:function(){return{uploadModal:{show:!1,model:{application:"DCache",module_name:"KVCacheServer",file:{},comment:""}},packages:{count:0,rows:[]}}},methods:{closeUploadModal:function(){this.uploadModal.show=!1},uploadFile:function(e){this.uploadModal.model.file=e},uploadPatchPackage:function(){var e=this;if(this.$refs.uploadForm.validate()){var t=this.$Loading.show(),a=new FormData;a.append("application",this.uploadModal.model.application),a.append("module_name",this.uploadModal.model.module_name),a.append("task_id",(new Date).getTime()),a.append("suse",this.uploadModal.model.file),a.append("comment",this.uploadModal.model.comment),this.$tars.postForm("/server/api/upload_patch_package",a).then((function(){t.hide(),e.closeUploadModal(),e.getPatchPackage()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}},getPatchPackage:function(){var e=this;this.$tars.getJSON("/server/api/server_patch_list",{application:"DCache",module_name:"KVCacheServer"}).then((function(t){e.packages=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},deletePackage:function(e){var t=this;this.$confirm(this.$t("releasePackage.confirmDeleteTip"),this.$t("common.alert")).then((function(){t.$tars.postJSON("/server/api/delete_patch_package",{id:e}).then((function(e){t.getPatchPackage()}))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},setDefault:function(e){var t=this,a=e.id;this.$tars.postJSON("/server/api/set_patch_package_default",{id:a,application:this.uploadModal.model.application,module_name:this.uploadModal.model.module_name}).then((function(e){t.$tip.success("".concat(t.$t("common.success"))),t.getPatchPackage()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}},created:function(){this.getPatchPackage()}},xs=Ms,Ss=Object(h["a"])(xs,ws,ys,!1,null,null,null),Cs=Ss.exports,Ns=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"container"},[a("div",[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:function(t){e.uploadModal.show=!e.uploadModal.show}}},[e._v(" "+e._s(e.$t("releasePackage.uploadPackage"))+" ")])],1),a("let-table",{attrs:{data:e.packages.rows,title:e.$t("serverList.title.serverList"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:"ID",prop:"id"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{color:"green",display:"inline-block"},attrs:{title:e.$t("releasePackage.default")}},[1==t.row.default_version?a("i",{staticClass:"el-icon-refresh-right"}):e._e()]),e._v(" "+e._s(t.row.id)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("releasePackage.moduleName"),prop:"server"}}),a("let-table-column",{attrs:{title:e.$t("serverList.servant.comment"),prop:"comment"}}),a("let-table-column",{attrs:{title:e.$t("releasePackage.uploadTime"),prop:"posttime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.setDefault(t.row)}}},[e._v(e._s(e.$t("operate.default")))]),a("let-table-operation",{on:{click:function(a){return e.deletePackage(t.row.id)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.upload"),width:"880px",footShow:!1},on:{"on-cancel":e.closeUploadModal},model:{value:e.uploadModal.show,callback:function(t){e.$set(e.uploadModal,"show",t)},expression:"uploadModal.show"}},[e.uploadModal.model?a("let-form",{ref:"uploadForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.uploadPatchPackage(t)}}},[a("let-form-item",{attrs:{label:e.$t("releasePackage.moduleName")}},[e._v(" "+e._s(e.uploadModal.model.application)+"."+e._s(e.uploadModal.model.module_name)+" ")]),a("let-form-item",{attrs:{label:e.$t("pub.dlg.releasePkg"),itemWidth:"400px"}},[a("let-uploader",{attrs:{placeholder:e.$t("pub.dlg.defaultValue")},on:{upload:e.uploadFile}},[e._v(e._s(e.$t("common.submit"))+" ")]),e.uploadModal.model.file?a("span",[e._v(e._s(e.uploadModal.model.file.name))]):e._e()],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.uploadModal.model.comment,callback:function(t){e.$set(e.uploadModal.model,"comment",t)},expression:"uploadModal.model.comment"}})],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("serverList.servant.upload")))])],1):e._e()],1)],1)},Ls=[],Ds={data:function(){return{uploadModal:{show:!1,model:{application:"DCache",module_name:"MKVCacheServer",file:{},comment:""}},packages:{count:0,rows:[]}}},methods:{closeUploadModal:function(){this.uploadModal.show=!1},uploadFile:function(e){this.uploadModal.model.file=e},uploadPatchPackage:function(){var e=this;if(this.$refs.uploadForm.validate()){var t=this.$Loading.show(),a=new FormData;a.append("application",this.uploadModal.model.application),a.append("module_name",this.uploadModal.model.module_name),a.append("task_id",(new Date).getTime()),a.append("suse",this.uploadModal.model.file),a.append("comment",this.uploadModal.model.comment),this.$tars.postForm("/server/api/upload_patch_package",a).then((function(){t.hide(),e.closeUploadModal(),e.getPatchPackage()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}},getPatchPackage:function(){var e=this;this.$tars.getJSON("/server/api/server_patch_list",{application:"DCache",module_name:"MKVCacheServer"}).then((function(t){e.packages=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},deletePackage:function(e){var t=this;this.$confirm(this.$t("releasePackage.confirmDeleteTip"),this.$t("common.alert")).then((function(){t.$tars.postJSON("/server/api/delete_patch_package",{id:e}).then((function(e){t.getPatchPackage()}))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},setDefault:function(e){var t=this,a=e.id;this.$tars.postJSON("/server/api/set_patch_package_default",{id:a,application:this.uploadModal.model.application,module_name:this.uploadModal.model.module_name}).then((function(e){t.$tip.success("".concat(t.$t("common.success"))),t.getPatchPackage()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}},created:function(){this.getPatchPackage()}},Os=Ds,Ts=Object(h["a"])(Os,Ns,Ls,!1,null,null,null),qs=Ts.exports,Ps=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"page_operation"},[a("div",[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.addConfig}},[e._v(e._s(e.$t("cache.config.addConfig")))])],1),a("let-table",{attrs:{data:e.list,title:e.$t("cache.config.tableTitle"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:"ID",prop:"id"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.remark"),prop:"remark"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.path"),prop:"path"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.item"),prop:"item"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.reload"),prop:"reload"}}),a("let-table-column",{attrs:{title:e.$t("cache.config.period"),prop:"period"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-table-operation",{on:{click:function(t){return e.editConfig(r)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{staticClass:"danger",on:{click:function(t){return e.deleteConfig(r)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0},model:{value:e.addConfigVisible,callback:function(t){e.addConfigVisible=t},expression:"addConfigVisible"}},[e.addConfigVisible?a("add-config",{on:{"call-back":e.getConfig}}):e._e()],1),a("let-modal",{attrs:{footShow:!1,closeOnClickBackdrop:!0},model:{value:e.editConfigVisible,callback:function(t){e.editConfigVisible=t},expression:"editConfigVisible"}},[e.editConfigVisible?a("edit-config",e._b({on:{"call-back":e.getConfig}},"edit-config",e.editConfigObj,!1)):e._e()],1)],1)},Rs=[],Is=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("let-form",{ref:"addConfigForm",attrs:{type:"medium",title:e.$t("cache.config.addConfig"),columns:2}},[a("let-form-item",{attrs:{label:e.$t("cache.config.item"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.item,callback:function(t){e.$set(e.config,"item",t)},expression:"config.item"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.config.path"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.path,callback:function(t){e.$set(e.config,"path",t)},expression:"config.path"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.config.reload"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.reload,callback:function(t){e.$set(e.config,"reload",t)},expression:"config.reload"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.config.period"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.period,callback:function(t){e.$set(e.config,"period",t)},expression:"config.period"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.config.remark"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.remark,callback:function(t){e.$set(e.config,"remark",t)},expression:"config.remark"}})],1),a("br"),a("let-form-item",{attrs:{label:" "}},[a("let-button",{attrs:{theme:"primary"},on:{click:e.submit}},[e._v(e._s(e.$t("cache.add")))])],1)],1)],1)},Es=[],js={data:function(){return{config:{item:"",path:"",period:"",reload:"",remark:""}}},methods:{submit:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.addConfigForm.validate()){t.next=13;break}return t.prev=1,t.next=4,e.$ajax.postJSON("/server/api/cache/addConfig",e.config);case 4:e.$tip.success("".concat(e.$t("cache.config.addSuccess"))),Object.assign(e.config,{item:""}),e.$emit("call-back"),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 13:case"end":return t.stop()}}),t,null,[[1,9]])})))()}}},As=js,zs=Object(h["a"])(As,Is,Es,!1,null,null,null),Fs=zs.exports,Js=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{},[a("let-form",{ref:"editConfigForm",attrs:{type:"medium",title:e.$t("cache.config.editConfig"),columns:2}},[a("let-form-item",{attrs:{label:e.$t("cache.config.reload"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.reload,callback:function(t){e.$set(e.config,"reload",t)},expression:"config.reload"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.config.period"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.period,callback:function(t){e.$set(e.config,"period",t)},expression:"config.period"}})],1),a("let-form-item",{attrs:{label:e.$t("cache.config.remark"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.config.remark,callback:function(t){e.$set(e.config,"remark",t)},expression:"config.remark"}})],1),a("br"),a("let-form-item",{attrs:{label:" "}},[a("let-button",{attrs:{theme:"primary"},on:{click:e.submit}},[e._v(e._s(e.$t("cache.modification")))])],1)],1)],1)},Bs=[],Vs={props:{id:{type:String,required:!0},item:{type:String,required:!0},path:{type:String,required:!0},period:{type:String,required:!0},reload:{type:String,required:!0},remark:{type:String,required:!0}},data:function(){return{config:{id:this.id,item:this.item,path:this.path,period:this.period,reload:this.reload,remark:this.remark}}},methods:{submit:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.editConfigForm.validate()){t.next=12;break}return t.prev=1,t.next=4,e.$ajax.postJSON("/server/api/cache/editConfig",e.config);case 4:e.$tip.success("".concat(e.$t("cache.config.addSuccess"))),e.$emit("call-back"),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](1),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 12:case"end":return t.stop()}}),t,null,[[1,8]])})))()}}},Gs=Vs,Ws=Object(h["a"])(Gs,Js,Bs,!1,null,null,null),Ks=Ws.exports,Hs={components:{AddConfig:Fs,EditConfig:Ks},data:function(){return{list:[],addConfigVisible:!1,editConfigVisible:!1,editConfigObj:null}},methods:{addConfig:function(){this.addConfigVisible=!0},editConfig:function(e){this.editConfigVisible=!0,this.editConfigObj=e},deleteConfig:function(e){var t=this,a=e.id;this.$confirm(this.$t("cache.config.deleteConfig"),this.$t("common.alert")).then(Object(fe["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$ajax.getJSON("/server/api/cache/deleteConfig",{id:a});case 3:return e.sent,e.next=6,t.getConfig();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),console.error(e.t0),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.t0.message||e.t0.err_msg));case 12:case"end":return e.stop()}}),e,null,[[0,8]])}))))},getConfig:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$ajax.getJSON("/server/api/cache/getConfig");case 3:a=t.sent,e.list=a,t.next=11;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()}},created:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.getConfig();case 1:case"end":return t.stop()}}),t)})))()}},Us=Hs,Zs=(a("3996"),Object(h["a"])(Us,Ps,Rs,!1,null,null,null)),Ys=Zs.exports,Qs=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"operation-manage"},[a("let-tabs",{attrs:{activekey:e.getTabKey()},on:{click:e.onTabClick}},[a("let-tab-pane",{attrs:{tab:e.$t("dcache.operationManage.expand"),tabkey:"/operationManage/expand"}}),a("let-tab-pane",{attrs:{tab:e.$t("dcache.operationManage.shrinkage"),tabkey:"/operationManage/shrinkage"}}),a("let-tab-pane",{attrs:{tab:e.$t("dcache.operationManage.migration"),tabkey:"/operationManage/migration"}}),a("let-tab-pane",{attrs:{tab:e.$t("dcache.operationManage.mainBackup"),tabkey:"/operationManage/mainBackup"}}),a("let-tab-pane",{attrs:{tab:e.$t("dcache.operationManage.router"),tabkey:"/operationManage/router"}})],1),a("router-view",{staticClass:"operation-manage-children"})],1)},Xs=[],ei={methods:{onTabClick:function(e){this.$route.path!=e&&this.$router.replace(e)},getTabKey:function(){var e=this.$route.path,t=e.indexOf("/",e.indexOf("/",e.indexOf("/")+1)+1),a=e;return t>0&&(a=e.substr(0,t)),a}}},ti=ei,ai=(a("0827"),Object(h["a"])(ti,Qs,Xs,!1,null,null,null)),ri=ai.exports,oi=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("let-table",{ref:"pageTable",attrs:{data:e.showList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.appName"),prop:"appName"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.moduleName"),prop:"moduleName"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.srcGroupName"),prop:"srcGroupName"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.dstGroupName"),prop:"dstGroupName"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.status"),prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$t(a.statusText))+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.beginTime"),prop:"beginTime"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.progress"),prop:"progress"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.progressText)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),prop:"appName",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[3===r.status?a("let-table-operation",{on:{click:function(t){return e.ensureStop(r)}}},[e._v(e._s(e.$t("operate.stop")))]):e._e(),3!==r.status?a("let-table-operation",{on:{click:function(t){return e.ensureDelete(r)}}},[e._v(e._s(e.$t("operate.delete")))]):e._e(),5===r.status?a("let-table-operation",{on:{click:function(t){return e.restartDask(r)}}},[e._v(e._s(e.$t("operate.retry")))]):e._e()]}}])}),a("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.total,page:e.page},on:{change:e.changePage},slot:"pagination"})],1)],1)},ni=[],si={data:function(){return{list:[],total:0,page:1}},computed:{showList:function(){var e=this.page,t=this.list;return t.slice(10*(e-1),10*e)},type:function(){var e={expand:"1",shrinkage:"2",migration:"0"};return e[this.$route.params.type]||"1"}},methods:{getRouterChange:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fa({type:e.type});case 3:a=t.sent,r=a.totalNum,o=a.transferRecord,e.list=o.map((function(e){return e.statusText="dcache.operationManage.statusText."+e.status,e.progressText=e.progress+"%",e})),e.total=Math.ceil(r/10),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))()},changePage:function(e){this.page=e},ensureStop:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o,n,s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$confirm(t.$t("dcache.operationManage.ensureStop"));case 3:return r=e.appName,o=e.moduleName,n=e.type,s=e.srcGroupName,i=e.dstGroupName,a.next=6,ga({appName:r,moduleName:o,type:n,srcGroupName:s,dstGroupName:i});case 6:t.getRouterChange(),a.next=13;break;case 9:a.prev=9,a.t0=a["catch"](0),console.error(a.t0),t.$tip.error(a.t0.message);case 13:case"end":return a.stop()}}),a,null,[[0,9]])})))()},ensureDelete:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o,n,s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$confirm(t.$t("dcache.operationManage.ensureDelete"));case 3:return r=e.appName,o=e.moduleName,n=e.type,s=e.srcGroupName,i=e.dstGroupName,a.next=6,ba({appName:r,moduleName:o,type:n,srcGroupName:s,dstGroupName:i});case 6:t.getRouterChange(),a.next=13;break;case 9:a.prev=9,a.t0=a["catch"](0),console.error(a.t0),t.$tip.error(a.t0.message);case 13:case"end":return a.stop()}}),a,null,[[0,9]])})))()},restartDask:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o,n,s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$confirm(t.$t("dcache.operationManage.ensureRestart"));case 3:return r=e.appName,o=e.moduleName,n=e.type,s=e.srcGroupName,i=e.dstGroupName,a.next=6,_a({appName:r,moduleName:o,type:n,srcGroupName:s,dstGroupName:i});case 6:t.getRouterChange(),a.next=13;break;case 9:a.prev=9,a.t0=a["catch"](0),console.error(a.t0),t.$tip.error(a.t0.message);case 13:case"end":return a.stop()}}),a,null,[[0,9]])})))()}},beforeRouteUpdate:function(e,t,a){a(),this.getRouterChange()},created:function(){this.getRouterChange()}},ii=si,li=Object(h["a"])(ii,oi,ni,!1,null,null,null),ci=li.exports,ui=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("let-table",{ref:"pageTable",attrs:{data:e.showList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.appName"),prop:"appName"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.moduleName"),prop:"moduleName"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.groupName"),prop:"groupName"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.switchTime"),prop:"switchTime"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.modifyTime"),prop:"modifyTime"}}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.switchType"),prop:"switchType"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.switchType;return[a("span",{style:{color:e.color[r]}},[e._v(e._s(e.$t("dcache."+e.switchTypeText[r])))])]}}])}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.switchResult"),prop:"switchResult"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.switchResult;return[a("span",{style:{color:e.color[r]}},[e._v(e._s(e.$t("dcache."+e.switchResultText[r])))])]}}])}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.groupStatus"),prop:"groupStatus"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.groupStatus;return[a("span",{style:{color:e.color[r]}},[e._v(e._s(e.$t("dcache."+e.groupStatusText[r])))])]}}])}),a("let-table-column",{attrs:{title:e.$t("dcache.operationManage.switchMethod"),prop:"switchProperty"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.switchProperty;return[a("span",[e._v(e._s(e.$t("dcache."+e.switchPropertyText[r])))])]}}])}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),prop:"appName",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("let-table-operation",{attrs:{title:e.$t("dcache.areset"),disabled:!(2===r.switchType&&2===r.groupStatus)},on:{click:function(t){return e.recoverMirrorStatus(r)}}},[e._v(e._s(e.$t("dcache.oreset")))])]}}])}),a("let-pagination",{attrs:{slot:"pagination",align:"right",total:e.total,page:e.page},on:{change:e.changePage},slot:"pagination"})],1)],1)},di=[],mi={data:function(){return{list:[],total:0,page:1,switchTypeText:["switch","mirrorSwitch","mirrorOffSwitch","readFail","switchMirrorAsMaster"],switchResultText:["switching","switchSuccess","notSwitch","switchFailure"],groupStatusText:["rw","ro","imageUnavailable"],switchPropertyText:{auto:"auto",manual:"manual"},color:["#00AA90","#6accab","#9096a3","#f56c77"]}},computed:{showList:function(){var e=this.page,t=this.list;return t.slice(10*(e-1),10*e)}},methods:{getSwitchInfo:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,ya({});case 3:a=t.sent,r=a.totalNum,o=a.switchRecord,e.list=o.map((function(e){return e})),e.total=Math.ceil(r/10),t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](0),console.error(t.t0),e.$tip.error(t.t0.message);case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))()},changePage:function(e){this.page=e},switchServer:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,r=e.appName,o=e.moduleName,n=e.groupName,a.next=4,ka({appName:r,moduleName:o,groupName:n});case 4:t.getSwitchInfo(),a.next=11;break;case 7:a.prev=7,a.t0=a["catch"](0),console.error(a.t0),t.$tip.error(a.t0.message);case 11:case"end":return a.stop()}}),a,null,[[0,7]])})))()},recoverMirrorStatus:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o,n,s,i,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(2!==e.switchType){a.next=14;break}if(a.prev=1,r=e.appName,o=e.moduleName,n=e.groupName,s=e.mirrorIdc,i=e.dbFlag,l=e.enableErase,s){a.next=5;break}throw new Error(t.$t("dcache.mirrorEmpty"));case 5:return a.next=7,Ma({appName:r,moduleName:o,groupName:n,mirrorIdc:s,dbFlag:i,enableErase:l});case 7:t.getSwitchInfo(),a.next=14;break;case 10:a.prev=10,a.t0=a["catch"](1),console.error(a.t0),t.$tip.error(a.t0.message);case 14:case"end":return a.stop()}}),a,null,[[1,10]])})))()}},created:function(){this.getSwitchInfo()}},pi=mi,hi=Object(h["a"])(pi,ui,di,!1,null,null,null),fi=hi.exports,vi=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"page_router"},[r("div",{staticClass:"left-view"},[r("div",{staticClass:"tree_wrap"},[e.treeData&&e.treeData.length?r("let-tree",{staticClass:"left-tree",attrs:{data:e.treeData,activeKey:e.getTreeKey()},on:{"on-select":e.selectTree}}):e._e()],1)]),r("div",{staticClass:"right-view"},[e.$route.params.treeid?r("router-view",{staticClass:"router-children"}):r("div",{staticClass:"empty",staticStyle:{width:"300px"}},[r("img",{staticClass:"package",attrs:{src:a("4824")}}),r("p",{staticClass:"notice",domProps:{innerHTML:e._s(e.$t("index.rightView.tips"))}})])],1)])},gi=[],_i={name:"router",data:function(){return{menu:[{title:this.$t("routerManage.routerModule"),nodeKey:"module"},{title:this.$t("routerManage.routerRecord"),nodeKey:"record"},{title:this.$t("routerManage.routerGroup"),nodeKey:"group"},{title:this.$t("routerManage.routerServer"),nodeKey:"server"},{title:this.$t("routerManage.routerTransfer"),nodeKey:"transfer"}],treeData:[]}},mounted:function(){this.loadData()},methods:{loadData:function(){this.getTree()},selectTree:function(e,t){var a=this,r=!1,o=e.split(".")[0]||"",n=e.split(".")[1]||"";if(this.menu.forEach((function(e){e.nodeKey===n&&(r=!0)})),r){var s=this.$route.params.treeid,i=this.$route.path,l=i.substr(i.lastIndexOf("/")+1,i.length);s&&s===o?l!==n&&this.$router.push(n):s?this.$router.push({params:{treeid:o}},(function(){l!==n&&a.$router.push(n)})):this.$router.replace("router/".concat(o,"/").concat(n))}},getTreeKey:function(){var e=this.$route.params.treeid,t=this.$route.path,a=t.substr(t.lastIndexOf("/")+1,t.length);return"".concat(e,".").concat(a)},getTree:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Pa();case 2:a=t.sent,r=[],a&&a.length>0&&a.forEach((function(t){var a=[];e.menu.forEach((function(e){a.push({label:e.title,app:t.name,path:e.nodeKey,nodeKey:"".concat(t.name,".").concat(e.nodeKey)})})),r.push({label:t.name,nodeKey:t.name,children:a})})),e.treeData=r;case 6:case"end":return t.stop()}}),t)})))()}}},bi=_i,$i=(a("c4e8"),Object(h["a"])(bi,vi,gi,!1,null,null,null)),ki=$i.exports,wi=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"btn_group"},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.addEvent}},[e._v(e._s(e.$t("operate.add")))]),a("let-button",{attrs:{theme:"danger",size:"small"},on:{click:e.delEvent}},[e._v(e._s(e.$t("operate.delete")))])],1),a("let-table",{ref:"pageTable",attrs:{data:e.tableData,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{value:t.row.id},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("routerManage.moduleName"),prop:"module_name"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.version"),prop:"version"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.switchStatus"),prop:"switch_status"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(e.switchStatus,(function(r){return r.val===t.row.switch_status?a("div",{key:r.val},[e._v(" "+e._s(r.label)+" ")]):e._e()}))}}])}),a("let-table-column",{attrs:{title:e.$t("routerManage.remark"),prop:"remark"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editEvent(t.row.id)}}},[e._v(e._s(e.$t("operate.update")))])]}}])})],1),a("let-pagination",{attrs:{page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}}),a("let-modal",{attrs:{title:e.dialogModal.isNew?e.$t("operate.add"):e.$t("operate.modify"),width:"800px"},on:{"on-confirm":e.saveDialog,close:e.closeDialog,"on-cancel":e.closeDialog},model:{value:e.dialogModal.show,callback:function(t){e.$set(e.dialogModal,"show",t)},expression:"dialogModal.show"}},[e.dialogModal.model?a("let-form",{ref:"dialogForm",attrs:{itemWidth:"100%"}},[a("let-form-item",{attrs:{label:e.$t("routerManage.moduleName"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.module_name,callback:function(t){e.$set(e.dialogModal.model,"module_name",t)},expression:"dialogModal.model.module_name"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.version"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.version,callback:function(t){e.$set(e.dialogModal.model,"version",t)},expression:"dialogModal.model.version"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.switchStatus"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.switch_status,callback:function(t){e.$set(e.dialogModal.model,"switch_status",t)},expression:"dialogModal.model.switch_status"}},e._l(e.switchStatus,(function(t){return a("let-option",{key:t.val,attrs:{value:t.val}},[e._v(e._s(t.label))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("routerManage.remark")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.dialogModal.model.remark,callback:function(t){e.$set(e.dialogModal.model,"remark",t)},expression:"dialogModal.model.remark"}})],1)],1):e._e()],1)],1)},yi=[],Mi={data:function(){return{switchStatus:[{val:0,label:"读写自动切换"},{val:1,label:"只读自动切换"},{val:2,label:"不支持自动切换"},{val:3,label:"无效模块"}],isCheckedAll:!1,tableData:[],pagination:{page:1,size:10,total:1},dialogModal:{show:!1,model:{},isNew:!1}}},mounted:function(){this.loadData()},watch:{$route:function(e,t){this.loadData()},isCheckedAll:function(){var e=this.isCheckedAll;this.tableData.forEach((function(t){t.isChecked=e}))}},methods:{getTreeId:function(){return this.$route.params.treeid},loadData:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.listEvent();case 2:case"end":return t.stop()}}),t)})))()},addEvent:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.dialogModal={show:!0,model:{},isNew:!0};case 1:case"end":return t.stop()}}),t)})))()},delEvent:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=e.tableData,r=[],a.forEach((function(e){e.isChecked&&r.push(e.id)})),t.next=6,Ia({data:{treeid:e.getTreeId(),id:r}});case 6:o=t.sent,o&&(e.listEvent(),e.$tip.success(e.$t("common.success"))),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})))()},editEvent:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,ja({data:{treeid:t.getTreeId(),id:e}});case 3:r=a.sent,r&&(t.dialogModal={show:!0,model:r,isNew:!1}),a.next=10;break;case 7:a.prev=7,a.t0=a["catch"](0),t.$tip.error(a.t0.message);case 10:case"end":return a.stop()}}),a,null,[[0,7]])})))()},listEvent:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Aa({data:{treeid:e.getTreeId(),page:e.pagination.page}});case 3:a=t.sent,a.rows.forEach((function(e){e.isChecked=!1})),e.tableData=a.rows,e.pagination={page:a.page,size:a.size,total:Math.ceil(a.count/a.size)},t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},gotoPage:function(e){this.pagination.page=e,this.listEvent()},saveDialog:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!e.$refs.dialogForm.validate()){t.next=16;break}if(a=e.dialogModal,r=a.isNew,o=a.model,o.treeid=e.getTreeId(),n={},!r){t.next=11;break}return t.next=8,Ra({data:o});case 8:n=t.sent,t.next=14;break;case 11:return t.next=13,Ea({data:o});case 13:n=t.sent;case 14:n&&(e.listEvent(),e.$tip.success(e.$t("common.success"))),e.closeDialog();case 16:t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 21:case"end":return t.stop()}}),t,null,[[0,18]])})))()},closeDialog:function(){this.dialogModal.show=!1,this.dialogModal.model=null}}},xi=Mi,Si=(a("11a2"),Object(h["a"])(xi,wi,yi,!1,null,null,null)),Ci=Si.exports,Ni=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"btn_group"},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.addEvent}},[e._v(e._s(e.$t("operate.add")))]),a("let-button",{attrs:{theme:"danger",size:"small"},on:{click:e.delEvent}},[e._v(e._s(e.$t("operate.delete")))])],1),a("let-table",{ref:"pageTable",attrs:{data:e.tableData,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{value:t.row.id},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("routerManage.moduleName"),prop:"module_name"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.fromPageNo"),prop:"from_page_no"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.toPageNo"),prop:"to_page_no"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.groupName"),prop:"group_name"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editEvent(t.row.id)}}},[e._v(e._s(e.$t("operate.update")))])]}}])})],1),a("div",{staticStyle:{overflow:"hidden"}},[a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}})],1),a("let-modal",{attrs:{title:e.dialogModal.isNew?e.$t("operate.add"):e.$t("operate.modify"),width:"800px"},on:{"on-confirm":e.saveDialog,close:e.closeDialog,"on-cancel":e.closeDialog},model:{value:e.dialogModal.show,callback:function(t){e.$set(e.dialogModal,"show",t)},expression:"dialogModal.show"}},[e.dialogModal.model?a("let-form",{ref:"dialogForm",attrs:{itemWidth:"100%"}},[a("let-form-item",{attrs:{label:e.$t("routerManage.moduleName"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.module_name,callback:function(t){e.$set(e.dialogModal.model,"module_name",t)},expression:"dialogModal.model.module_name"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.fromPageNo"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.from_page_no,callback:function(t){e.$set(e.dialogModal.model,"from_page_no",t)},expression:"dialogModal.model.from_page_no"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.toPageNo"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.to_page_no,callback:function(t){e.$set(e.dialogModal.model,"to_page_no",t)},expression:"dialogModal.model.to_page_no"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.groupName"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.group_name,callback:function(t){e.$set(e.dialogModal.model,"group_name",t)},expression:"dialogModal.model.group_name"}})],1)],1):e._e()],1)],1)},Li=[],Di={data:function(){return{isCheckedAll:!1,tableData:[],pagination:{page:1,size:10,total:1},dialogModal:{show:!1,model:{},isNew:!1}}},mounted:function(){this.loadData()},watch:{$route:function(e,t){this.loadData()},isCheckedAll:function(){var e=this.isCheckedAll;this.tableData.forEach((function(t){t.isChecked=e}))}},methods:{getTreeId:function(){return this.$route.params.treeid},loadData:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.listEvent();case 2:case"end":return t.stop()}}),t)})))()},addEvent:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.dialogModal={show:!0,model:{},isNew:!0};case 1:case"end":return t.stop()}}),t)})))()},delEvent:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=e.tableData,r=[],a.forEach((function(e){e.isChecked&&r.push(e.id)})),t.next=6,Wa({data:{treeid:e.getTreeId(),id:r}});case 6:o=t.sent,o&&(e.listEvent(),e.$tip.success(e.$t("common.success"))),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})))()},editEvent:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Ha({data:{treeid:t.getTreeId(),id:e}});case 3:r=a.sent,r&&(t.dialogModal={show:!0,model:r,isNew:!1}),a.next=10;break;case 7:a.prev=7,a.t0=a["catch"](0),t.$tip.error(a.t0.message);case 10:case"end":return a.stop()}}),a,null,[[0,7]])})))()},listEvent:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Ua({data:{treeid:e.getTreeId(),page:e.pagination.page}});case 3:a=t.sent,a.rows.forEach((function(e){e.isChecked=!1})),e.tableData=a.rows,e.pagination={page:a.page,size:a.size,total:Math.ceil(a.count/a.size)},t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},gotoPage:function(e){this.pagination.page=e,this.listEvent()},saveDialog:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!e.$refs.dialogForm.validate()){t.next=16;break}if(a=e.dialogModal,r=a.isNew,o=a.model,o.treeid=e.getTreeId(),n={},!r){t.next=11;break}return t.next=8,Ga({data:o});case 8:n=t.sent,t.next=14;break;case 11:return t.next=13,Ka({data:o});case 13:n=t.sent;case 14:n&&(e.listEvent(),e.$tip.success(e.$t("common.success"))),e.closeDialog();case 16:t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 21:case"end":return t.stop()}}),t,null,[[0,18]])})))()},closeDialog:function(){this.dialogModal.show=!1,this.dialogModal.model=null}}},Oi=Di,Ti=(a("80f7"),Object(h["a"])(Oi,Ni,Li,!1,null,null,null)),qi=Ti.exports,Pi=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"btn_group"},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.addEvent}},[e._v(e._s(e.$t("operate.add")))]),a("let-button",{attrs:{theme:"danger",size:"small"},on:{click:e.delEvent}},[e._v(e._s(e.$t("operate.delete")))])],1),a("let-table",{ref:"pageTable",attrs:{data:e.tableData,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{value:t.row.id},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("routerManage.moduleName"),prop:"module_name"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.groupName"),prop:"group_name"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.accessStatus"),prop:"access_status"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(e.accessStatus,(function(r){return r.val===t.row.access_status?a("div",{key:r.val},[e._v(" "+e._s(r.label)+" ")]):e._e()}))}}])}),a("let-table-column",{attrs:{title:e.$t("routerManage.serverName"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.serverStatus"),prop:"server_status"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(e.serverStatus,(function(r){return r.val===t.row.server_status?a("div",{key:r.val},[e._v(" "+e._s(r.label)+" ")]):e._e()}))}}])}),a("let-table-column",{attrs:{title:e.$t("routerManage.pri"),prop:"pri"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.sourceServerName"),prop:"source_server_name"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editEvent(t.row.id)}}},[e._v(e._s(e.$t("operate.update")))])]}}])})],1),a("div",{staticStyle:{overflow:"hidden"}},[a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}})],1),a("let-modal",{attrs:{title:e.dialogModal.isNew?e.$t("operate.add"):e.$t("operate.modify"),width:"800px"},on:{"on-confirm":e.saveDialog,close:e.closeDialog,"on-cancel":e.closeDialog},model:{value:e.dialogModal.show,callback:function(t){e.$set(e.dialogModal,"show",t)},expression:"dialogModal.show"}},[e.dialogModal.model?a("let-form",{ref:"dialogForm",attrs:{itemWidth:"100%"}},[a("let-form-item",{attrs:{label:e.$t("routerManage.moduleName"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.module_name,callback:function(t){e.$set(e.dialogModal.model,"module_name",t)},expression:"dialogModal.model.module_name"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.groupName"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.group_name,callback:function(t){e.$set(e.dialogModal.model,"group_name",t)},expression:"dialogModal.model.group_name"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.accessStatus"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.access_status,callback:function(t){e.$set(e.dialogModal.model,"access_status",t)},expression:"dialogModal.model.access_status"}},e._l(e.accessStatus,(function(t){return a("let-option",{key:t.val,attrs:{value:t.val}},[e._v(e._s(t.label))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("routerManage.serverName"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.server_name,callback:function(t){e.$set(e.dialogModal.model,"server_name",t)},expression:"dialogModal.model.server_name"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.serverStatus"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.server_status,callback:function(t){e.$set(e.dialogModal.model,"server_status",t)},expression:"dialogModal.model.server_status"}},e._l(e.serverStatus,(function(t){return a("let-option",{key:t.val,attrs:{value:t.val}},[e._v(e._s(t.label))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("routerManage.pri"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.pri,callback:function(t){e.$set(e.dialogModal.model,"pri",t)},expression:"dialogModal.model.pri"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.sourceServerName"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.source_server_name,callback:function(t){e.$set(e.dialogModal.model,"source_server_name",t)},expression:"dialogModal.model.source_server_name"}})],1)],1):e._e()],1)],1)},Ri=[],Ii={data:function(){return{accessStatus:[{val:0,label:"正常状态"},{val:1,label:"只读状态"},{val:2,label:"镜像切换状态"}],serverStatus:[{val:"M",label:"主机"},{val:"S",label:"备机"},{val:"I",label:"镜像"}],isCheckedAll:!1,tableData:[],pagination:{page:1,size:10,total:1},dialogModal:{show:!1,model:{},isNew:!1}}},mounted:function(){this.loadData()},watch:{$route:function(e,t){this.loadData()},isCheckedAll:function(){var e=this.isCheckedAll;this.tableData.forEach((function(t){t.isChecked=e}))}},methods:{getTreeId:function(){return this.$route.params.treeid},loadData:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.listEvent();case 2:case"end":return t.stop()}}),t)})))()},addEvent:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.dialogModal={show:!0,model:{},isNew:!0};case 1:case"end":return t.stop()}}),t)})))()},delEvent:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=e.tableData,r=[],a.forEach((function(e){e.isChecked&&r.push(e.id)})),t.next=6,Fa({data:{treeid:e.getTreeId(),id:r}});case 6:o=t.sent,o&&(e.listEvent(),e.$tip.success(e.$t("common.success"))),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})))()},editEvent:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Ba({data:{treeid:t.getTreeId(),id:e}});case 3:r=a.sent,r&&(t.dialogModal={show:!0,model:r,isNew:!1}),a.next=10;break;case 7:a.prev=7,a.t0=a["catch"](0),t.$tip.error(a.t0.message);case 10:case"end":return a.stop()}}),a,null,[[0,7]])})))()},listEvent:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Va({data:{treeid:e.getTreeId(),page:e.pagination.page}});case 3:a=t.sent,a.rows.forEach((function(e){e.isChecked=!1})),e.tableData=a.rows,e.pagination={page:a.page,size:a.size,total:Math.ceil(a.count/a.size)},t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},gotoPage:function(e){this.pagination.page=e,this.listEvent()},saveDialog:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!e.$refs.dialogForm.validate()){t.next=15;break}if(a=e.dialogModal,r=a.isNew,o=a.model,n={},!r){t.next=10;break}return t.next=7,za({data:o});case 7:n=t.sent,t.next=13;break;case 10:return t.next=12,Ja({data:o});case 12:n=t.sent;case 13:n&&(e.listEvent(),e.$tip.success(e.$t("common.success"))),e.closeDialog();case 15:t.next=20;break;case 17:t.prev=17,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 20:case"end":return t.stop()}}),t,null,[[0,17]])})))()},closeDialog:function(){this.dialogModal.show=!1,this.dialogModal.model=null}}},Ei=Ii,ji=(a("6428"),Object(h["a"])(Ei,Pi,Ri,!1,null,null,null)),Ai=ji.exports,zi=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"btn_group"},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.addEvent}},[e._v(e._s(e.$t("operate.add")))]),a("let-button",{attrs:{theme:"danger",size:"small"},on:{click:e.delEvent}},[e._v(e._s(e.$t("operate.delete")))])],1),a("let-table",{ref:"pageTable",attrs:{data:e.tableData,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{value:t.row.id},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("routerManage.idcArea"),prop:"idc_area"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.serverName"),prop:"server_name"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.ip"),prop:"ip"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.binlogPort"),prop:"binlog_port"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.cachePort"),prop:"cache_port"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.wcachePort"),prop:"wcache_port"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.backupPort"),prop:"backup_port"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.routeclientPort"),prop:"routerclient_port"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.remark"),prop:"remark"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editEvent(t.row.id)}}},[e._v(e._s(e.$t("operate.update")))])]}}])})],1),a("div",{staticStyle:{overflow:"hidden"}},[a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}})],1),a("let-modal",{attrs:{title:e.dialogModal.isNew?e.$t("operate.add"):e.$t("operate.modify"),width:"800px"},on:{"on-confirm":e.saveDialog,close:e.closeDialog,"on-cancel":e.closeDialog},model:{value:e.dialogModal.show,callback:function(t){e.$set(e.dialogModal,"show",t)},expression:"dialogModal.show"}},[e.dialogModal.model?a("let-form",{ref:"dialogForm",attrs:{itemWidth:"100%"}},[a("let-form-item",{attrs:{label:e.$t("routerManage.idcArea"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.idc_area,callback:function(t){e.$set(e.dialogModal.model,"idc_area",t)},expression:"dialogModal.model.idc_area"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.serverName"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.server_name,callback:function(t){e.$set(e.dialogModal.model,"server_name",t)},expression:"dialogModal.model.server_name"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.ip"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.ip,callback:function(t){e.$set(e.dialogModal.model,"ip",t)},expression:"dialogModal.model.ip"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.binlogPort"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.binlog_port,callback:function(t){e.$set(e.dialogModal.model,"binlog_port",t)},expression:"dialogModal.model.binlog_port"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.cachePort"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.cache_port,callback:function(t){e.$set(e.dialogModal.model,"cache_port",t)},expression:"dialogModal.model.cache_port"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.wcachePort"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.wcache_port,callback:function(t){e.$set(e.dialogModal.model,"wcache_port",t)},expression:"dialogModal.model.wcache_port"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.backupPort"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.backup_port,callback:function(t){e.$set(e.dialogModal.model,"backup_port",t)},expression:"dialogModal.model.backup_port"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.routeclientPort"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.routerclient_port,callback:function(t){e.$set(e.dialogModal.model,"routerclient_port",t)},expression:"dialogModal.model.routerclient_port"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.remark")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.dialogModal.model.remark,callback:function(t){e.$set(e.dialogModal.model,"remark",t)},expression:"dialogModal.model.remark"}})],1)],1):e._e()],1)],1)},Fi=[],Ji={data:function(){return{switchStatus:[{val:0,label:"读写自动切换"},{val:1,label:"只读自动切换"},{val:2,label:"不支持自动切换"},{val:3,label:"无效模块"}],isCheckedAll:!1,tableData:[],pagination:{page:1,size:10,total:1},dialogModal:{show:!1,model:{},isNew:!1}}},mounted:function(){this.loadData()},watch:{$route:function(e,t){this.loadData()},isCheckedAll:function(){var e=this.isCheckedAll;this.tableData.forEach((function(t){t.isChecked=e}))}},methods:{getTreeId:function(){return this.$route.params.treeid},loadData:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.listEvent();case 2:case"end":return t.stop()}}),t)})))()},addEvent:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.dialogModal={show:!0,model:{},isNew:!0};case 1:case"end":return t.stop()}}),t)})))()},delEvent:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=e.tableData,r=[],a.forEach((function(e){e.isChecked&&r.push(e.id)})),t.next=6,Ya({data:{treeid:e.getTreeId(),id:r}});case 6:o=t.sent,o&&(e.listEvent(),e.$tip.success(e.$t("common.success"))),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})))()},editEvent:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Xa({data:{treeid:t.getTreeId(),id:e}});case 3:r=a.sent,r&&(t.dialogModal={show:!0,model:r,isNew:!1}),a.next=10;break;case 7:a.prev=7,a.t0=a["catch"](0),t.$tip.error(a.t0.message);case 10:case"end":return a.stop()}}),a,null,[[0,7]])})))()},listEvent:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,er({data:{treeid:e.getTreeId(),page:e.pagination.page}});case 3:a=t.sent,a.rows.forEach((function(e){e.isChecked=!1})),e.tableData=a.rows,e.pagination={page:a.page,size:a.size,total:Math.ceil(a.count/a.size)},t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},gotoPage:function(e){this.pagination.page=e,this.listEvent()},saveDialog:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!e.$refs.dialogForm.validate()){t.next=16;break}if(a=e.dialogModal,r=a.isNew,o=a.model,o.treeid=e.getTreeId(),n={},!r){t.next=11;break}return t.next=8,Za({data:o});case 8:n=t.sent,t.next=14;break;case 11:return t.next=13,Qa({data:o});case 13:n=t.sent;case 14:n&&(e.listEvent(),e.$tip.success(e.$t("common.success"))),e.closeDialog();case 16:t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 21:case"end":return t.stop()}}),t,null,[[0,18]])})))()},closeDialog:function(){this.dialogModal.show=!1,this.dialogModal.model=null}}},Bi=Ji,Vi=(a("8535"),Object(h["a"])(Bi,zi,Fi,!1,null,null,null)),Gi=Vi.exports,Wi=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"btn_group"},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.addEvent}},[e._v(e._s(e.$t("operate.add")))]),a("let-button",{attrs:{theme:"danger",size:"small"},on:{click:e.delEvent}},[e._v(e._s(e.$t("operate.delete")))])],1),a("let-table",{ref:"pageTable",attrs:{data:e.tableData,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{value:t.row.id},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("routerManage.moduleName"),prop:"module_name"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.fromPageNo"),prop:"from_page_no"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.toPageNo"),prop:"to_page_no"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.groupName"),prop:"group_name"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.transGroupName"),prop:"trans_group_name"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.transferedPageNo"),prop:"transfered_page_no"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.remark"),prop:"remark"}}),a("let-table-column",{attrs:{title:e.$t("routerManage.state"),prop:"state"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(e.stateStatus,(function(r){return r.val===t.row.state?a("div",{key:r.val},[e._v(" "+e._s(r.label)+" ")]):e._e()}))}}])}),a("let-table-column",{attrs:{title:e.$t("routerManage.startTime"),prop:"startTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDate(t.row.startTime))+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("routerManage.endTime"),prop:"endTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDate(t.row.endTime))+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editEvent(t.row.id)}}},[e._v(e._s(e.$t("operate.update")))])]}}])})],1),a("div",{staticStyle:{overflow:"hidden"}},[a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}})],1),a("let-modal",{attrs:{title:e.dialogModal.isNew?e.$t("operate.add"):e.$t("operate.modify"),width:"800px"},on:{"on-confirm":e.saveDialog,close:e.closeDialog,"on-cancel":e.closeDialog},model:{value:e.dialogModal.show,callback:function(t){e.$set(e.dialogModal,"show",t)},expression:"dialogModal.show"}},[e.dialogModal.model?a("let-form",{ref:"dialogForm",attrs:{itemWidth:"100%"}},[a("let-form-item",{attrs:{label:e.$t("routerManage.moduleName"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.module_name,callback:function(t){e.$set(e.dialogModal.model,"module_name",t)},expression:"dialogModal.model.module_name"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.fromPageNo"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.from_page_no,callback:function(t){e.$set(e.dialogModal.model,"from_page_no",t)},expression:"dialogModal.model.from_page_no"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.toPageNo"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.to_page_no,callback:function(t){e.$set(e.dialogModal.model,"to_page_no",t)},expression:"dialogModal.model.to_page_no"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.groupName"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.group_name,callback:function(t){e.$set(e.dialogModal.model,"group_name",t)},expression:"dialogModal.model.group_name"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.transGroupName"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.trans_group_name,callback:function(t){e.$set(e.dialogModal.model,"trans_group_name",t)},expression:"dialogModal.model.trans_group_name"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.transferedPageNo"),required:""}},[a("let-input",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.transfered_page_no,callback:function(t){e.$set(e.dialogModal.model,"transfered_page_no",t)},expression:"dialogModal.model.transfered_page_no"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.remark")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.dialogModal.model.remark,callback:function(t){e.$set(e.dialogModal.model,"remark",t)},expression:"dialogModal.model.remark"}})],1),a("let-form-item",{attrs:{label:e.$t("routerManage.switchStatus"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("common.notEmpty")},model:{value:e.dialogModal.model.state,callback:function(t){e.$set(e.dialogModal.model,"state",t)},expression:"dialogModal.model.state"}},e._l(e.stateStatus,(function(t){return a("let-option",{key:t.val,attrs:{value:t.val}},[e._v(e._s(t.label))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("routerManage.time")}},[a("let-datetime-range-picker",{attrs:{start:e.dialogModal.model.startTime,end:e.dialogModal.model.endTime},on:{"update:start":function(t){return e.$set(e.dialogModal.model,"startTime",t)},"update:end":function(t){return e.$set(e.dialogModal.model,"endTime",t)}}})],1)],1):e._e()],1)],1)},Ki=[],Hi={data:function(){return{stateStatus:[{val:"0",label:"未迁移"},{val:"1",label:"正在迁移"},{val:"2",label:"迁移结束"},{val:"4",label:"停止迁移"}],isCheckedAll:!1,tableData:[],pagination:{page:1,size:10,total:1},dialogModal:{show:!1,model:{},isNew:!1}}},mounted:function(){this.loadData()},watch:{$route:function(e,t){this.loadData()},isCheckedAll:function(){var e=this.isCheckedAll;this.tableData.forEach((function(t){t.isChecked=e}))}},methods:{getTreeId:function(){return this.$route.params.treeid},formatDate:function(e){return $t(e)},loadData:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.listEvent();case 2:case"end":return t.stop()}}),t)})))()},addEvent:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.dialogModal={show:!0,model:{},isNew:!0};case 1:case"end":return t.stop()}}),t)})))()},delEvent:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=e.tableData,r=[],a.forEach((function(e){e.isChecked&&r.push(e.id)})),t.next=6,ar({data:{treeid:e.getTreeId(),id:r}});case 6:o=t.sent,o&&(e.listEvent(),e.$tip.success(e.$t("common.success"))),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})))()},editEvent:function(e){var t=this;return Object(fe["a"])(regeneratorRuntime.mark((function a(){var r,o,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,or({data:{treeid:t.getTreeId(),id:e}});case 3:r=a.sent,r&&(o=t.formatDate(r.startTime),o&&19===o.length&&(r.startTime=o.substr(0,16)),n=t.formatDate(r.endTime),n&&19===n.length&&(r.endTime=n.substr(0,16)),t.dialogModal={show:!0,model:r,isNew:!1}),a.next=10;break;case 7:a.prev=7,a.t0=a["catch"](0),t.$tip.error(a.t0.message);case 10:case"end":return a.stop()}}),a,null,[[0,7]])})))()},listEvent:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,nr({data:{treeid:e.getTreeId(),page:e.pagination.page}});case 3:a=t.sent,a.rows.forEach((function(e){e.isChecked=!1})),e.tableData=a.rows,e.pagination={page:a.page,size:a.size,total:Math.ceil(a.count/a.size)},t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},gotoPage:function(e){this.pagination.page=e,this.listEvent()},saveDialog:function(){var e=this;return Object(fe["a"])(regeneratorRuntime.mark((function t(){var a,r,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!e.$refs.dialogForm.validate()){t.next=18;break}if(a=e.dialogModal,r=a.isNew,o=a.model,o.startTime&&16===o.startTime.length&&(o.startTime="".concat(o.startTime,":00")),o.endTime&&16===o.endTime.length&&(o.endTime="".concat(o.endTime,":00")),o.treeid=e.getTreeId(),n={},!r){t.next=13;break}return t.next=10,tr({data:o});case 10:n=t.sent,t.next=16;break;case 13:return t.next=15,rr({data:o});case 15:n=t.sent;case 16:n&&(e.listEvent(),e.$tip.success(e.$t("common.success"))),e.closeDialog();case 18:t.next=23;break;case 20:t.prev=20,t.t0=t["catch"](0),e.$tip.error(t.t0.message);case 23:case"end":return t.stop()}}),t,null,[[0,20]])})))()},closeDialog:function(){this.dialogModal.show=!1,this.dialogModal.model=null}}},Ui=Hi,Zi=(a("c828"),Object(h["a"])(Ui,Wi,Ki,!1,null,null,null)),Yi=Zi.exports;r["default"].use(le["a"]);var Qi=le["a"].prototype.push;le["a"].prototype.push=function(e){return Qi.call(this,e).catch((function(e){return e}))};var Xi=le["a"].prototype.replace;le["a"].prototype.replace=function(e){return Xi.call(this,e).catch((function(e){return e}))};var el=new le["a"]({routes:[{path:"/server",name:"Server",component:$o,children:[{path:":treeid/manage",component:qe},{path:":treeid/manage/:serverType",component:qe},{path:":treeid/publish/:serverType",component:Ge},{path:":treeid/config/:serverType",component:mt},{path:":treeid/server-monitor/:serverType",component:Vt},{path:":treeid/property-monitor/:serverType",component:Qt},{path:":treeid/cache",component:Er},{path:":treeid/moduleCache",component:io},{path:":treeid/propertyMonitor",component:vo,fn:"特性监控"}]},{path:"/operation",name:"Operation",component:So,redirect:"/operation/apply",children:[{path:"apply",name:"apply",component:To,redirect:"/operation/apply/createApply",children:[{path:"createApply",component:Ao},{path:"createService/:applyId",component:Ko},{path:"installAndPublish/:applyId",component:tn}]},{path:"module",component:ln,redirect:"/operation/module/createModule",children:[{path:"createModule",component:vn},{path:"moduleConfig/:moduleId",component:Cn},{path:"serverConfig/:moduleId",component:An},{path:"installAndPublish/:moduleId",component:Gn}]},{path:"region",name:"region",component:Yn}]},{path:"/releasePackage",name:"releasePackage",component:rs,redirect:"/releasePackage/proxyList",children:[{path:"proxyList",component:cs},{path:"accessList",component:fs},{path:"routerList",component:ks},{path:"kvcacheList",component:Cs},{path:"mkvcacheList",component:qs}]},{path:"/config",component:Ys},{path:"/operationManage",name:"operationManage",component:ri,redirect:"/operationManage/expand",children:[{path:"mainBackup",component:fi},{path:"router",component:ki,children:[{path:":treeid/module",component:Ci},{path:":treeid/record",component:qi},{path:":treeid/group",component:Ai},{path:":treeid/server",component:Gi},{path:":treeid/transfer",component:Yi}]},{path:":type",component:ci}]},{path:"*",redirect:"/server"}],scrollBehavior:function(e,t,a){return{x:0,y:0}}}),tl=a("a925"),al=a("f0d9"),rl=a.n(al),ol=a("b2d6"),nl=a.n(ol);r["default"].use(tl["a"]),r["default"].use(n.a);var sl=new tl["a"]({});sl.setLocaleMessage("cn",rl.a),sl.setLocaleMessage("en",nl.a);var il=[];function ll(){return new Promise((function(e,t){W.getJSON("/get_locale").then((function(t){var a=n.a.get("locale");if("[object Object]"==Object.prototype.toString.call(t)){for(var r in t)sl.mergeLocaleMessage(r,t[r]),il.push({localeCode:r,localeName:t[r]["localeName"],localeMessages:t});a=t[a]?a:"cn",il=t}sl.locale=a,e()})).catch((function(e){t(e)}))}))}r["default"].config.productionTip=!1,ll.call(void 0).then((function(){r["default"].use(i.a,{i18n:function(e,t){return sl.t(e,t)}}),r["default"].use(n.a),new r["default"]({i18n:sl,el:"#app",router:el,components:{indexApp:ie},template:"<indexApp/>"})}))},bdcf:function(e,t,a){"use strict";var r=a("c787"),o=a.n(r);o.a},c10a:function(e,t,a){},c1ec:function(e,t,a){},c4e8:function(e,t,a){"use strict";var r=a("873a"),o=a.n(r);o.a},c787:function(e,t,a){},c828:function(e,t,a){"use strict";var r=a("8001"),o=a.n(r);o.a},cc4b:function(e,t,a){},cd6a:function(e,t,a){"use strict";var r=a("af6d"),o=a.n(r);o.a},cfde:function(e,t,a){},d118:function(e,t,a){"use strict";var r=a("7ae4"),o=a.n(r);o.a},d57b:function(e,t,a){"use strict";var r=a("943e"),o=a.n(r);o.a},d66b:function(e,t,a){},d8a7:function(e,t,a){"use strict";var r=a("d66b"),o=a.n(r);o.a},dae8:function(e,t,a){"use strict";var r=a("6aad"),o=a.n(r);o.a},dc3c:function(e,t,a){},de6f:function(e,t,a){"use strict";var r=a("1fd3"),o=a.n(r);o.a},e15a:function(e,t,a){},e166:function(e,t,a){"use strict";var r=a("8b32"),o=a.n(r);o.a},f8e0:function(e,t,a){"use strict";var r=a("7720"),o=a.n(r);o.a}});